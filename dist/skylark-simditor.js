/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
!function(t,e){var i=e.define,o=e.require,r="function"==typeof i&&i.amd,n=!r&&"undefined"!=typeof exports;if(!r&&!i){var a={};i=e.define=function(t,e,i){"function"==typeof i?(a[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),o=t.split("/");i.pop();for(var r=0;r<o.length;r++)"."!=o[r]&&(".."==o[r]?i.pop():i.push(o[r]));return i.join("/")}(e,t)}),resolved:!1,exports:null},o(t)):a[t]={factory:null,resolved:!0,exports:i}},o=e.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var i=a[t];if(!i.resolved){var r=[];i.deps.forEach(function(t){r.push(o(t))}),i.exports=i.factory.apply(e,r)||null,i.resolved=!0}return i.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t([],function(){"use strict";var e={},i={exports:{}};function o(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var e;for(e in t)return!1;return!0}(t)}return t(["skylark-jquery","./_extend","./Module","./hotkeys","./uploader","./Util","./InputManager","./Selection","./UndoManager","./Keystroke","./Formatter","./Toolbar","./Indentation","./Clipboard","./i18n"],function(t,e,i,o,r,n,a,s,l,d,u,p,h,c,f){var m=i.inherit({});return m.connect(n),m.connect(a),m.connect(s),m.connect(l),m.connect(d),m.connect(u),m.connect(p),m.connect(h),m.connect(c),m.count=0,m.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,indentWidth:40},m.prototype._init=function(){var e,i,n;if(this.textarea=t(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("simditor: param textarea is required.");if(null!=(e=this.textarea.data("simditor"))&&e.destroy(),this.id=++m.count,this._render(),!o)throw new Error("simditor: simple-hotkeys is required.");if(this.hotkeys=o({el:this.body}),this.opts.upload&&r&&(i="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=r(i)),this.on("initialized",(n=this,function(){if(n.opts.placeholder&&n.on("valuechanged",function(){return n._placeholder()}),n.setValue(n.textarea.val().trim()||""),n.textarea.attr("autofocus"))return n.focus()})),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){t}}},m.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',m.prototype._render=function(){var e,i,o,r;if(this.el=t(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.data("simditor",this),this.wrapper.append(this.textarea),this.textarea.data("simditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile"),this.opts.params){for(e in i=this.opts.params,o=[],i)r=i[e],o.push(t("<input/>",{type:"hidden",name:e,value:r}).insertAfter(this.textarea));return o}},m.prototype._placeholder=function(){var t;return 0===(t=this.body.children()).length||1===t.length&&this.util.isEmptyNode(t)&&parseInt(t.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},m.prototype.setValue=function(t){return this.hidePopover(),this.textarea.val(t),this.body.get(0).innerHTML=t,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},m.prototype.getValue=function(){return this.sync()},m.prototype.sync=function(){var e,i,o,r,n,a;for(i=this.body.clone(),this.formatter.undecorate(i),this.formatter.format(i),this.formatter.autolink(i),e=i.children(),n=e.last("p"),r=e.first("p");n.is("p")&&this.util.isEmptyNode(n);)o=n,n=n.prev("p"),o.remove();for(;r.is("p")&&this.util.isEmptyNode(r);)o=r,r=n.next("p"),o.remove();return i.find("img.uploading").remove(),a=t.trim(i.html()),this.textarea.val(a),a},m.prototype.focus=function(){var e,i;if(this.body.is(":visible")&&this.body.is("[contenteditable]"))return this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):((e=this.body.children().last()).is("p")||(e=t("<p/>").append(this.util.phBr).appendTo(this.body)),i=document.createRange(),this.selection.setRangeAtEndOf(e,i));this.el.find("textarea:visible").focus()},m.prototype.blur=function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},m.prototype.hidePopover=function(){return this.el.find(".simditor-popover").each(function(e,i){if((i=t(i).data("popover")).active)return i.hide()})},m.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),t(document).off(".simditor-"+this.id),t(window).off(".simditor-"+this.id),this.off()},m.i18n=f,m}),o(i.exports)?i.exports:o(e)?e:void 0}),t("skylark-simditor/Simditor",function(){}),t("skylark-simditor/_extend",[],function(){var t={}.hasOwnProperty;return function(e,i){for(var o in i)t.call(i,o)&&(e[o]=i[o]);function r(){this.constructor=e}return r.prototype=i.prototype,e.prototype=new r,e.__super__=i.prototype,e}}),t("skylark-simditor/Module",["skylark-langx/langx","skylark-jquery"],function(t,e){var i=t.Evented.inherit({init:function(t){var i,o,r,n,a,s,l;if(this.opts=e.extend({},this.opts,t),(i=this.constructor)._connectedClasses||(i._connectedClasses=[]),a=function(){var t,e,i,r;for(i=this.constructor._connectedClasses,r=[],t=0,e=i.length;t<e;t++)o=i[t],l=o.pluginName.charAt(0).toLowerCase()+o.pluginName.slice(1),o.prototype._connected&&(o.prototype._module=this),r.push(this[l]=new o);return r}.call(this),this._connected)this.opts=e.extend({},this.opts,this._module.opts);else for(this._init(),r=0,s=a.length;r<s;r++)"function"==typeof(n=a[r])._init&&n._init();this.trigger("initialized")}});return i.extend=function(t){var e,i,o;if(null!=t&&"object"==typeof t){for(e in t)o=t[e],"included"!==e&&"extended"!==e&&(this[e]=o);return null!=(i=t.extended)?i.call(this):void 0}},i.include=function(t){var e,i,o;if(null!=t&&"object"==typeof t){for(e in t)o=t[e],"included"!==e&&"extended"!==e&&(this.prototype[e]=o);return null!=(i=t.included)?i.call(this):void 0}},i.connect=function(t){if("function"==typeof t){if(!t.pluginName)throw new Error("Module.connect: cannot connect plugin without pluginName");return t.prototype._connected=!0,this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(t),t.pluginName?this[t.pluginName]=t:void 0}},i.prototype.opts={},i.prototype._init=function(){},i.prototype.triggerHandler=i.prototype.trigger=function(e,i){var o;return o=[e],i&&(o=o.concat(i)),t.Evented.prototype.trigger.apply(this,o),this},i.prototype._t=function(){var t,e;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],(e=this.constructor)._t.apply(e,t)},i._t=function(){var t,e,i,o;return e=arguments[0],t=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],o=(null!=(i=this.i18n[this.locale])?i[e]:void 0)||"",t.length>0?(o=o.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(e,i,o){return o?i+t[parseInt(o)-1]:i+t.shift()})).replace(/%%s/g,"%s"):o},i.i18n={"zh-CN":{}},i.locale="zh-CN",i}),t("skylark-simditor/Button",["skylark-jquery","./_extend","./Module","./Simditor"],function(t,e,i,o){var r=i.inherit({init:function(t){this.editor=t.editor,this.title=this._t(this.name),i.prototype.init.call(this,t)}});return r.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},r.prototype.name="",r.prototype.icon="",r.prototype.title="",r.prototype.text="",r.prototype.htmlTag="",r.prototype.disableTag="",r.prototype.menu=!1,r.prototype.active=!1,r.prototype.disabled=!1,r.prototype.needFocus=!0,r.prototype.shortcut=null,r.prototype._init=function(){var e,i,o,r,n;for(this.render(),this.el.on("mousedown",(n=this,function(t){var e,i;return t.preventDefault(),e=n.needFocus&&!n.editor.inputManager.focused,!n.el.hasClass("disabled")&&(e&&n.editor.focus(),n.menu?(n.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),n.wrapper.is(".menu-on")&&(n.menuWrapper.offset().left+n.menuWrapper.outerWidth()+5-n.editor.wrapper.offset().left-n.editor.wrapper.outerWidth()>0&&n.menuWrapper.css({left:"auto",right:0}),n.trigger("menuexpand")),!1):(i=n.el.data("param"),n.command(i),!1))})),this.wrapper.on("click","a.menu-item",function(e){return function(i){var o,r,n;return i.preventDefault(),o=t(i.currentTarget),e.wrapper.removeClass("menu-on"),r=e.needFocus&&!e.editor.inputManager.focused,!o.hasClass("disabled")&&!r&&(e.editor.toolbar.wrapper.removeClass("menu-on"),n=o.data("param"),e.command(n),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(t){return!1}),this.editor.on("blur",function(t){return function(){if(t.editor.body.is(":visible")&&t.editor.body.is("[contenteditable]")&&!t.editor.clipboard.pasting)return t.setActive(!1),t.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.hotkeys.add(this.shortcut,function(t){return function(e){return t.el.mousedown(),!1}}(this)),o=this.htmlTag.split(","),e=0,i=o.length;e<i;e++)r=o[e],(r=t.trim(r))&&t.inArray(r,this.editor.formatter._allowedTags)<0&&this.editor.formatter._allowedTags.push(r);return this.editor.on("selectionchanged",function(t){return function(e){if(t.editor.inputManager.focused)return t._status()}}(this))},r.prototype.iconClassOf=function(t){return t?"simditor-icon simditor-icon-"+t:""},r.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},r.prototype.render=function(){if(this.wrapper=t(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=t(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},r.prototype.renderMenu=function(){var e,i,o,r,n,a,s,l;if(t.isArray(this.menu)){for(this.menuEl=t("<ul/>").appendTo(this.menuWrapper),a=this.menu,l=[],o=0,r=a.length;o<r;o++)"|"!==(n=a[o])?(i=t(this._tpl.menuItem).appendTo(this.menuEl),e=i.find("a.menu-item").attr({title:null!=(s=n.title)?s:n.text,"data-param":n.param}).addClass("menu-item-"+n.name),n.icon?l.push(e.find("span").addClass(this.iconClassOf(n.icon))):l.push(e.find("span").text(n.text))):t(this._tpl.separator).appendTo(this.menuEl);return l}},r.prototype.setActive=function(t){if(t!==this.active)return this.active=t,this.el.toggleClass("active",this.active)},r.prototype.setDisabled=function(t){if(t!==this.disabled)return this.disabled=t,this.el.toggleClass("disabled",this.disabled)},r.prototype._disableStatus=function(){var t,e,i;return i=this.editor.selection.startNodes(),e=this.editor.selection.endNodes(),t=i.filter(this.disableTag).length>0||e.filter(this.disableTag).length>0,this.setDisabled(t),this.disabled&&this.setActive(!1),this.disabled},r.prototype._activeStatus=function(){var t,e,i,o,r;return r=this.editor.selection.startNodes(),i=this.editor.selection.endNodes(),o=r.filter(this.htmlTag),e=i.filter(this.htmlTag),t=o.length>0&&e.length>0&&o.is(e),this.node=t?o:null,this.setActive(t),this.active},r.prototype._status=function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},r.prototype.command=function(t){},r.prototype._t=function(){var t,e,o;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],(o=i.prototype._t.apply(this,t))||(o=(e=this.editor)._t.apply(e,t)),o},o.Button=r,r}),t("skylark-simditor/Popover",["skylark-jquery","./_extend","./Module","./Simditor"],function(t,e,i,o){var r=i.inherit({init:function(t){this.button=t.button,this.editor=t.button.editor,i.prototype.init.call(this,t)}});return r.prototype.offset={top:4,left:0},r.prototype.target=null,r.prototype.active=!1,r.prototype._init=function(){var e;return this.el=t('<div class="simditor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",(e=this,function(t){return e.el.addClass("hover")})),this.el.on("mouseleave",function(t){return function(e){return t.el.removeClass("hover")}}(this))},r.prototype.render=function(){},r.prototype._initLabelWidth=function(){var e,i;if((e=this.el.find(".settings-field")).length>0)return this._labelWidth=0,e.each((i=this,function(e,o){var r,n;if(r=t(o),(n=r.find("label")).length>0)return i._labelWidth=Math.max(i._labelWidth,n.width())})),e.find("label").width(this._labelWidth)},r.prototype.show=function(e,i){if(null==i&&(i="bottom"),null!=e)return this.el.siblings(".simditor-popover").each(function(e,i){if((i=t(i).data("popover")).active)return i.hide()}),this.active&&this.target&&this.target.removeClass("selected"),this.target=e.addClass("selected"),this.active?(this.refresh(i),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.util.reflow(),this.refresh(i),this.trigger("popovershow"))},r.prototype.hide=function(){if(this.active)return this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")},r.prototype.refresh=function(t){var e,i,o,r,n,a;if(null==t&&(t="bottom"),this.active)return e=this.editor.el.offset(),n=this.target.offset(),r=this.target.outerHeight(),"bottom"===t?a=n.top-e.top+r:"top"===t&&(a=n.top-e.top-this.el.height()),o=this.editor.wrapper.width()-this.el.outerWidth()-10,i=Math.min(n.left-e.left,o),this.el.css({top:a+this.offset.top,left:i+this.offset.left})},r.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},r.prototype._t=function(){var t,e,o;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],(o=i.prototype._t.apply(this,t))||(o=(e=this.button)._t.apply(e,t)),o},o.Popover=r,r}),t("skylark-simditor/Toolbar",["skylark-jquery","./_extend","./Module"],function(t,e,i){var o=i.inherit({});return o.pluginName="Toolbar",o.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},o.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},o.prototype._init=function(){var e,i,o,r;if(this.editor=this._module,this.opts.toolbar)return t.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(t){return!1}),this.wrapper.on("mousedown",(r=this,function(t){return r.list.find(".menu-on").removeClass(".menu-on")})),t(document).on("mousedown.simditor"+this.editor.id,function(t){return function(e){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css("top",this.opts.toolbarFloatOffset),o=0,i=function(t){return function(){return t.wrapper.css("position","static"),t.wrapper.width("auto"),t.editor.util.reflow(t.wrapper),t.wrapper.width(t.wrapper.outerWidth()),t.wrapper.css("left",t.editor.util.os.mobile?t.wrapper.position().left:t.wrapper.offset().left),t.wrapper.css("position",""),o=t.wrapper.outerHeight(),t.editor.placeholderEl.css("top",o),!0}}(this),e=null,t(window).on("resize.simditor-"+this.editor.id,function(t){return e=i()}),t(window).on("scroll.simditor-"+this.editor.id,function(r){return function(n){var a,s,l;if(r.wrapper.is(":visible"))if(l=r.editor.wrapper.offset().top,a=l+r.editor.wrapper.outerHeight()-80,(s=t(document).scrollTop()+r.opts.toolbarFloatOffset)<=l||s>=a){if(r.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),r.editor.util.os.mobile)return r.wrapper.css("top",r.opts.toolbarFloatOffset)}else if(e||(e=i()),r.editor.wrapper.addClass("toolbar-floating").css("padding-top",o),r.editor.util.os.mobile)return r.wrapper.css("top",s-l+r.opts.toolbarFloatOffset)}}(this))),this.editor.on("destroy",function(t){return function(){return t.buttons.length=0}}(this)),t(document).on("mousedown.simditor-"+this.editor.id,function(t){return function(e){return t.list.find("li.menu-on").removeClass("menu-on")}}(this))},o.prototype._render=function(){var e,i,o,r;for(this.buttons=[],this.wrapper=t(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),r=this.opts.toolbar,e=0,i=r.length;e<i;e++)if("|"!==(o=r[e])){if(!this.constructor.buttons[o])throw new Error("simditor: invalid toolbar button "+o);this.buttons.push(new this.constructor.buttons[o]({editor:this.editor}))}else t(this._tpl.separator).appendTo(this.list);if(this.opts.toolbarHidden)return this.wrapper.hide()},o.prototype.findButton=function(t){var e;return null!=(e=this.list.find(".toolbar-item-"+t).data("button"))?e:null},o.addButton=function(t){return this.buttons[t.prototype.name]=t},o.buttons={},o}),t("skylark-simditor/buttons/AlignmentButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="alignment",a.prototype.icon="align-left",a.prototype.htmlTag="p, h1, h2, h3, h4, td, th",a.prototype._init=function(){return this.menu=[{name:"left",text:this._t("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:this._t("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:this._t("alignRight"),icon:"align-right",param:"right"}],n.prototype._init.call(this)},a.prototype.setActive=function(t,e){return null==e&&(e="left"),"left"!==e&&"center"!==e&&"right"!==e&&(e="left"),"left"===e?n.prototype.setActive.call(this,!1):n.prototype.setActive.call(this,t),this.el.removeClass("align-left align-center align-right"),t&&this.el.addClass("align-"+e),this.setIcon("align-"+e),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+e).hide()},a.prototype._status=function(){return this.nodes=this.editor.selection.nodes().filter(this.htmlTag),this.nodes.length<1?(this.setDisabled(!0),this.setActive(!1)):(this.setDisabled(!1),this.setActive(!0,this.nodes.first().css("text-align")))},a.prototype.command=function(t){if("left"!==t&&"center"!==t&&"right"!==t)throw new Error("simditor alignment button: invalid align "+t);return this.nodes.css({"text-align":"left"===t?"":t}),this.editor.trigger("valuechanged"),this.editor.inputManager.throttledSelectionChanged()},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/BlockquoteButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="blockquote",a.prototype.icon="quote-left",a.prototype.htmlTag="blockquote",a.prototype.disableTag="pre, table",a.prototype.command=function(){var e,i,o,r;return e=(e=this.editor.selection.rootNodes()).filter(function(e,i){return!t(i).parent().is("blockquote")}),this.editor.selection.save(),o=[],r=this,i=function(){if(o.length>0)return t("<"+r.htmlTag+"/>").insertBefore(o[0]).append(o),o.length=0},e.each(function(e){return function(r,n){var a;if((a=t(n)).parent().is(e.editor.body))return a.is(e.htmlTag)?(i(),a.children().unwrap()):a.is(e.disableTag)||e.editor.util.isDecoratedNode(a)?i():o.push(n)}}(this)),i(),this.editor.selection.restore(),this.editor.trigger("valuechanged")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/BoldButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="bold",a.prototype.icon="bold",a.prototype.htmlTag="b, strong",a.prototype.disableTag="pre",a.prototype.shortcut="cmd+b",a.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),n.prototype._init.call(this)},a.prototype._activeStatus=function(){var t;return t=!0===document.queryCommandState("bold"),this.setActive(t),this.active},a.prototype.command=function(){return document.execCommand("bold"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/CodePopover",["skylark-jquery","../_extend","../Module","../Popover"],function(t,e,i,o){var r=o.inherit({});return r.prototype.render=function(){var e,i,o,r,n;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"</option>\n    </select>\n  </div>\n</div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),r=this.langs,e=0,o=r.length;e<o;e++)i=r[e],t("<option/>",{text:i.name,value:i.value}).appendTo(this.selectEl);return this.selectEl.on("change",(n=this,function(t){var e;return n.lang=n.selectEl.val(),e=n.target.hasClass("selected"),n.target.removeClass().removeAttr("data-lang"),-1!==n.lang&&n.target.attr("data-lang",n.lang),e&&n.target.addClass("selected"),n.editor.trigger("valuechanged")})),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this))},r.prototype.show=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],o.prototype.show.apply(this,t),this.lang=this.target.attr("data-lang"),null!=this.lang?this.selectEl.val(this.lang):this.selectEl.val(-1)},r}),t("skylark-simditor/buttons/CodeButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button","./CodePopover"],function(t,e,i,o,r,n,a){var s=n.inherit({});return s.prototype.name="code",s.prototype.icon="code",s.prototype.htmlTag="pre",s.prototype.disableTag="ul, ol, table",s.prototype._init=function(){var e;return n.prototype._init.call(this),this.editor.on("decorate",(e=this,function(i,o){return o.find("pre").each(function(i,o){return e.decorate(t(o))})})),this.editor.on("undecorate",function(e){return function(i,o){return o.find("pre").each(function(i,o){return e.undecorate(t(o))})}}(this))},s.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.render.apply(this,t),this.popover=new a({button:this})},s.prototype._checkMode=function(){var e;return e=this.editor.selection.range(),t(e.cloneContents()).find(this.editor.util.blockNodes.join(","))>0||e.collapsed&&0===this.editor.selection.startNodes().filter("code").length?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},s.prototype._status=function(){if(this._checkMode(),n.prototype._status.call(this),!this.inlineMode)return this.active?this.popover.show(this.node):this.popover.hide()},s.prototype.decorate=function(t){var e,i,o,r;if((e=t.find("> code")).length>0&&(i=null!=(o=e.attr("class"))&&null!=(r=o.match(/lang-(\S+)/))?r[1]:void 0,e.contents().unwrap(),i))return t.attr("data-lang",i)},s.prototype.undecorate=function(e){var i,o;return o=e.attr("data-lang"),i=t("<code/>"),o&&-1!==o&&i.addClass("lang-"+o),e.wrapInner(i).removeAttr("data-lang")},s.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},s.prototype._blockCommand=function(){var e,i,o,r,n;return e=this.editor.selection.rootNodes(),o=[],r=[],n=this,i=function(){var e;if(o.length>0)return e=t("<"+n.htmlTag+"/>").insertBefore(o[0]).text(n.editor.formatter.clearHtml(o)),r.push(e[0]),o.length=0},e.each(function(e){return function(n,a){var s,l;return(s=t(a)).is(e.htmlTag)?(i(),l=t("<p/>").append(s.html().replace("\n","<br/>")).replaceAll(s),r.push(l[0])):s.is(e.disableTag)||e.editor.util.isDecoratedNode(s)||s.is("blockquote")?i():o.push(a)}}(this)),i(),this.editor.selection.setRangeAtEndOf(t(r).last()),this.editor.trigger("valuechanged")},s.prototype._inlineCommand=function(){var e,i,o;return o=this.editor.selection.range(),this.active?(o.selectNodeContents(this.node[0]),this.editor.selection.save(o),this.node.contents().unwrap(),this.editor.selection.restore()):(i=t(o.extractContents()),e=t("<"+this.htmlTag+"/>").append(i.contents()),o.insertNode(e[0]),o.selectNodeContents(e[0]),this.editor.selection.range(o)),this.editor.trigger("valuechanged")},r.Toolbar.addButton(s),s}),t("skylark-simditor/buttons/ColorButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="color",a.prototype.icon="tint",a.prototype.disableTag="pre",a.prototype.menu=!0,a.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.render.apply(this,t)},a.prototype.renderMenu=function(){return t('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default"></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(t){return!1}),this.menuWrapper.on("click",".font-color",(e=this,function(i){var o,r,n,a,s,l;if(e.wrapper.removeClass("menu-on"),(o=t(i.currentTarget)).hasClass("font-color-default")){if(!((r=e.editor.body.find("p, li")).length>0))return;s=window.getComputedStyle(r[0],null).getPropertyValue("color"),n=e._convertRgbToHex(s)}else s=window.getComputedStyle(o[0],null).getPropertyValue("background-color"),n=e._convertRgbToHex(s);if(n)return a=e.editor.selection.range(),!o.hasClass("font-color-default")&&a.collapsed&&(l=document.createTextNode(e._t("coloredText")),a.insertNode(l),a.selectNodeContents(l)),e.editor.selection.range(a),document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,n),document.execCommand("styleWithCSS",!1,!1),e.editor.util.support.oninput?void 0:e.editor.trigger("valuechanged")}));var e},a.prototype._convertRgbToHex=function(t){var e;return(e=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g.exec(t))?function(t,e,i){var o;return"#"+(o=function(t){var e;return 1===(e=t.toString(16)).length?"0"+e:e})(t)+o(e)+o(i)}(1*e[1],1*e[2],1*e[3]):""},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/FontScaleButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="fontScale",a.prototype.icon="font",a.prototype.htmlTag="span",a.prototype.disableTag="pre, h1, h2, h3, h4, h5",a.prototype.sizeMap={"x-large":"1.5em",large:"1.25em",small:".75em","x-small":".5em"},a.prototype._init=function(){return this.menu=[{name:"150%",text:this._t("fontScaleXLarge"),param:"5"},{name:"125%",text:this._t("fontScaleLarge"),param:"4"},{name:"100%",text:this._t("fontScaleNormal"),param:"3"},{name:"75%",text:this._t("fontScaleSmall"),param:"2"},{name:"50%",text:this._t("fontScaleXSmall"),param:"1"}],n.prototype._init.call(this)},a.prototype._activeStatus=function(){var t,e,i,o,r;return this.editor.selection.range(),r=this.editor.selection.startNodes(),i=this.editor.selection.endNodes(),o=r.filter('span[style*="font-size"]'),e=i.filter('span[style*="font-size"]'),t=r.length>0&&i.length>0&&o.is(e),this.setActive(t),this.active},a.prototype.command=function(e){var i,o,r;if(!(o=this.editor.selection.range()).collapsed)return this.editor.selection.range(o),document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,e),document.execCommand("styleWithCSS",!1,!1),this.editor.selection.reset(),this.editor.selection.range(),i=this.editor.selection.containerNode(),(i[0].nodeType===Node.TEXT_NODE?i.closest('span[style*="font-size"]'):i.find('span[style*="font-size"]')).each((r=this,function(e,i){var o,n;return o=t(i),n=i.style.fontSize,/large|x-large|small|x-small/.test(n)?o.css("fontSize",r.sizeMap[n]):"medium"===n?o[0].style.length>1?o.css("fontSize",""):o.replaceWith(o.contents()):void 0})),this.editor.trigger("valuechanged")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/HrButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="hr",a.prototype.icon="minus",a.prototype.htmlTag="hr",a.prototype._status=function(){},a.prototype.command=function(){var e,i,o;return o=this.editor.selection.rootNodes().first(),o.next().length>0?this.editor.selection.save():i=t("<p/>").append(this.editor.util.phBr),e=t("<hr/>").insertAfter(o),i?(i.insertAfter(e),this.editor.selection.setRangeAtStartOf(i)):this.editor.selection.restore(),this.editor.trigger("valuechanged")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/ImagePopover",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Popover"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.offset={top:6,left:-4},a.prototype.render=function(){var e,i;return e='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass("image-popover").append(e),this.srcEl=this.el.find(".image-src"),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.altEl=this.el.find("#image-alt"),this.srcEl.on("keydown",(i=this,function(t){var e;if(13===t.which&&!i.target.hasClass("uploading"))return t.preventDefault(),e=document.createRange(),i.button.editor.selection.setRangeAfter(i.target,e),i.hide()})),this.srcEl.on("blur",function(t){return function(e){return t._loadImage(t.srcEl.val())}}(this)),this.el.find(".image-size").on("blur",function(e){return function(i){return e._resizeImg(t(i.currentTarget)),e.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(e){return function(i){var o;if(o=t(i.currentTarget),13!==i.which&&27!==i.which&&9!==i.which)return e._resizeImg(o,!0)}}(this)),this.el.find(".image-size").on("keydown",function(e){return function(i){var o,r,n;return r=t(i.currentTarget),13===i.which||27===i.which?(i.preventDefault(),13===i.which?e._resizeImg(r):e._restoreImg(),o=e.target,e.hide(),n=document.createRange(),e.button.editor.selection.setRangeAfter(o,n)):9===i.which?e.el.data("popover").refresh():void 0}}(this)),this.altEl.on("keydown",function(t){return function(e){var i;if(13===e.which)return e.preventDefault(),i=document.createRange(),t.button.editor.selection.setRangeAfter(t.target,i),t.hide()}}(this)),this.altEl.on("keyup",function(t){return function(e){if(13!==e.which&&27!==e.which&&9!==e.which)return t.alt=t.altEl.val(),t.target.attr("alt",t.alt)}}(this)),this.el.find(".btn-restore").on("click",function(t){return function(e){return t._restoreImg(),t.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this)),this._initUploader()},a.prototype._initUploader=function(){var e,i,o;if(e=this.el.find(".btn-upload"),null!=this.editor.uploader)return o=this,(i=function(){return o.input&&o.input.remove(),o.input=t("<input/>",{type:"file",title:o._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(e)})(),this.el.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),this.el.on("change","input[type=file]",function(t){return function(e){return t.editor.uploader.upload(t.input,{inline:!0,img:t.target}),i()}}(this));e.remove()},a.prototype._resizeImg=function(e,i){var o,r,n;if(null==i&&(i=!1),r=1*e.val(),this.target&&(t.isNumeric(r)||r<0))return e.is(this.widthEl)?(n=r,o=this.height*r/this.width,this.heightEl.val(o)):(o=r,n=this.width*r/this.height,this.widthEl.val(n)),i?void 0:(this.target.attr({width:n,height:o}),this.editor.trigger("valuechanged"))},a.prototype._restoreImg=function(){var t,e;return e=(null!=(t=this.target.data("image-size"))?t.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*e[0],height:1*e[1]}),this.widthEl.val(e[0]),this.heightEl.val(e[1]),this.editor.trigger("valuechanged")},a.prototype._loadImage=function(t,e){var i;if(!/^data:image/.test(t)||this.editor.uploader){if(this.target.attr("src")!==t)return this.button.loadImage(this.target,t,(i=this,function(o){var r;if(o)return i.active&&(i.width=o.width,i.height=o.height,i.widthEl.val(i.width),i.heightEl.val(i.height)),/^data:image/.test(t)?((r=i.editor.util.dataURLtoBlob(t)).name="Base64 Image.png",i.editor.uploader.upload(r,{inline:!0,img:i.target})):i.editor.trigger("valuechanged"),e?e(o):void 0}))}else e&&e(!1)},a.prototype.show=function(){var t,e;return e=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.show.apply(this,e),t=this.target,this.width=t.width(),this.height=t.height(),this.alt=t.attr("alt"),t.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(t.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},a}),t("skylark-simditor/buttons/ImageButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button","./ImagePopover"],function(t,e,i,o,r,n,a){var s=n.inherit({});return s.prototype.name="image",s.prototype.icon="picture-o",s.prototype.htmlTag="img",s.prototype.disableTag="pre, table",s.prototype.defaultImage="",s.prototype.needFocus=!1,s.prototype._init=function(){var e,i,o,r,a;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],r=this.editor.opts.imageButton,i=0,o=r.length;i<o;i++)e=r[i],this.menu.push({name:e+"-image",text:this._t(e+"Image")});else this.menu=!1;else null!=this.editor.uploader?this.menu=[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",(a=this,function(e){var i,o;return i=t(e.currentTarget),(o=document.createRange()).selectNode(i[0]),a.editor.selection.range(o),a.editor.util.support.onselectionchange||a.editor.trigger("selectionchanged"),!1})),this.editor.body.on("mouseup","img:not([data-non-image])",function(t){return!1}),this.editor.on("selectionchanged.image",function(e){return function(){var i,o,r;if(null!=(r=e.editor.selection.range()))return 1===(i=t(r.cloneContents()).contents()).length&&i.is("img:not([data-non-image])")?(o=t(r.startContainer).contents().eq(r.startOffset),e.popover.show(o)):e.popover.hide()}}(this)),this.editor.on("valuechanged.image",function(e){return function(){var i;if((i=e.editor.wrapper.find(".simditor-image-loading")).length>0)return i.each(function(i,o){var r,n,a;if(n=t(o),!((r=n.data("img"))&&r.parent().length>0)&&(n.remove(),r&&(a=r.data("file"))&&(e.editor.uploader.cancel(a),e.editor.body.find("img.uploading").length<1)))return e.editor.uploader.trigger("uploadready",[a])})}}(this)),n.prototype._init.call(this)},s.prototype.render=function(){var t;if(t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.render.apply(this,t),this.popover=new a({button:this}),"upload"===this.editor.opts.imageButton)return this._initUploader(this.el)},s.prototype.renderMenu=function(){return n.prototype.renderMenu.call(this),this._initUploader()},s.prototype._initUploader=function(e){var i,o,r,n;if(null==e&&(e=this.menuEl.find(".menu-item-upload-image")),null!=this.editor.uploader)return i=null,n=this,(o=function(){return i&&i.remove(),i=t("<input/>",{type:"file",title:n._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(e)})(),e.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),e.on("change","input[type=file]",function(t){return function(e){return t.editor.inputManager.focused?(t.editor.uploader.upload(i,{inline:!0}),o()):(t.editor.one("focus",function(e){return t.editor.uploader.upload(i,{inline:!0}),o()}),t.editor.focus()),t.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(e){return function(i,o){var r;if(o.inline)return o.img?r=t(o.img):(r=e.createImage(o.name),o.img=r),r.addClass("uploading"),r.data("file",o),e.editor.uploader.readImageFile(o.obj,function(t){var i;if(r.hasClass("uploading"))return i=t?t.src:e.defaultImage,e.loadImage(r,i,function(){if(e.popover.active)return e.popover.refresh(),e.popover.srcEl.val(e._t("uploading")).prop("disabled",!0)})})}}(this)),r=t.proxy(this.editor.util.throttle(function(t,e,i,o){var r,n,a;if(e.inline&&(n=e.img.data("mask"))){if((r=n.data("img")).hasClass("uploading")&&r.parent().length>0)return(a=(100*(a=i/o)).toFixed(0))>99&&(a=99),n.find(".progress").height(100-a+"%");n.remove()}},500),this),this.editor.uploader.on("uploadprogress",r),this.editor.uploader.on("uploadsuccess",function(e){return function(i,o,r){var n,a,s;if(o.inline&&(n=o.img).hasClass("uploading")&&n.parent().length>0){if("object"!=typeof r)try{r=t.parseJSON(r)}catch(t){t,r={success:!1}}return!1===r.success?(s=r.msg||e._t("uploadFailed"),alert(s),a=e.defaultImage):a=r.file_path,e.loadImage(n,a,function(){var t;if(n.removeData("file"),n.removeClass("uploading").removeClass("loading"),(t=n.data("mask"))&&t.remove(),n.removeData("mask"),e.editor.trigger("valuechanged"),e.editor.body.find("img.uploading").length<1)return e.editor.uploader.trigger("uploadready",[o,r])}),e.popover.active?(e.popover.srcEl.prop("disabled",!1),e.popover.srcEl.val(r.file_path)):void 0}}}(this)),this.editor.uploader.on("uploaderror",function(e){return function(i,o,r){var n,a;if(o.inline&&"abort"!==r.statusText){if(r.responseText)try{a=t.parseJSON(r.responseText),a.msg}catch(t){t,e._t("uploadError")}if((n=o.img).hasClass("uploading")&&n.parent().length>0)return e.loadImage(n,e.defaultImage,function(){var t;return n.removeData("file"),n.removeClass("uploading").removeClass("loading"),(t=n.data("mask"))&&t.remove(),n.removeData("mask")}),e.popover.active&&(e.popover.srcEl.prop("disabled",!1),e.popover.srcEl.val(e.defaultImage)),e.editor.trigger("valuechanged"),e.editor.body.find("img.uploading").length<1?e.editor.uploader.trigger("uploadready",[o,a]):void 0}}}(this));this.el.find(".btn-upload").remove()},s.prototype._status=function(){return this._disableStatus()},s.prototype.loadImage=function(e,i,o){var r,n,a,s;return s=this,a=function(){var t,i;return t=e.offset(),i=s.editor.wrapper.offset(),r.css({top:t.top-i.top,left:t.left-i.left,width:e.width(),height:e.height()}).show()},e.addClass("loading"),(r=e.data("mask"))||(r=t('<div class="simditor-image-loading">\n  <div class="progress"></div>\n</div>').hide().appendTo(this.editor.wrapper),a(),e.data("mask",r),r.data("img",e)),(n=new Image).onload=function(s){return function(){var l,d;if(e.hasClass("loading")||e.hasClass("uploading"))return d=n.width,l=n.height,e.attr({src:i,width:d,height:l,"data-image-size":d+","+l}).removeClass("loading"),e.hasClass("uploading")?(s.editor.util.reflow(s.editor.body),a()):(r.remove(),e.removeData("mask")),t.isFunction(o)?o(n):void 0}}(this),n.onerror=function(){return t.isFunction(o)&&o(!1),r.remove(),e.removeData("mask").removeClass("loading")},n.src=i},s.prototype.createImage=function(e){var i,o;return null==e&&(e="Image"),this.editor.inputManager.focused||this.editor.focus(),(o=this.editor.selection.range()).deleteContents(),this.editor.selection.range(o),i=t("<img/>").attr("alt",e),o.insertNode(i[0]),this.editor.selection.setRangeAfter(i,o),this.editor.trigger("valuechanged"),i},s.prototype.command=function(t){var e,i;return e=this.createImage(),this.loadImage(e,t||this.defaultImage,(i=this,function(){return i.editor.trigger("valuechanged"),i.editor.util.reflow(e),e.click(),i.popover.one("popovershow",function(){return i.popover.srcEl.focus(),i.popover.srcEl[0].select()})}))},r.Toolbar.addButton(s),s}),t("skylark-simditor/buttons/IndentButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="indent",a.prototype.icon="indent",a.prototype._init=function(){var t;return t=!1===this.editor.opts.tabIndent?"":" (Tab)",this.title=this._t(this.name)+t,n.prototype._init.call(this)},a.prototype._status=function(){},a.prototype.command=function(){return this.editor.indentation.indent()},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/ItalicButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="italic",a.prototype.icon="italic",a.prototype.htmlTag="i",a.prototype.disableTag="pre",a.prototype.shortcut="cmd+i",a.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),n.prototype._init.call(this)},a.prototype._activeStatus=function(){var t;return t=!0===document.queryCommandState("italic"),this.setActive(t),this.active},a.prototype.command=function(){return document.execCommand("italic"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/LinkPopover",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Popover"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.render=function(){var e,i;return e='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("linkText")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'"\n      tabindex="-1">\n      <span class="simditor-icon simditor-icon-unlink"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkTarget")+'</label>\n    <select class="link-target">\n      <option value="_blank">'+this._t("openLinkInNewWindow")+' (_blank)</option>\n      <option value="_self">'+this._t("openLinkInCurrentWindow")+" (_self)</option>\n    </select>\n  </div>\n</div>",this.el.addClass("link-popover").append(e),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.selectTarget=this.el.find(".link-target"),this.textEl.on("keyup",(i=this,function(t){if(13!==t.which)return i.target.text(i.textEl.val()),i.editor.inputManager.throttledValueChanged()})),this.urlEl.on("keyup",function(t){return function(e){var i;if(13!==e.which)return i=t.urlEl.val(),!/^(http|https|ftp|ftps|file)?:\/\/|^(mailto|tel)?:|^\//gi.test(i)&&i&&(i="http://"+i),t.target.attr("href",i),t.editor.inputManager.throttledValueChanged()}}(this)),t([this.urlEl[0],this.textEl[0]]).on("keydown",function(e){return function(i){var o;if(13===i.which||27===i.which||!i.shiftKey&&9===i.which&&t(i.target).hasClass("link-url"))return i.preventDefault(),o=document.createRange(),e.editor.selection.setRangeAfter(e.target,o),e.hide(),e.editor.inputManager.throttledValueChanged()}}(this)),this.unlinkEl.on("click",function(t){return function(e){var i,o;return o=document.createTextNode(t.target.text()),t.target.replaceWith(o),t.hide(),i=document.createRange(),t.editor.selection.setRangeAfter(o,i),t.editor.inputManager.throttledValueChanged()}}(this)),this.selectTarget.on("change",function(t){return function(e){return t.target.attr("target",t.selectTarget.val()),t.editor.inputManager.throttledValueChanged()}}(this))},a.prototype.show=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.show.apply(this,t),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},a}),t("skylark-simditor/buttons/LinkButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button","./LinkPopover"],function(t,e,i,o,r,n,a){var s=n.inherit({});return s.prototype.name="link",s.prototype.icon="link",s.prototype.htmlTag="a",s.prototype.disableTag="pre",s.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.render.apply(this,t),this.popover=new a({button:this})},s.prototype._status=function(){return n.prototype._status.call(this),this.active&&!this.editor.selection.rangeAtEndOf(this.node)?this.popover.show(this.node):this.popover.hide()},s.prototype.command=function(){var e,i,o,r,n,a,s;return n=this.editor.selection.range(),this.active?(a=document.createTextNode(this.node.text()),this.node.replaceWith(a),n.selectNode(a)):(e=t(n.extractContents()),r=this.editor.formatter.clearHtml(e.contents(),!1),i=t("<a/>",{href:"",target:"_blank",text:r||this._t("linkText")}),this.editor.selection.blockNodes().length>0?n.insertNode(i[0]):(o=t("<p/>").append(i),n.insertNode(o[0])),n.selectNodeContents(i[0]),this.popover.one("popovershow",(s=this,function(){return r?(s.popover.urlEl.focus(),s.popover.urlEl[0].select()):(s.popover.textEl.focus(),s.popover.textEl[0].select())}))),this.editor.selection.range(n),this.editor.trigger("valuechanged")},r.Toolbar.addButton(s),s}),t("skylark-simditor/buttons/ListButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.type="",a.prototype.disableTag="pre, table",a.prototype.command=function(e){var i,o,r,n;return o=this.editor.selection.blockNodes(),r="ul"===this.type?"ol":"ul",this.editor.selection.save(),i=null,o.each((n=this,function(e,o){var a;if(!((a=t(o)).is("blockquote, li")||a.is(n.disableTag)||n.editor.util.isDecoratedNode(a))&&t.contains(document,o))return a.is(n.type)?(a.children("li").each(function(e,i){return t(i).children("ul, ol").insertAfter(a),t("<p/>").append(t(i).html()||n.editor.util.phBr).insertBefore(a)}),a.remove()):a.is(r)?t("<"+n.type+"/>").append(a.contents()).replaceAll(a):i&&a.prev().is(i)?(t("<li/>").append(a.html()||n.editor.util.phBr).appendTo(i),a.remove()):((i=t("<"+n.type+"><li></li></"+n.type+">")).find("li").append(a.html()||n.editor.util.phBr),i.replaceAll(a))})),this.editor.selection.restore(),this.editor.trigger("valuechanged")},a}),t("skylark-simditor/buttons/OrderListButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","./ListButton"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.type="ol",a.prototype.name="ol",a.prototype.icon="list-ol",a.prototype.htmlTag="ol",a.prototype.shortcut="cmd+/",a.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),n.prototype._init.call(this)},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/OutdentButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="outdent",a.prototype.icon="outdent",a.prototype._init=function(){var t;return t=!1===this.editor.opts.tabIndent?"":" (Shift + Tab)",this.title=this._t(this.name)+t,n.prototype._init.call(this)},a.prototype._status=function(){},a.prototype.command=function(){return this.editor.indentation.indent(!0)},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/StrikethroughButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="strikethrough",a.prototype.icon="strikethrough",a.prototype.htmlTag="strike",a.prototype.disableTag="pre",a.prototype._activeStatus=function(){var t;return t=!0===document.queryCommandState("strikethrough"),this.setActive(t),this.active},a.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},r.Toolbar.addButton(a),a}),t("skylark-utils-dom/tables",["./dom","./langx","./query"],function(t,e,i){function o(){return o}function r(t,e){return t.find("td, th").each(function(t,o){var r;return(r=i(o)).replaceWith("<"+e+">"+r.html()+"</"+e+">")})}function n(t,e){var o,r,n=i(t);r=n.closest(".simditor-table"),o=r.next("p"),r.remove(),e&&e(o)}function a(t){return setTimeout(function(){var e,o;return o=t.width(),e=t.find("col"),t.find("thead tr th").each(function(t,r){return e.eq(t).attr("width",i(r).outerWidth()/o*100+"%")})},0)}function s(t){var e=i(t);if(e.parent(".simditor-table").length>0)return e.parent().replaceWith(e)[0]}return e.mixin(o,{createTable:function(t,e,o){var r,n,a,s,l,d,u,p,h,c;for(r=i("<table/>"),s=i("<thead/>").appendTo(r),n=i("<tbody/>").appendTo(r),p=d=0,h=t;0<=h?d<h:d>h;p=0<=h?++d:--d)for((l=i("<tr/>")).appendTo(0===p?s:n),u=0,c=e;0<=c?u<c:u>c;0<=c?++u:--u)a=i(0===p?"<th/>":"<td/>").appendTo(l),o&&a.append(o);return r[0]},decorate:function(t,e){var o,n,l,d,u,p=i(t);p.parent("."+e.tableDecorate).length>0&&s(t);p.wrap('<div class="'+e.tableDecorate+'"></div>'),u=p.parent("."+e.tableDecorate),o=p.find("colgroup"),p.find("thead").length<1&&(d=i("<thead />"),n=p.find("tr").first(),d.append(n),r(n,"th"),(l=p.find("tbody")).length>0?l.before(d):p.prepend(d));o.length<1&&(o=i("<colgroup/>").prependTo(p),p.find("thead tr th").each(function(t,e){return i("<col/>").appendTo(o)}),a(p));return i("<div />",{class:e.resizeHandle,contenteditable:"false"}).appendTo(u),p.parent()},deleteCol:function(t,e){var o,r,s,l,d,u,p=i(t);if(s=p.parent("tr"),u=s.closest("table").find("tr").length<2,d=p.siblings("td, th").length<1,u&&d)return n(t);l=s.find("td, th").index(p),(o=p.next("td, th")).length>0||(o=s.prev("td, th")),(r=s.closest("table")).find("col").eq(l).remove(),r.find("tr").each(function(t,e){return i(e).find("td, th").eq(l).remove()}),a(r),e&&e(o[0])},deleteRow:function(t,e){var o,a,s,l=i(t);if((a=l.parent("tr")).closest("table").find("tr").length<1)return n(t);(o=function(t){var e;(e=t.next("tr")).length<1&&t.parent("thead").length>0&&(e=t.parent("thead").next("tbody").find("tr:first"));return e}(a)).length>0||(o=function(t){var e;(e=t.prev("tr")).length<1&&t.parent("tbody").length>0&&(e=t.parent("tbody").prev("thead").find("tr"));return e}(a)),s=a.find("td, th").index(l),a.parent().is("thead")&&(o.appendTo(a.parent()),r(o,"th")),a.remove(),e&&e(o[0],s)},deleteTable:n,insertCol:function(t,e,o,r){var n,s,l,d,u,p,h,c,f=i(t);null==e&&(e="after");u=f.parent("tr"),p=u.find("td, th").index(f),d=f.closest("table"),n=d.find("col").eq(p),d.find("tr").each(function(t,r){var n,a;return a=i(r).parent().is("thead")?"th":"td",n=i("<"+a+"/>").append(o),i(r).find("td, th").eq(p)[e](n)}),s=i("<col/>"),n[e](s),h=d.width(),c=Math.max(parseFloat(n.attr("width"))/2,50/h*100),n.attr("width",c+"%"),s.attr("width",c+"%"),a(d),l="after"===e?f.next("td, th"):f.prev("td, th"),r&&r(l[0])},insertRow:function(t,e,o,n){var a,s,l,d,u,p,h,c,f=i(t);null==e&&(e="after");l=f.parent("tr"),s=l.closest("table"),u=0,s.find("tr").each(function(t,e){return u=Math.max(u,i(e).find("td").length)}),p=l.find("td, th").index(f),a=i("<tr/>"),d="td","after"===e&&l.parent().is("thead")?l.parent().next("tbody").prepend(a):"before"===e&&l.parent().is("thead")?(l.before(a),l.parent().next("tbody").prepend(l),r(l,"td"),d="th"):l[e](a);for(h=1,c=u;1<=c?h<=c:h>=c;1<=c?++h:--h)i("<"+d+"/>").append(o).appendTo(a);n&&n(a[0],p)},refreshTableWidth:a,undecorate:s}),t.tables=o}),t("skylark-simditor/buttons/TableButton",["skylark-utils-dom/tables","skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n,a){var s=a.inherit({});return s.prototype.name="table",s.prototype.icon="table",s.prototype.htmlTag="table",s.prototype.disableTag="pre, li, blockquote",s.prototype.menu=!0,s.prototype._init=function(){var t;return a.prototype._init.call(this),e.merge(this.editor.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),e.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),e.extend(this.editor.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this._initResize(),this.editor.on("decorate",(t=this,function(i,o){return o.find("table").each(function(i,o){return t.decorate(e(o))})})),this.editor.on("undecorate",function(t){return function(i,o){return o.find("table").each(function(i,o){return t.undecorate(e(o))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(e){var i,o;if(t.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active"),o=t.editor.selection.range())return i=t.editor.selection.containerNode(),o.collapsed&&i.is(".simditor-table")&&t.editor.selection.setRangeAtEndOf(i),i.closest("td, th",t.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(t){return function(e){return t.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active")}}(this)),this.editor.keystroke.add("up","td",function(t){return function(e,i){return t._tdNav(i,"up"),!0}}(this)),this.editor.keystroke.add("up","th",function(t){return function(e,i){return t._tdNav(i,"up"),!0}}(this)),this.editor.keystroke.add("down","td",function(t){return function(e,i){return t._tdNav(i,"down"),!0}}(this)),this.editor.keystroke.add("down","th",function(t){return function(e,i){return t._tdNav(i,"down"),!0}}(this))},s.prototype._tdNav=function(t,e){var i,o,r,n,a;return null==e&&(e="up"),r="up"===e?"prev":"next",(a="up"===e?["tbody","thead"]:["thead","tbody"])[0],a[1],o=t.parent("tr"),!((i=this["_"+r+"Row"](o)).length>0)||(n=o.find("td, th").index(t),this.editor.selection.setRangeAtEndOf(i.find("td, th").eq(n)))},s.prototype._initResize=function(){var t;return t=this.editor,e(document).on("mousemove.simditor-table",".simditor-table td, .simditor-table th",function(t){var i,o,r,n,a,s,l,d;if(a=e(this).parents(".simditor-table"),r=a.find(".simditor-resize-handle"),o=a.find("colgroup"),!a.hasClass("resizing"))if(n=e(t.currentTarget),t.pageX-e(t.currentTarget).offset().left<5&&n.prev().length>0&&(n=n.prev()),n.next("td, th").length<1)r.hide();else if(null!=(l=r.data("td"))&&l.is(n))r.show();else{if(s=n.parent().find("td, th").index(n),i=o.find("col").eq(s),null==(d=r.data("col"))||!d.is(i))return r.css("left",n.position().left+n.outerWidth()-5).data("td",n).data("col",i).show();r.show()}}),e(document).on("mouseleave.simditor-table",".simditor-table",function(t){return e(this).find(".simditor-resize-handle").hide()}),e(document).on("mousedown.simditor-resize-handle",".simditor-resize-handle",function(i){var o,r,n,a,s,l,d,u,p,h,c;return l=e(this).parent(".simditor-table"),o=e(i.currentTarget),n=o.data("td"),r=o.data("col"),s=n.next("td, th"),a=r.next("col"),h=i.pageX,u=1*n.outerWidth(),p=1*s.outerWidth(),d=parseFloat(o.css("left")),c=n.closest("table").width(),50,e(document).on("mousemove.simditor-resize-table",function(t){var e,i,n;return e=t.pageX-h,n=p-e,(i=u+e)<50?(i=50,n=p-(e=50-u)):n<50&&(n=50,i=u+(e=p-50)),r.attr("width",i/c*100+"%"),a.attr("width",n/c*100+"%"),o.css("left",d+e)}),e(document).one("mouseup.simditor-resize-table",function(i){return t.sync(),e(document).off(".simditor-resize-table"),l.removeClass("resizing")}),l.addClass("resizing"),!1})},s.prototype._initShortcuts=function(){var t;return this.editor.hotkeys.add("ctrl+alt+up",(t=this,function(e){return t.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1})),this.editor.hotkeys.add("ctrl+alt+down",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+left",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+right",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},s.prototype.renderMenu=function(){var t,i;return e('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),t=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",(i=this,function(o){var r,n,a,s;return i.createMenu.find("td, th").removeClass("selected"),r=e(o.currentTarget),n=r.parent(),s=n.find("td, th").index(r)+1,a=n.prevAll("tr").addBack(),n.parent().is("tbody")&&(a=a.add(t.find("thead tr"))),a.find("td:lt("+s+"), th:lt("+s+")").addClass("selected")})),this.createMenu.on("mouseleave",function(t){return e(t.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(i){return function(o){var r,n,a,s,l;if(i.wrapper.removeClass("menu-on"),i.editor.inputManager.focused)return n=e(o.currentTarget),a=n.parent(),s=a.find("td").index(n)+1,l=a.prevAll("tr").length+1,a.parent().is("tbody")&&(l+=1),t=i.createTable(l,s,!0),r=i.editor.selection.blockNodes().last(),i.editor.util.isEmptyNode(r)?r.replaceWith(t):r.after(t),i.decorate(t),i.editor.selection.setRangeAtStartOf(t.find("th:first")),i.editor.trigger("valuechanged"),!1}}(this))},s.prototype.decorate=function(i){return e(t.decorate(i[0],{tableDecorate:"simditor-table",resizeHandle:"simditor-resize-handle"}))},s.prototype.undecorate=function(i){return e(t.undecorate(i[0],{tableDecorate:"simditor-table",resizeHandle:"simditor-resize-handle"}))},s.prototype.createTable=function(i,o,r){return e(t.createTable(i,o,r?this.editor.util.phBr:null))},s.prototype.refreshTableWidth=function(t){return table.refreshTableWidth(t[0])},s.prototype.setActive=function(t){return a.prototype.setActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},s.prototype.deleteRow=function(i){var o,r=this;return t.deleteRow(i[0],function(t,i){t&&(o=r.editor.selection.setRangeAtEndOf(e(t).find("td, th").eq(i)))}),o},s.prototype.insertRow=function(i,o){var r,n=this;return t.insertRow(i[0],o,n.editor.util.phBr,function(t,i){r=n.editor.selection.setRangeAtStartOf(e(t).find("td, th").eq(i))}),r},s.prototype.deleteCol=function(i){var o,r=this;return t.deleteCol(i[0],function(t){t&&(o=r.editor.selection.setRangeAtEndOf(e(t)))}),o},s.prototype.insertCol=function(i,o){var r,n=this;return t.insertCol(i[0],o,n.editor.util.phBr,function(t){r=n.editor.selection.setRangeAtStartOf(e(t))}),r},s.prototype.deleteTable=function(e){var i=this;t.deleteTable(e[0],function(t){if(t.length>0)return i.editor.selection.setRangeAtStartOf(t)})},s.prototype.command=function(t){var e;if((e=this.editor.selection.containerNode().closest("td, th")).length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged")}},n.Toolbar.addButton(s),s}),t("skylark-simditor/buttons/TitleButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="title",a.prototype.htmlTag="h1, h2, h3, h4, h5",a.prototype.disableTag="pre, table",a.prototype._init=function(){return this.menu=[{name:"normal",text:this._t("normalText"),param:"p"},"|",{name:"h1",text:this._t("title")+" 1",param:"h1"},{name:"h2",text:this._t("title")+" 2",param:"h2"},{name:"h3",text:this._t("title")+" 3",param:"h3"},{name:"h4",text:this._t("title")+" 4",param:"h4"},{name:"h5",text:this._t("title")+" 5",param:"h5"}],n.prototype._init.call(this)},a.prototype.setActive=function(t,e){if(n.prototype.setActive.call(this,t),t&&(e||(e=this.node[0].tagName.toLowerCase())),this.el.removeClass("active-p active-h1 active-h2 active-h3 active-h4 active-h5"),t)return this.el.addClass("active active-"+e)},a.prototype.command=function(e){var i,o;return i=this.editor.selection.rootNodes(),this.editor.selection.save(),i.each((o=this,function(i,r){var n;if(!((n=t(r)).is("blockquote")||n.is(e)||n.is(o.disableTag)||o.editor.util.isDecoratedNode(n)))return t("<"+e+"/>").append(n.contents()).replaceAll(n)})),this.editor.selection.restore(),this.editor.trigger("valuechanged")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/UnderlineButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","../Button"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.name="underline",a.prototype.icon="underline",a.prototype.htmlTag="u",a.prototype.disableTag="pre",a.prototype.shortcut="cmd+u",a.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),n.prototype.render.call(this)},a.prototype._activeStatus=function(){var t;return t=!0===document.queryCommandState("underline"),this.setActive(t),this.active},a.prototype.command=function(){return document.execCommand("underline"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},r.Toolbar.addButton(a),a}),t("skylark-simditor/buttons/UnorderListButton",["skylark-jquery","../_extend","../Module","../Toolbar","../Simditor","./ListButton"],function(t,e,i,o,r,n){var a=n.inherit({});return a.prototype.type="ul",a.prototype.name="ul",a.prototype.icon="list-ul",a.prototype.htmlTag="ul",a.prototype.shortcut="cmd+.",a.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),n.prototype._init.call(this)},r.Toolbar.addButton(a),a}),t("skylark-simditor/main",["./Simditor","./Button","./Popover","./buttons/AlignmentButton","./buttons/BlockquoteButton","./buttons/BoldButton","./buttons/CodeButton","./buttons/CodePopover","./buttons/ColorButton","./buttons/FontScaleButton","./buttons/HrButton","./buttons/ImageButton","./buttons/ImagePopover","./buttons/IndentButton","./buttons/ItalicButton","./buttons/LinkButton","./buttons/LinkPopover","./buttons/ListButton","./buttons/OrderListButton","./buttons/OutdentButton","./buttons/StrikethroughButton","./buttons/TableButton","./buttons/TitleButton","./buttons/UnderlineButton","./buttons/UnorderListButton"],function(t){return t}),t("skylark-simditor",["skylark-simditor/main"],function(t){return t})}(i),!r){var s=o("skylark-langx/skylark");n?module.exports=s:e.skylarkjs=s}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-simditor.js.map
