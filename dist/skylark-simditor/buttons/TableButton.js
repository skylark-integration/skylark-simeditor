/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-utils-dom/tables","skylark-jquery","../Toolbar","../Simditor","../Button"],function(t,e,n,i,r){var a=r.inherit({});return a.prototype.name="table",a.prototype.icon="table",a.prototype.htmlTag="table",a.prototype.disableTag="pre, li, blockquote",a.prototype.menu=!0,a.prototype._init=function(){var t;return r.prototype._init.call(this),e.merge(this.editor.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),e.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),e.extend(this.editor.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this._initResize(),this.editor.on("decorate",(t=this,function(n,i){return i.find("table").each(function(n,i){return t.decorate(e(i))})})),this.editor.on("undecorate",function(t){return function(n,i){return i.find("table").each(function(n,i){return t.undecorate(e(i))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(e){var n,i;if(t.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active"),i=t.editor.selection.range())return n=t.editor.selection.containerNode(),i.collapsed&&n.is(".simditor-table")&&t.editor.selection.setRangeAtEndOf(n),n.closest("td, th",t.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(t){return function(e){return t.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active")}}(this)),this.editor.keystroke.add("up","td",function(t){return function(e,n){return t._tdNav(n,"up"),!0}}(this)),this.editor.keystroke.add("up","th",function(t){return function(e,n){return t._tdNav(n,"up"),!0}}(this)),this.editor.keystroke.add("down","td",function(t){return function(e,n){return t._tdNav(n,"down"),!0}}(this)),this.editor.keystroke.add("down","th",function(t){return function(e,n){return t._tdNav(n,"down"),!0}}(this))},a.prototype._tdNav=function(t,e){var n,i,r,a,o;return null==e&&(e="up"),r="up"===e?"prev":"next",(o="up"===e?["tbody","thead"]:["thead","tbody"])[0],o[1],i=t.parent("tr"),!((n=this["_"+r+"Row"](i)).length>0)||(a=i.find("td, th").index(t),this.editor.selection.setRangeAtEndOf(n.find("td, th").eq(a)))},a.prototype._initResize=function(){t.resizable(document,{cssClasses:{resizeHandle:"simditor-resize-handle",wrapper:"simditor-table"}})},a.prototype._initShortcuts=function(){var t;return this.editor.hotkeys.add("ctrl+alt+up",(t=this,function(e){return t.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1})),this.editor.hotkeys.add("ctrl+alt+down",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+left",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+right",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},a.prototype.renderMenu=function(){var t,n;return e('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),t=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",(n=this,function(i){var r,a,o,s;return n.createMenu.find("td, th").removeClass("selected"),s=(a=(r=e(i.currentTarget)).parent()).find("td, th").index(r)+1,o=a.prevAll("tr").addBack(),a.parent().is("tbody")&&(o=o.add(t.find("thead tr"))),o.find("td:lt("+s+"), th:lt("+s+")").addClass("selected")})),this.createMenu.on("mouseleave",function(t){return e(t.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(n){return function(i){var r,a,o,s,d;if(n.wrapper.removeClass("menu-on"),n.editor.inputManager.focused)return s=(o=(a=e(i.currentTarget)).parent()).find("td").index(a)+1,d=o.prevAll("tr").length+1,o.parent().is("tbody")&&(d+=1),t=n.createTable(d,s,!0),r=n.editor.selection.blockNodes().last(),n.editor.util.isEmptyNode(r)?r.replaceWith(t):r.after(t),n.decorate(t),n.editor.selection.setRangeAtStartOf(t.find("th:first")),n.editor.trigger("valuechanged"),!1}}(this))},a.prototype.decorate=function(n){return e(t.decorate(n[0],{tableDecorate:"simditor-table",resizeHandle:"simditor-resize-handle"}))},a.prototype.undecorate=function(n){return e(t.undecorate(n[0],{tableDecorate:"simditor-table",resizeHandle:"simditor-resize-handle"}))},a.prototype.createTable=function(n,i,r){return e(t.createTable(n,i,r?this.editor.util.phBr:null))},a.prototype.refreshTableWidth=function(t){return table.refreshTableWidth(t[0])},a.prototype.setActive=function(t){return r.prototype.setActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},a.prototype.deleteRow=function(n){var i,r=this;return t.deleteRow(n[0],function(t,n){t&&(i=r.editor.selection.setRangeAtEndOf(e(t).find("td, th").eq(n)))}),i},a.prototype.insertRow=function(n,i){var r,a=this;return t.insertRow(n[0],i,a.editor.util.phBr,function(t,n){r=a.editor.selection.setRangeAtStartOf(e(t).find("td, th").eq(n))}),r},a.prototype.deleteCol=function(n){var i,r=this;return t.deleteCol(n[0],function(t){t&&(i=r.editor.selection.setRangeAtEndOf(e(t)))}),i},a.prototype.insertCol=function(n,i){var r,a=this;return t.insertCol(n[0],i,a.editor.util.phBr,function(t){r=a.editor.selection.setRangeAtStartOf(e(t))}),r},a.prototype.deleteTable=function(e){var n=this;t.deleteTable(e[0],function(t){if(t.length>0)return n.editor.selection.setRangeAtStartOf(t)})},a.prototype.command=function(t){var e;if((e=this.editor.selection.containerNode().closest("td, th")).length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged")}},i.Toolbar.addButton(a),a});
//# sourceMappingURL=../sourcemaps/buttons/TableButton.js.map
