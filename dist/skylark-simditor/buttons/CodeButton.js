/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-utils-dom/query","../Toolbar","../Simditor","../Button","./CodePopover"],function(t,e,o,n,i){var r=n.inherit({});return r.prototype.name="code",r.prototype.icon="code",r.prototype.htmlTag="pre",r.prototype.disableTag="ul, ol, table",r.prototype._init=function(){var e;return n.prototype._init.call(this),this.editor.on("decorate",(e=this,function(o,n){return n.find("pre").each(function(o,n){return e.decorate(t(n))})})),this.editor.on("undecorate",function(e){return function(o,n){return n.find("pre").each(function(o,n){return e.undecorate(t(n))})}}(this))},r.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],n.prototype.render.apply(this,t),this.popover=new i({button:this})},r.prototype._checkMode=function(){var e;return e=this.editor.editable.selection.range(),t(e.cloneContents()).find(this.editor.editable.util.blockNodes.join(","))>0||e.collapsed&&0===this.editor.editable.selection.startNodes().filter("code").length?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},r.prototype._status=function(){if(this._checkMode(),n.prototype._status.call(this),!this.inlineMode)return this.active?this.popover.show(this.node):this.popover.hide()},r.prototype.decorate=function(t){var e,o,n,i;if((e=t.find("> code")).length>0&&(o=null!=(n=e.attr("class"))&&null!=(i=n.match(/lang-(\S+)/))?i[1]:void 0,e.contents().unwrap(),o))return t.attr("data-lang",o)},r.prototype.undecorate=function(e){var o,n;return n=e.attr("data-lang"),o=t("<code/>"),n&&-1!==n&&o.addClass("lang-"+n),e.wrapInner(o).removeAttr("data-lang")},r.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},r.prototype._blockCommand=function(){var e,o,n,i,r;return e=this.editor.editable.selection.rootNodes(),n=[],i=[],r=this,o=function(){var e;if(n.length>0)return e=t("<"+r.htmlTag+"/>").insertBefore(n[0]).text(r.editor.editable.formatter.clearHtml(n)),i.push(e[0]),n.length=0},e.each(function(e){return function(r,a){var s,d;return(s=t(a)).is(e.htmlTag)?(o(),d=t("<p/>").append(s.html().replace("\n","<br/>")).replaceAll(s),i.push(d[0])):s.is(e.disableTag)||e.editor.editable.util.isDecoratedNode(s)||s.is("blockquote")?o():n.push(a)}}(this)),o(),this.editor.editable.selection.setRangeAtEndOf(t(i).last()),this.editor.trigger("valuechanged")},r.prototype._inlineCommand=function(){var e,o,n;return n=this.editor.editable.selection.range(),this.active?(n.selectNodeContents(this.node[0]),this.editor.editable.selection.save(n),this.node.contents().unwrap(),this.editor.editable.selection.restore()):(o=t(n.extractContents()),e=t("<"+this.htmlTag+"/>").append(o.contents()),n.insertNode(e[0]),n.selectNodeContents(e[0]),this.editor.editable.selection.range(n)),this.editor.trigger("valuechanged")},o.Toolbar.addButton(r),r});
//# sourceMappingURL=../sourcemaps/buttons/CodeButton.js.map
