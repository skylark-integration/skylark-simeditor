/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-jquery","./_extend","./Module","./Simditor"],function(t,e,i,s){var r=i.inherit({init:function(t){this.toolbar=t.toolbar,this.editor=t.toolbar.editor,this.title=this._t(this.name),i.prototype.init.call(this,t)}});return r.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},r.prototype.name="",r.prototype.icon="",r.prototype.title="",r.prototype.text="",r.prototype.htmlTag="",r.prototype.disableTag="",r.prototype.menu=!1,r.prototype.active=!1,r.prototype.disabled=!1,r.prototype.needFocus=!0,r.prototype.shortcut=null,r.prototype._init=function(){var e,i,s,r,n;for(this.render(),this.el.on("mousedown",(n=this,function(t){var e,i;return t.preventDefault(),e=n.needFocus&&!n.editor.inputManager.focused,!n.el.hasClass("disabled")&&(e&&n.editor.focus(),n.menu?(n.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),n.wrapper.is(".menu-on")&&(n.menuWrapper.offset().left+n.menuWrapper.outerWidth()+5-n.editor.wrapper.offset().left-n.editor.wrapper.outerWidth()>0&&n.menuWrapper.css({left:"auto",right:0}),n.trigger("menuexpand")),!1):(i=n.el.data("param"),n.command(i),!1))})),this.wrapper.on("click","a.menu-item",function(e){return function(i){var s,r,n;return i.preventDefault(),s=t(i.currentTarget),e.wrapper.removeClass("menu-on"),r=e.needFocus&&!e.editor.inputManager.focused,!s.hasClass("disabled")&&!r&&(e.toolbar.wrapper.removeClass("menu-on"),n=s.data("param"),e.command(n),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(t){return!1}),this.editor.on("blur",function(t){return function(){if(t.editor.body.is(":visible")&&t.editor.body.is("[contenteditable]")&&!t.editor.clipboard.pasting)return t.setActive(!1),t.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.hotkeys.add(this.shortcut,function(t){return function(e){return t.el.mousedown(),!1}}(this)),e=0,i=(s=this.htmlTag.split(",")).length;e<i;e++)r=s[e],(r=t.trim(r))&&t.inArray(r,this.editor.formatter._allowedTags)<0&&this.editor.formatter._allowedTags.push(r);return this.editor.on("selectionchanged",function(t){return function(e){if(t.editor.inputManager.focused)return t._status()}}(this))},r.prototype.iconClassOf=function(t){return t?"simditor-icon simditor-icon-"+t:""},r.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},r.prototype.render=function(){if(this.wrapper=t(this._tpl.item).appendTo(this.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=t(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},r.prototype.renderMenu=function(){var e,i,s,r,n,o,a;if(t.isArray(this.menu)){for(this.menuEl=t("<ul/>").appendTo(this.menuWrapper),a=[],i=0,s=(n=this.menu).length;i<s;i++)"|"!==(r=n[i])?(e=t(this._tpl.menuItem).appendTo(this.menuEl).find("a.menu-item").attr({title:null!=(o=r.title)?o:r.text,"data-param":r.param}).addClass("menu-item-"+r.name),r.icon?a.push(e.find("span").addClass(this.iconClassOf(r.icon))):a.push(e.find("span").text(r.text))):t(this._tpl.separator).appendTo(this.menuEl);return a}},r.prototype.setActive=function(t){if(t!==this.active)return this.active=t,this.el.toggleClass("active",this.active)},r.prototype.setDisabled=function(t){if(t!==this.disabled)return this.disabled=t,this.el.toggleClass("disabled",this.disabled)},r.prototype._disableStatus=function(){var t,e,i;return i=this.editor.selection.startNodes(),e=this.editor.selection.endNodes(),t=i.filter(this.disableTag).length>0||e.filter(this.disableTag).length>0,this.setDisabled(t),this.disabled&&this.setActive(!1),this.disabled},r.prototype._activeStatus=function(){var t,e,i,s,r;return r=this.editor.selection.startNodes(),i=this.editor.selection.endNodes(),s=r.filter(this.htmlTag),e=i.filter(this.htmlTag),t=s.length>0&&e.length>0&&s.is(e),this.node=t?s:null,this.setActive(t),this.active},r.prototype._status=function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},r.prototype.command=function(t){},r.prototype._t=function(){var t,e,s;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],(s=i.prototype._t.apply(this,t))||(s=(e=this.editor)._t.apply(e,t)),s},s.Button=r,r});
//# sourceMappingURL=sourcemaps/Button.js.map
