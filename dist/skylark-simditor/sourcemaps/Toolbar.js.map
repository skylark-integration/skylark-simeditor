{"version":3,"sources":["Toolbar.js"],"names":["define","$","extend","Module","Toolbar","inherit","pluginName","prototype","opts","toolbar","toolbarFloat","toolbarHidden","toolbarFloatOffset","_tpl","wrapper","separator","_init","floatInitialized","initToolbarFloat","toolbarHeight","_this","this","editor","_module","isArray","_render","list","on","e","find","removeClass","document","id","css","width","util","reflow","outerWidth","os","mobile","position","left","offset","outerHeight","placeholderEl","window","bottomEdge","scrollTop","topEdge","is","top","addClass","buttons","length","k","len","name","ref","prependTo","constructor","Error","push","appendTo","hide","findButton","button","data","addButton","btn"],"mappings":"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","file":"../Toolbar.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"./_extend\",\r\n  \"./Module\"\r\n],function($,extend,Module){ \r\n\r\n  var Toolbar = Module.inherit({\r\n\r\n  });\r\n\r\n  Toolbar.pluginName = 'Toolbar';\r\n\r\n  Toolbar.prototype.opts = {\r\n    toolbar: true,\r\n    toolbarFloat: true,\r\n    toolbarHidden: false,\r\n    toolbarFloatOffset: 0\r\n  };\r\n\r\n  Toolbar.prototype._tpl = {\r\n    wrapper: '<div class=\"simditor-toolbar\"><ul></ul></div>',\r\n    separator: '<li><span class=\"separator\"></span></li>'\r\n  };\r\n\r\n  Toolbar.prototype._init = function() {\r\n    var floatInitialized, initToolbarFloat, toolbarHeight;\r\n    this.editor = this._module;\r\n    if (!this.opts.toolbar) {\r\n      return;\r\n    }\r\n    if (!$.isArray(this.opts.toolbar)) {\r\n      this.opts.toolbar = ['bold', 'italic', 'underline', 'strikethrough', '|', 'ol', 'ul', 'blockquote', 'code', '|', 'link', 'image', '|', 'indent', 'outdent'];\r\n    }\r\n    this._render();\r\n    this.list.on('click', function(e) {\r\n      return false;\r\n    });\r\n    this.wrapper.on('mousedown', (function(_this) {\r\n      return function(e) {\r\n        return _this.list.find('.menu-on').removeClass('.menu-on');\r\n      };\r\n    })(this));\r\n    $(document).on('mousedown.simditor' + this.editor.id, (function(_this) {\r\n      return function(e) {\r\n        return _this.list.find('.menu-on').removeClass('.menu-on');\r\n      };\r\n    })(this));\r\n    if (!this.opts.toolbarHidden && this.opts.toolbarFloat) {\r\n      this.wrapper.css('top', this.opts.toolbarFloatOffset);\r\n      toolbarHeight = 0;\r\n      initToolbarFloat = (function(_this) {\r\n        return function() {\r\n          _this.wrapper.css('position', 'static');\r\n          _this.wrapper.width('auto');\r\n          _this.editor.util.reflow(_this.wrapper);\r\n          _this.wrapper.width(_this.wrapper.outerWidth());\r\n          _this.wrapper.css('left', _this.editor.util.os.mobile ? _this.wrapper.position().left : _this.wrapper.offset().left);\r\n          _this.wrapper.css('position', '');\r\n          toolbarHeight = _this.wrapper.outerHeight();\r\n          _this.editor.placeholderEl.css('top', toolbarHeight);\r\n          return true;\r\n        };\r\n      })(this);\r\n      floatInitialized = null;\r\n      $(window).on('resize.simditor-' + this.editor.id, function(e) {\r\n        return floatInitialized = initToolbarFloat();\r\n      });\r\n      $(window).on('scroll.simditor-' + this.editor.id, (function(_this) {\r\n        return function(e) {\r\n          var bottomEdge, scrollTop, topEdge;\r\n          if (!_this.wrapper.is(':visible')) {\r\n            return;\r\n          }\r\n          topEdge = _this.editor.wrapper.offset().top;\r\n          bottomEdge = topEdge + _this.editor.wrapper.outerHeight() - 80;\r\n          scrollTop = $(document).scrollTop() + _this.opts.toolbarFloatOffset;\r\n          if (scrollTop <= topEdge || scrollTop >= bottomEdge) {\r\n            _this.editor.wrapper.removeClass('toolbar-floating').css('padding-top', '');\r\n            if (_this.editor.util.os.mobile) {\r\n              return _this.wrapper.css('top', _this.opts.toolbarFloatOffset);\r\n            }\r\n          } else {\r\n            floatInitialized || (floatInitialized = initToolbarFloat());\r\n            _this.editor.wrapper.addClass('toolbar-floating').css('padding-top', toolbarHeight);\r\n            if (_this.editor.util.os.mobile) {\r\n              return _this.wrapper.css('top', scrollTop - topEdge + _this.opts.toolbarFloatOffset);\r\n            }\r\n          }\r\n        };\r\n      })(this));\r\n    }\r\n    this.editor.on('destroy', (function(_this) {\r\n      return function() {\r\n        return _this.buttons.length = 0;\r\n      };\r\n    })(this));\r\n    return $(document).on(\"mousedown.simditor-\" + this.editor.id, (function(_this) {\r\n      return function(e) {\r\n        return _this.list.find('li.menu-on').removeClass('menu-on');\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  Toolbar.prototype._render = function() {\r\n    var k, len, name, ref;\r\n    this.buttons = [];\r\n    this.wrapper = $(this._tpl.wrapper).prependTo(this.editor.wrapper);\r\n    this.list = this.wrapper.find('ul');\r\n    ref = this.opts.toolbar;\r\n    for (k = 0, len = ref.length; k < len; k++) {\r\n      name = ref[k];\r\n      if (name === '|') {\r\n        $(this._tpl.separator).appendTo(this.list);\r\n        continue;\r\n      }\r\n      if (!this.constructor.buttons[name]) {\r\n        throw new Error(\"simditor: invalid toolbar button \" + name);\r\n        continue;\r\n      }\r\n      this.buttons.push(new this.constructor.buttons[name]({\r\n        editor: this.editor\r\n      }));\r\n    }\r\n    if (this.opts.toolbarHidden) {\r\n      return this.wrapper.hide();\r\n    }\r\n  };\r\n\r\n  Toolbar.prototype.findButton = function(name) {\r\n    var button;\r\n    button = this.list.find('.toolbar-item-' + name).data('button');\r\n    return button != null ? button : null;\r\n  };\r\n\r\n  Toolbar.addButton = function(btn) {\r\n    return this.buttons[btn.prototype.name] = btn;\r\n  };\r\n\r\n  Toolbar.buttons = {};\r\n\r\n  return Toolbar;\r\n\r\n});"]}