{"version":3,"sources":["Util.js"],"names":["define","langx","$","os","chrome","edge","firefox","ie","ref","ref1","ref2","ref3","ref4","safari","ua","Util","Evented","inherit","init","editor","this","browser","msie","version","phBr","pluginName","prototype","test","navigator","appVersion","mac","linux","win","unix","mobile","userAgent","match","webkit","mozilla","support","onselectionchange","document","_error","oninput","reflow","el","offsetHeight","metaKey","e","ctrlKey","isEmptyNode","node","$node","is","text","find","length","isDecoratedNode","blockNodes","isBlockNode","nodeType","RegExp","join","nodeName","toLowerCase","getNodeLength","childNodes","dataURLtoBlob","dataURL","BlobBuilder","arrayBuffer","bb","byteString","hasArrayBufferViewSupport","hasBlobConstructor","i","intArray","k","mimeString","window","Blob","Boolean","Uint8Array","size","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","atob","ArrayBuffer","split","indexOf","decodeURIComponent","charCodeAt","type","append","getBlob","throttle","func","wait","args","call","ctx","last","rtn","throttled","timeoutID","Date","apply","delta","arguments","setTimeout","clear","clearTimeout","formatHTML","html","cursor","lastMatch","level","re","repeatString","result","str","n","Array","exec","inArray","isStartTag","isEndTag","index","substring","trim"],"mappings":";;;;;;;AAAAA,QACE,sBACA,kBACA,SAASC,EAAMC,GACf,IAgBMC,EAkBAC,EAAQC,EAAMC,EAASC,EAAIC,EAAKC,EAAMC,EAAMC,EAAMC,EAAMC,EAAQC,EAlClEC,EAAOd,EAAMe,QAAQC,SACvBC,KAAO,SAASC,GAEd,GADAC,KAAKD,OAASA,EACVC,KAAKC,QAAQC,MAAQF,KAAKC,QAAQE,QAAU,GAC9C,OAAOH,KAAKI,KAAO,MA2QzB,OArQAT,EAAKU,WAAa,OAGlBV,EAAKW,UAAUF,KAAO,QAEtBT,EAAKW,UAAUvB,IAEbA,KACI,MAAMwB,KAAKC,UAAUC,YACvB1B,EAAG2B,KAAM,EACA,QAAQH,KAAKC,UAAUC,YAChC1B,EAAG4B,OAAQ,EACF,MAAMJ,KAAKC,UAAUC,YAC9B1B,EAAG6B,KAAM,EACA,MAAML,KAAKC,UAAUC,cAC9B1B,EAAG8B,MAAO,GAER,OAAON,KAAKC,UAAUC,cACxB1B,EAAG+B,QAAS,GAEP/B,GAGTY,EAAKW,UAAUL,SAEbP,EAAKc,UAAUO,UACf5B,EAAK,kBAAkBoB,KAAKb,GAC5BV,EAAS,gBAAgBuB,KAAKb,GAC9BD,EAAS,UAAUc,KAAKb,KAAQV,EAChCE,EAAU,WAAWqB,KAAKb,GAC1BT,EAAO,QAAQsB,KAAKb,GAChBP,GAEAe,MAAM,EACNC,QAAqF,GAA1B,OAAhDf,EAAMM,EAAGsB,MAAM,8BAAwC5B,EAAI,QAAK,IAEpEH,GAEPA,MAAM,EACNgC,QAAQ,EACRd,QAAkF,GAA3B,OAA5Cd,EAAOK,EAAGsB,MAAM,yBAAmC3B,EAAK,QAAK,IAEjEL,GAEPiC,QAAQ,EACRjC,QAAQ,EACRmB,QAA8F,GAA3B,OAAxDb,EAAOI,EAAGsB,MAAM,qCAA+C1B,EAAK,QAAK,IAE7EG,GAEPwB,QAAQ,EACRxB,QAAQ,EACRU,QAAqF,GAA3B,OAA/CZ,EAAOG,EAAGsB,MAAM,4BAAsCzB,EAAK,QAAK,IAEpEL,GAEPgC,SAAS,EACThC,SAAS,EACTiB,QAAqF,GAA3B,OAA/CX,EAAOE,EAAGsB,MAAM,4BAAsCxB,EAAK,QAAK,QAOjFG,EAAKW,UAAUa,SAEXC,kBAAmB,WACjB,IAAOA,EAEP,QAA0B,KAD1BA,EAAoBC,SAASD,mBAE3B,IAEE,OADAC,SAASD,kBAAoB,EACS,OAA/BC,SAASD,kBAChB,MAAOE,IAEP,QACAD,SAASD,kBAAoBA,EAGjC,OAAO,EAbU,GAenBG,SACU,kBAAkBhB,KAAKC,UAAUO,YAK/CpB,EAAKW,UAAUkB,OAAS,SAASC,GAI/B,OAHU,MAANA,IACFA,EAAKJ,UAEAvC,EAAE2C,GAAI,GAAGC,cAGlB/B,EAAKW,UAAUqB,QAAU,SAASC,GAGhC,MADQ,MAAMrB,KAAKC,UAAUO,WAEpBa,EAAED,QAEFC,EAAEC,SAIblC,EAAKW,UAAUwB,YAAc,SAASC,GACpC,IAAIC,EAEJ,OADAA,EAAQlD,EAAEiD,IACGE,GAAG,YAAeD,EAAME,SAAWF,EAAMG,KAAK,uBAAuBC,QAGpFzC,EAAKW,UAAU+B,gBAAkB,SAASN,GACxC,OAAOjD,EAAEiD,GAAME,GAAG,yBAGpBtC,EAAKW,UAAUgC,YAAc,MAAO,IAAK,KAAM,KAAM,KAAM,aAAc,KAAM,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,SAEpH3C,EAAKW,UAAUiC,YAAc,SAASR,GAEpC,UADAA,EAAOjD,EAAEiD,GAAM,KACgB,IAAlBA,EAAKS,WAGX,IAAIC,OAAO,KAAQzC,KAAKsC,WAAWI,KAAK,KAAQ,MAAMnC,KAAKwB,EAAKY,SAASC,gBAGlFjD,EAAKW,UAAUuC,cAAgB,SAASd,GAEtC,QADAA,EAAOjD,EAAEiD,GAAM,IACFS,UACX,KAAK,EACL,KAAK,GACH,OAAO,EACT,KAAK,EACL,KAAK,EACH,OAAOT,EAAKK,OACd,QACE,OAAOL,EAAKe,WAAWV,SAI7BzC,EAAKW,UAAUyC,cAAgB,SAASC,GACtC,IAAIC,EAAaC,EAAaC,EAAeC,EAAYC,EAA2BC,EAAoBC,EAAGC,EAAUC,EAAGC,EAAYtE,EAqBpI,GAXAiE,GATAC,EAAqBK,OAAOC,MAAQ,WAElC,IACE,OAAOC,QAAQ,IAAID,MACnB,MAAOtC,GAEP,OADIA,GACG,GANyB,KAScqC,OAAOG,YAAc,WAErE,IACE,OAAgD,MAAzC,IAAIF,MAAM,IAAIE,WAAW,OAAOC,KACvC,MAAOzC,GAEP,OADIA,GACG,GAN4D,GASvE2B,EAAcU,OAAOV,aAAeU,OAAOK,mBAAqBL,OAAOM,gBAAkBN,OAAOO,iBAClFZ,GAAsBL,IACfU,OAAOQ,MAAQR,OAAOS,aAAeT,OAAOG,YAC/D,OAAO,EAST,IANEV,EADEJ,EAAQqB,MAAM,KAAK,GAAGC,QAAQ,WAAa,EAChCH,KAAKnB,EAAQqB,MAAM,KAAK,IAExBE,mBAAmBvB,EAAQqB,MAAM,KAAK,IAErDnB,EAAc,IAAIkB,YAAYhB,EAAWhB,QACzCoB,EAAW,IAAIM,WAAWZ,GACrBK,EAAIE,EAAI,EAAGrE,EAAMgE,EAAWhB,OAAQ,GAAKhD,EAAMqE,GAAKrE,EAAMqE,GAAKrE,EAAKmE,EAAI,GAAKnE,IAAQqE,IAAMA,EAC9FD,EAASD,GAAKH,EAAWoB,WAAWjB,GAGtC,OADAG,EAAaV,EAAQqB,MAAM,KAAK,GAAGA,MAAM,KAAK,GAAGA,MAAM,KAAK,GACxDf,EAEK,IAAIM,MADCP,EAA4BG,EAAWN,IAEjDuB,KAAMf,MAGVP,EAAK,IAAIF,GACNyB,OAAOxB,GACHC,EAAGwB,QAAQjB,KAGpB/D,EAAKW,UAAUsE,SAAW,SAASC,EAAMC,GACvC,IAAIC,EAAMC,EAAMC,EAAKC,EAAMC,EAAKC,EAAWC,EAgC3C,OA/BAH,EAAO,EACPG,EAAY,EACZJ,EAAMF,EAAOI,EAAM,KACnBH,EAAO,WAKL,OAJAK,EAAY,EACZH,GAAQ,IAAII,KACZH,EAAMN,EAAKU,MAAMN,EAAKF,GACtBE,EAAM,KACCF,EAAO,OAEhBK,EAAY,WACV,IAAII,EAWJ,OAVAP,EAAMjF,KACN+E,EAAOU,UACPD,EAAQ,IAAIF,KAASJ,EAChBG,IACCG,GAASV,EACXE,IAEAK,EAAYK,WAAWV,EAAMF,EAAOU,IAGjCL,IAECQ,MAAQ,WAChB,GAAKN,EAIL,OADAO,aAAaP,GACNL,KAEFI,GAGTzF,EAAKW,UAAUuF,WAAa,SAASC,GACnC,IAAIC,EAAsBC,EAAWC,EAAOjF,EAAOkF,EAAIC,EAAcC,EAAQC,EAS7E,IARAH,EAAK,qBACLE,EAAS,GACTH,EAAQ,EACRD,EAAY,KACG,KACfG,EAAe,SAASE,EAAKC,GAC3B,OAAO,IAAIC,MAAMD,EAAI,GAAG5D,KAAK2D,IAEI,QAA3BrF,EAAQkF,EAAGM,KAAKV,KACtB9E,EAAMuB,YAAc1D,EAAM4H,QAAQzF,EAAM,GAAIhB,KAAKsC,aAAe,EAChEtB,EAAM0F,WAA0B,MAAb1F,EAAM,IAA2B,MAAbA,EAAM,GAC7CA,EAAM2F,SAAwB,MAAb3F,EAAM,IAA2B,MAAbA,EAAM,GAC3C+E,EAASC,EAAYA,EAAUY,MAAQZ,EAAU,GAAG5D,OAAS,GACxDiE,EAAMP,EAAKe,UAAUd,EAAQ/E,EAAM4F,QAAQxE,OAAS,GAAKvD,EAAMiI,KAAKT,KACvED,GAAUC,GAERrF,EAAMuB,aAAevB,EAAM2F,WAAa3F,EAAM0F,aAChDT,GAAS,GAEPjF,EAAMuB,aAAevB,EAAM0F,aACvBV,GAAaA,EAAUzD,aAAeyD,EAAUW,WACpDP,GAAU,MAEZA,GAAUD,EAnBC,KAmB0BF,IAEvCG,GAAUpF,EAAM,GACZA,EAAMuB,aAAevB,EAAM2F,WAC7BP,GAAU,MAERpF,EAAMuB,aAAevB,EAAM0F,aAC7BT,GAAS,GAEXD,EAAYhF,EAEd,OAAOnC,EAAMiI,KAAKV,IAGbzG","file":"../Util.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-jquery\"\r\n],function(langx,$){ \r\n  var Util = langx.Evented.inherit({\r\n    init : function(editor) {\r\n      this.editor = editor; // this._module;\r\n      if (this.browser.msie && this.browser.version < 11) {\r\n        return this.phBr = '';\r\n      }\r\n    }\r\n\r\n  });\r\n\r\n  Util.pluginName = 'Util';\r\n\r\n\r\n  Util.prototype.phBr = '<br/>';\r\n\r\n  Util.prototype.os = (function() {\r\n    var os;\r\n    os = {};\r\n    if (/Mac/.test(navigator.appVersion)) {\r\n      os.mac = true;\r\n    } else if (/Linux/.test(navigator.appVersion)) {\r\n      os.linux = true;\r\n    } else if (/Win/.test(navigator.appVersion)) {\r\n      os.win = true;\r\n    } else if (/X11/.test(navigator.appVersion)) {\r\n      os.unix = true;\r\n    }\r\n    if (/Mobi/.test(navigator.appVersion)) {\r\n      os.mobile = true;\r\n    }\r\n    return os;\r\n  })();\r\n\r\n  Util.prototype.browser = (function() {\r\n    var chrome, edge, firefox, ie, ref, ref1, ref2, ref3, ref4, safari, ua;\r\n    ua = navigator.userAgent;\r\n    ie = /(msie|trident)/i.test(ua);\r\n    chrome = /chrome|crios/i.test(ua);\r\n    safari = /safari/i.test(ua) && !chrome;\r\n    firefox = /firefox/i.test(ua);\r\n    edge = /edge/i.test(ua);\r\n    if (ie) {\r\n      return {\r\n        msie: true,\r\n        version: ((ref = ua.match(/(msie |rv:)(\\d+(\\.\\d+)?)/i)) != null ? ref[2] : void 0) * 1\r\n      };\r\n    } else if (edge) {\r\n      return {\r\n        edge: true,\r\n        webkit: true,\r\n        version: ((ref1 = ua.match(/edge\\/(\\d+(\\.\\d+)?)/i)) != null ? ref1[1] : void 0) * 1\r\n      };\r\n    } else if (chrome) {\r\n      return {\r\n        webkit: true,\r\n        chrome: true,\r\n        version: ((ref2 = ua.match(/(?:chrome|crios)\\/(\\d+(\\.\\d+)?)/i)) != null ? ref2[1] : void 0) * 1\r\n      };\r\n    } else if (safari) {\r\n      return {\r\n        webkit: true,\r\n        safari: true,\r\n        version: ((ref3 = ua.match(/version\\/(\\d+(\\.\\d+)?)/i)) != null ? ref3[1] : void 0) * 1\r\n      };\r\n    } else if (firefox) {\r\n      return {\r\n        mozilla: true,\r\n        firefox: true,\r\n        version: ((ref4 = ua.match(/firefox\\/(\\d+(\\.\\d+)?)/i)) != null ? ref4[1] : void 0) * 1\r\n      };\r\n    } else {\r\n      return {};\r\n    }\r\n  })();\r\n\r\n  Util.prototype.support = (function() {\r\n    return {\r\n      onselectionchange: (function() {\r\n        var e, onselectionchange;\r\n        onselectionchange = document.onselectionchange;\r\n        if (onselectionchange !== void 0) {\r\n          try {\r\n            document.onselectionchange = 0;\r\n            return document.onselectionchange === null;\r\n          } catch (_error) {\r\n            e = _error;\r\n          } finally {\r\n            document.onselectionchange = onselectionchange;\r\n          }\r\n        }\r\n        return false;\r\n      })(),\r\n      oninput: (function() {\r\n        return !/(msie|trident)/i.test(navigator.userAgent);\r\n      })()\r\n    };\r\n  })();\r\n\r\n  Util.prototype.reflow = function(el) {\r\n    if (el == null) {\r\n      el = document;\r\n    }\r\n    return $(el)[0].offsetHeight;\r\n  };\r\n\r\n  Util.prototype.metaKey = function(e) {\r\n    var isMac;\r\n    isMac = /Mac/.test(navigator.userAgent);\r\n    if (isMac) {\r\n      return e.metaKey;\r\n    } else {\r\n      return e.ctrlKey;\r\n    }\r\n  };\r\n\r\n  Util.prototype.isEmptyNode = function(node) {\r\n    var $node;\r\n    $node = $(node);\r\n    return $node.is(':empty') || (!$node.text() && !$node.find(':not(br, span, div)').length);\r\n  };\r\n\r\n  Util.prototype.isDecoratedNode = function(node) {\r\n    return $(node).is('[class^=\"simditor-\"]');\r\n  };\r\n\r\n  Util.prototype.blockNodes = [\"div\", \"p\", \"ul\", \"ol\", \"li\", \"blockquote\", \"hr\", \"pre\", \"h1\", \"h2\", \"h3\", \"h4\", \"h5\", \"table\"];\r\n\r\n  Util.prototype.isBlockNode = function(node) {\r\n    node = $(node)[0];\r\n    if (!node || node.nodeType === 3) {\r\n      return false;\r\n    }\r\n    return new RegExp(\"^(\" + (this.blockNodes.join('|')) + \")$\").test(node.nodeName.toLowerCase());\r\n  };\r\n\r\n  Util.prototype.getNodeLength = function(node) {\r\n    node = $(node)[0];\r\n    switch (node.nodeType) {\r\n      case 7:\r\n      case 10:\r\n        return 0;\r\n      case 3:\r\n      case 8:\r\n        return node.length;\r\n      default:\r\n        return node.childNodes.length;\r\n    }\r\n  };\r\n\r\n  Util.prototype.dataURLtoBlob = function(dataURL) {\r\n    var BlobBuilder, arrayBuffer, bb, blobArray, byteString, hasArrayBufferViewSupport, hasBlobConstructor, i, intArray, k, mimeString, ref, supportBlob;\r\n    hasBlobConstructor = window.Blob && (function() {\r\n      var e;\r\n      try {\r\n        return Boolean(new Blob());\r\n      } catch (_error) {\r\n        e = _error;\r\n        return false;\r\n      }\r\n    })();\r\n    hasArrayBufferViewSupport = hasBlobConstructor && window.Uint8Array && (function() {\r\n      var e;\r\n      try {\r\n        return new Blob([new Uint8Array(100)]).size === 100;\r\n      } catch (_error) {\r\n        e = _error;\r\n        return false;\r\n      }\r\n    })();\r\n    BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\r\n    supportBlob = hasBlobConstructor || BlobBuilder;\r\n    if (!(supportBlob && window.atob && window.ArrayBuffer && window.Uint8Array)) {\r\n      return false;\r\n    }\r\n    if (dataURL.split(',')[0].indexOf('base64') >= 0) {\r\n      byteString = atob(dataURL.split(',')[1]);\r\n    } else {\r\n      byteString = decodeURIComponent(dataURL.split(',')[1]);\r\n    }\r\n    arrayBuffer = new ArrayBuffer(byteString.length);\r\n    intArray = new Uint8Array(arrayBuffer);\r\n    for (i = k = 0, ref = byteString.length; 0 <= ref ? k <= ref : k >= ref; i = 0 <= ref ? ++k : --k) {\r\n      intArray[i] = byteString.charCodeAt(i);\r\n    }\r\n    mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0];\r\n    if (hasBlobConstructor) {\r\n      blobArray = hasArrayBufferViewSupport ? intArray : arrayBuffer;\r\n      return new Blob([blobArray], {\r\n        type: mimeString\r\n      });\r\n    }\r\n    bb = new BlobBuilder();\r\n    bb.append(arrayBuffer);\r\n    return bb.getBlob(mimeString);\r\n  };\r\n\r\n  Util.prototype.throttle = function(func, wait) {\r\n    var args, call, ctx, last, rtn, throttled, timeoutID;\r\n    last = 0;\r\n    timeoutID = 0;\r\n    ctx = args = rtn = null;\r\n    call = function() {\r\n      timeoutID = 0;\r\n      last = +new Date();\r\n      rtn = func.apply(ctx, args);\r\n      ctx = null;\r\n      return args = null;\r\n    };\r\n    throttled = function() {\r\n      var delta;\r\n      ctx = this;\r\n      args = arguments;\r\n      delta = new Date() - last;\r\n      if (!timeoutID) {\r\n        if (delta >= wait) {\r\n          call();\r\n        } else {\r\n          timeoutID = setTimeout(call, wait - delta);\r\n        }\r\n      }\r\n      return rtn;\r\n    };\r\n    throttled.clear = function() {\r\n      if (!timeoutID) {\r\n        return;\r\n      }\r\n      clearTimeout(timeoutID);\r\n      return call();\r\n    };\r\n    return throttled;\r\n  };\r\n\r\n  Util.prototype.formatHTML = function(html) {\r\n    var cursor, indentString, lastMatch, level, match, re, repeatString, result, str;\r\n    re = /<(\\/?)(.+?)(\\/?)>/g;\r\n    result = '';\r\n    level = 0;\r\n    lastMatch = null;\r\n    indentString = '  ';\r\n    repeatString = function(str, n) {\r\n      return new Array(n + 1).join(str);\r\n    };\r\n    while ((match = re.exec(html)) !== null) {\r\n      match.isBlockNode = langx.inArray(match[2], this.blockNodes) > -1;\r\n      match.isStartTag = match[1] !== '/' && match[3] !== '/';\r\n      match.isEndTag = match[1] === '/' || match[3] === '/';\r\n      cursor = lastMatch ? lastMatch.index + lastMatch[0].length : 0;\r\n      if ((str = html.substring(cursor, match.index)).length > 0 && langx.trim(str)) {\r\n        result += str;\r\n      }\r\n      if (match.isBlockNode && match.isEndTag && !match.isStartTag) {\r\n        level -= 1;\r\n      }\r\n      if (match.isBlockNode && match.isStartTag) {\r\n        if (!(lastMatch && lastMatch.isBlockNode && lastMatch.isEndTag)) {\r\n          result += '\\n';\r\n        }\r\n        result += repeatString(indentString, level);\r\n      }\r\n      result += match[0];\r\n      if (match.isBlockNode && match.isEndTag) {\r\n        result += '\\n';\r\n      }\r\n      if (match.isBlockNode && match.isStartTag) {\r\n        level += 1;\r\n      }\r\n      lastMatch = match;\r\n    }\r\n    return langx.trim(result);\r\n  };\r\n\r\n  return Util;\r\n});"]}