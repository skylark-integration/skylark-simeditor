{"version":3,"sources":["Formatter.js"],"names":["define","$","extend","Module","indexOf","Formatter","inherit","opts","allowedTags","allowedAttributes","allowedStyles","_init","this","editor","_module","_allowedTags","merge","_allowedAttributes","img","a","font","code","_allowedStyles","span","b","i","strong","strike","u","p","h1","h2","h3","h4","body","on","e","decorate","$el","trigger","undecorate","clone","autolink","$link","$node","findLinkNode","k","lastIndex","len","linkNodes","match","re","replaceEls","subStr","text","uri","$parentNode","contents","each","node","is","closest","length","test","push","exec","substring","index","document","createTextNode","replaceWith","format","blockNode","l","len1","n","ref","ref1","append","util","phBr","cleanNode","remove","isBlockNode","insertBefore","isEmptyNode","recursive","$blockEls","$childImg","$p","$td","attr","isDecoration","textNode","nodeType","isDecoratedNode","join","find","blockNodes","blockEl","unwrap","hasClass","tagName","toLowerCase","makeArray","attributes","name","call","removeAttr","_cleanNodeStyles","first","style","color","fontSize","tr","replace","pair","styleStr","styles","split","trim","parseInt","Object","keys","css","clearHtml","html","lineBreak","container","result","_this","children","nodeValue","beautify","$contents","uselessP","el","pluginName"],"mappings":"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","file":"../Formatter.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"./_extend\",\r\n  \"./Module\",\r\n],function($,extend,Module){ \r\n  var indexOf = [].indexOf ;\r\n\r\n  var Formatter = Module.inherit({\r\n    opts : {\r\n      allowedTags: [],\r\n      allowedAttributes: {},\r\n      allowedStyles: {}\r\n    },\r\n\r\n    _init : function() {\r\n      this.editor = this._module;\r\n      this._allowedTags = $.merge(['br', 'span', 'a', 'img', 'b', 'strong', 'i', 'strike', 'u', 'font', 'p', 'ul', 'ol', 'li', 'blockquote', 'pre', 'code', 'h1', 'h2', 'h3', 'h4', 'hr'], this.opts.allowedTags);\r\n      this._allowedAttributes = $.extend({\r\n        img: ['src', 'alt', 'width', 'height', 'data-non-image'],\r\n        a: ['href', 'target'],\r\n        font: ['color'],\r\n        code: ['class']\r\n      }, this.opts.allowedAttributes);\r\n      this._allowedStyles = $.extend({\r\n        span: ['color', 'font-size'],\r\n        b: ['color', 'font-size'],\r\n        i: ['color', 'font-size'],\r\n        strong: ['color', 'font-size'],\r\n        strike: ['color', 'font-size'],\r\n        u: ['color', 'font-size'],\r\n        p: ['margin-left', 'text-align'],\r\n        h1: ['margin-left', 'text-align'],\r\n        h2: ['margin-left', 'text-align'],\r\n        h3: ['margin-left', 'text-align'],\r\n        h4: ['margin-left', 'text-align']\r\n      }, this.opts.allowedStyles);\r\n      return this.editor.body.on('click', 'a', function(e) {\r\n        return false;\r\n      });\r\n    },\r\n\r\n    decorate : function($el) {\r\n      if ($el == null) {\r\n        $el = this.editor.body;\r\n      }\r\n      this.editor.trigger('decorate', [$el]);\r\n      return $el;\r\n    },\r\n\r\n    undecorate : function($el) {\r\n      if ($el == null) {\r\n        $el = this.editor.body.clone();\r\n      }\r\n      this.editor.trigger('undecorate', [$el]);\r\n      return $el;\r\n    },\r\n\r\n    autolink : function($el) {\r\n      var $link, $node, findLinkNode, k, lastIndex, len, linkNodes, match, re, replaceEls, subStr, text, uri;\r\n      if ($el == null) {\r\n        $el = this.editor.body;\r\n      }\r\n      linkNodes = [];\r\n      findLinkNode = function($parentNode) {\r\n        return $parentNode.contents().each(function(i, node) {\r\n          var $node, text;\r\n          $node = $(node);\r\n          if ($node.is('a') || $node.closest('a, pre', $el).length) {\r\n            return;\r\n          }\r\n          if (!$node.is('iframe') && $node.contents().length) {\r\n            return findLinkNode($node);\r\n          } else if ((text = $node.text()) && /https?:\\/\\/|www\\./ig.test(text)) {\r\n            return linkNodes.push($node);\r\n          }\r\n        });\r\n      };\r\n      findLinkNode($el);\r\n      re = /(https?:\\/\\/|www\\.)[\\w\\-\\.\\?&=\\/#%:,@\\!\\+]+/ig;\r\n      for (k = 0, len = linkNodes.length; k < len; k++) {\r\n        $node = linkNodes[k];\r\n        text = $node.text();\r\n        replaceEls = [];\r\n        match = null;\r\n        lastIndex = 0;\r\n        while ((match = re.exec(text)) !== null) {\r\n          subStr = text.substring(lastIndex, match.index);\r\n          replaceEls.push(document.createTextNode(subStr));\r\n          lastIndex = re.lastIndex;\r\n          uri = /^(http(s)?:\\/\\/|\\/)/.test(match[0]) ? match[0] : 'http://' + match[0];\r\n          $link = $(\"<a href=\\\"\" + uri + \"\\\" rel=\\\"nofollow\\\"></a>\").text(match[0]);\r\n          replaceEls.push($link[0]);\r\n        }\r\n        replaceEls.push(document.createTextNode(text.substring(lastIndex)));\r\n        $node.replaceWith($(replaceEls));\r\n      }\r\n      return $el;\r\n    },\r\n\r\n    format : function($el) {\r\n      var $node, blockNode, k, l, len, len1, n, node, ref, ref1;\r\n      if ($el == null) {\r\n        $el = this.editor.body;\r\n      }\r\n      if ($el.is(':empty')) {\r\n        $el.append('<p>' + this.editor.util.phBr + '</p>');\r\n        return $el;\r\n      }\r\n      ref = $el.contents();\r\n      for (k = 0, len = ref.length; k < len; k++) {\r\n        n = ref[k];\r\n        this.cleanNode(n, true);\r\n      }\r\n      ref1 = $el.contents();\r\n      for (l = 0, len1 = ref1.length; l < len1; l++) {\r\n        node = ref1[l];\r\n        $node = $(node);\r\n        if ($node.is('br')) {\r\n          if (typeof blockNode !== \"undefined\" && blockNode !== null) {\r\n            blockNode = null;\r\n          }\r\n          $node.remove();\r\n        } else if (this.editor.util.isBlockNode(node)) {\r\n          if ($node.is('li')) {\r\n            if (blockNode && blockNode.is('ul, ol')) {\r\n              blockNode.append(node);\r\n            } else {\r\n              blockNode = $('<ul/>').insertBefore(node);\r\n              blockNode.append(node);\r\n            }\r\n          } else {\r\n            blockNode = null;\r\n          }\r\n        } else {\r\n          if (!blockNode || blockNode.is('ul, ol')) {\r\n            blockNode = $('<p/>').insertBefore(node);\r\n          }\r\n          blockNode.append(node);\r\n          if (this.editor.util.isEmptyNode(blockNode)) {\r\n            blockNode.append(this.editor.util.phBr);\r\n          }\r\n        }\r\n      }\r\n      return $el;\r\n    },\r\n\r\n    cleanNode : function(node, recursive) {\r\n      var $blockEls, $childImg, $node, $p, $td, allowedAttributes, attr, contents, isDecoration, k, l, len, len1, n, ref, ref1, text, textNode;\r\n      $node = $(node);\r\n      if (!($node.length > 0)) {\r\n        return;\r\n      }\r\n      if ($node[0].nodeType === 3) {\r\n        text = $node.text().replace(/(\\r\\n|\\n|\\r)/gm, '');\r\n        if (text) {\r\n          textNode = document.createTextNode(text);\r\n          $node.replaceWith(textNode);\r\n        } else {\r\n          $node.remove();\r\n        }\r\n        return;\r\n      }\r\n      contents = $node.is('iframe') ? null : $node.contents();\r\n      isDecoration = this.editor.util.isDecoratedNode($node);\r\n      if ($node.is(this._allowedTags.join(',')) || isDecoration) {\r\n        if ($node.is('a') && ($childImg = $node.find('img')).length > 0) {\r\n          $node.replaceWith($childImg);\r\n          $node = $childImg;\r\n          contents = null;\r\n        }\r\n        if ($node.is('td') && ($blockEls = $node.find(this.editor.util.blockNodes.join(','))).length > 0) {\r\n          $blockEls.each((function(_this) {\r\n            return function(i, blockEl) {\r\n              return $(blockEl).contents().unwrap();\r\n            };\r\n          })(this));\r\n          contents = $node.contents();\r\n        }\r\n        if ($node.is('img') && $node.hasClass('uploading')) {\r\n          $node.remove();\r\n        }\r\n        if (!isDecoration) {\r\n          allowedAttributes = this._allowedAttributes[$node[0].tagName.toLowerCase()];\r\n          ref = $.makeArray($node[0].attributes);\r\n          for (k = 0, len = ref.length; k < len; k++) {\r\n            attr = ref[k];\r\n            if (attr.name === 'style') {\r\n              continue;\r\n            }\r\n            if (!((allowedAttributes != null) && (ref1 = attr.name, indexOf.call(allowedAttributes, ref1) >= 0))) {\r\n              $node.removeAttr(attr.name);\r\n            }\r\n          }\r\n          this._cleanNodeStyles($node);\r\n          if ($node.is('span')) {\r\n            if ($node[0].attributes.length === 0) {\r\n              $node.contents().first().unwrap();\r\n            }\r\n            if ($node[0].style.length === 2 && $node[0].style.color === 'rgb(51, 51, 51)' && $node[0].style.fontSize === '16px') {\r\n              $node.contents().unwrap();\r\n            }\r\n          }\r\n        }\r\n      } else if ($node[0].nodeType === 1 && !$node.is(':empty')) {\r\n        if ($node.is('div, article, dl, header, footer, tr')) {\r\n          $node.append('<br/>');\r\n          contents.first().unwrap();\r\n        } else if ($node.is('table')) {\r\n          $p = $('<p/>');\r\n          $node.find('tr').each(function(i, tr) {\r\n            return $p.append($(tr).text() + '<br/>');\r\n          });\r\n          $node.replaceWith($p);\r\n          contents = null;\r\n        } else if ($node.is('thead, tfoot')) {\r\n          $node.remove();\r\n          contents = null;\r\n        } else if ($node.is('th')) {\r\n          $td = $('<td/>').append($node.contents());\r\n          $node.replaceWith($td);\r\n        } else {\r\n          contents.first().unwrap();\r\n        }\r\n      } else {\r\n        $node.remove();\r\n        contents = null;\r\n      }\r\n      if (recursive && (contents != null) && !$node.is('pre')) {\r\n        for (l = 0, len1 = contents.length; l < len1; l++) {\r\n          n = contents[l];\r\n          this.cleanNode(n, true);\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n\r\n    _cleanNodeStyles : function($node) {\r\n      var allowedStyles, k, len, pair, ref, ref1, style, styleStr, styles;\r\n      styleStr = $node.attr('style');\r\n      if (!styleStr) {\r\n        return;\r\n      }\r\n      $node.removeAttr('style');\r\n      allowedStyles = this._allowedStyles[$node[0].tagName.toLowerCase()];\r\n      if (!(allowedStyles && allowedStyles.length > 0)) {\r\n        return $node;\r\n      }\r\n      styles = {};\r\n      ref = styleStr.split(';');\r\n      for (k = 0, len = ref.length; k < len; k++) {\r\n        style = ref[k];\r\n        style = $.trim(style);\r\n        pair = style.split(':');\r\n        if (pair.length !== 2) {\r\n          continue;\r\n        }\r\n        if (pair[0] === 'font-size' && pair[1].indexOf('px') > 0) {\r\n          if (parseInt(pair[1], 10) < 12) {\r\n            continue;\r\n          }\r\n        }\r\n        if (ref1 = pair[0], indexOf.call(allowedStyles, ref1) >= 0) {\r\n          styles[$.trim(pair[0])] = $.trim(pair[1]);\r\n        }\r\n      }\r\n      if (Object.keys(styles).length > 0) {\r\n        $node.css(styles);\r\n      }\r\n      return $node;\r\n    },\r\n\r\n    clearHtml : function(html, lineBreak) {\r\n      var container, contents, result;\r\n      if (lineBreak == null) {\r\n        lineBreak = true;\r\n      }\r\n      container = $('<div/>').append(html);\r\n      contents = container.contents();\r\n      result = '';\r\n      contents.each((function(_this) {\r\n        return function(i, node) {\r\n          var $node, children;\r\n          if (node.nodeType === 3) {\r\n            return result += node.nodeValue;\r\n          } else if (node.nodeType === 1) {\r\n            $node = $(node);\r\n            children = $node.is('iframe') ? null : $node.contents();\r\n            if (children && children.length > 0) {\r\n              result += _this.clearHtml(children);\r\n            }\r\n            if (lineBreak && i < contents.length - 1 && $node.is('br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header')) {\r\n              return result += '\\n';\r\n            }\r\n          }\r\n        };\r\n      })(this));\r\n      return result;\r\n    },\r\n\r\n    beautify : function($contents) {\r\n      var uselessP;\r\n      uselessP = function($el) {\r\n        return !!($el.is('p') && !$el.text() && $el.children(':not(br)').length < 1);\r\n      };\r\n      return $contents.each(function(i, el) {\r\n        var $el, invalid;\r\n        $el = $(el);\r\n        invalid = $el.is(':not(img, br, col, td, hr, [class^=\"simditor-\"]):empty');\r\n        if (invalid || uselessP($el)) {\r\n          $el.remove();\r\n        }\r\n        return $el.find(':not(img, br, col, td, hr, [class^=\"simditor-\"]):empty').remove();\r\n      });\r\n    }\r\n\r\n  });\r\n\r\n  Formatter.pluginName = 'Formatter';\r\n\r\n  return Formatter;\r\n\r\n});"]}