{"version":3,"sources":["Popover.js"],"names":["define","$","extend","Module","Simditor","Popover","inherit","init","opts","this","button","editor","prototype","call","offset","top","left","target","active","_init","_this","el","appendTo","data","render","on","e","addClass","removeClass","_initLabelWidth","$fields","find","length","_labelWidth","each","i","field","$label","Math","max","width","show","$target","position","siblings","popover","hide","refresh","trigger","css","util","reflow","editorOffset","maxLeft","targetH","targetOffset","outerHeight","height","wrapper","outerWidth","min","destroy","off","remove","_t","args","ref","result","arguments","Array","slice","apply"],"mappings":"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","file":"../Popover.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"./_extend\",\r\n  \"./Module\",\r\n  \"./Simditor\"\r\n],function($,extend,Module,Simditor){ \r\n\r\n  var Popover = Module.inherit({\r\n     init : function(opts) {\r\n      this.button = opts.button;\r\n      this.editor = opts.button.editor;\r\n      Module.prototype.init.call(this, opts);\r\n    }\r\n  });\r\n\r\n\r\n  Popover.prototype.offset = {\r\n    top: 4,\r\n    left: 0\r\n  };\r\n\r\n  Popover.prototype.target = null;\r\n\r\n  Popover.prototype.active = false;\r\n\r\n  Popover.prototype._init = function() {\r\n    this.el = $('<div class=\"simditor-popover\"></div>').appendTo(this.editor.el).data('popover', this);\r\n    this.render();\r\n    this.el.on('mouseenter', (function(_this) {\r\n      return function(e) {\r\n        return _this.el.addClass('hover');\r\n      };\r\n    })(this));\r\n    return this.el.on('mouseleave', (function(_this) {\r\n      return function(e) {\r\n        return _this.el.removeClass('hover');\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  Popover.prototype.render = function() {};\r\n\r\n  Popover.prototype._initLabelWidth = function() {\r\n    var $fields;\r\n    $fields = this.el.find('.settings-field');\r\n    if (!($fields.length > 0)) {\r\n      return;\r\n    }\r\n    this._labelWidth = 0;\r\n    $fields.each((function(_this) {\r\n      return function(i, field) {\r\n        var $field, $label;\r\n        $field = $(field);\r\n        $label = $field.find('label');\r\n        if (!($label.length > 0)) {\r\n          return;\r\n        }\r\n        return _this._labelWidth = Math.max(_this._labelWidth, $label.width());\r\n      };\r\n    })(this));\r\n    return $fields.find('label').width(this._labelWidth);\r\n  };\r\n\r\n  Popover.prototype.show = function($target, position) {\r\n    if (position == null) {\r\n      position = 'bottom';\r\n    }\r\n    if ($target == null) {\r\n      return;\r\n    }\r\n    this.el.siblings('.simditor-popover').each(function(i, popover) {\r\n      popover = $(popover).data('popover');\r\n      if (popover.active) {\r\n        return popover.hide();\r\n      }\r\n    });\r\n    if (this.active && this.target) {\r\n      this.target.removeClass('selected');\r\n    }\r\n    this.target = $target.addClass('selected');\r\n    if (this.active) {\r\n      this.refresh(position);\r\n      return this.trigger('popovershow');\r\n    } else {\r\n      this.active = true;\r\n      this.el.css({\r\n        left: -9999\r\n      }).show();\r\n      if (!this._labelWidth) {\r\n        this._initLabelWidth();\r\n      }\r\n      this.editor.util.reflow();\r\n      this.refresh(position);\r\n      return this.trigger('popovershow');\r\n    }\r\n  };\r\n\r\n  Popover.prototype.hide = function() {\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    if (this.target) {\r\n      this.target.removeClass('selected');\r\n    }\r\n    this.target = null;\r\n    this.active = false;\r\n    this.el.hide();\r\n    return this.trigger('popoverhide');\r\n  };\r\n\r\n  Popover.prototype.refresh = function(position) {\r\n    var editorOffset, left, maxLeft, targetH, targetOffset, top;\r\n    if (position == null) {\r\n      position = 'bottom';\r\n    }\r\n    if (!this.active) {\r\n      return;\r\n    }\r\n    editorOffset = this.editor.el.offset();\r\n    targetOffset = this.target.offset();\r\n    targetH = this.target.outerHeight();\r\n    if (position === 'bottom') {\r\n      top = targetOffset.top - editorOffset.top + targetH;\r\n    } else if (position === 'top') {\r\n      top = targetOffset.top - editorOffset.top - this.el.height();\r\n    }\r\n    maxLeft = this.editor.wrapper.width() - this.el.outerWidth() - 10;\r\n    left = Math.min(targetOffset.left - editorOffset.left, maxLeft);\r\n    return this.el.css({\r\n      top: top + this.offset.top,\r\n      left: left + this.offset.left\r\n    });\r\n  };\r\n\r\n  Popover.prototype.destroy = function() {\r\n    this.target = null;\r\n    this.active = false;\r\n    this.editor.off('.linkpopover');\r\n    return this.el.remove();\r\n  };\r\n\r\n  Popover.prototype._t = function() {\r\n    var args, ref, result;\r\n    args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n    result = Module.prototype._t.apply(this, args);\r\n    if (!result) {\r\n      result = (ref = this.button)._t.apply(ref, args);\r\n    }\r\n    return result;\r\n  };\r\n\r\n  Simditor.Popover = Popover;\r\n\r\n  return Popover;\r\n\r\n\t\r\n});"]}