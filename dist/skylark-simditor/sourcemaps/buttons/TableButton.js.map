{"version":3,"sources":["buttons/TableButton.js"],"names":["define","tables","$","extend","SimpleModule","Toolbar","Simditor","Button","TableButton","inherit","prototype","name","icon","htmlTag","disableTag","menu","_init","_this","call","this","merge","editor","formatter","_allowedTags","_allowedAttributes","td","col","_allowedStyles","th","_initShortcuts","_initResize","on","e","$el","find","each","i","table","decorate","undecorate","$container","range","body","removeClass","selection","containerNode","collapsed","is","setRangeAtEndOf","closest","addClass","keystroke","add","$node","_tdNav","$td","direction","$anotherTr","$tr","action","index","ref","parent","length","eq","$editor","document","$col","$colgroup","$resizeHandle","$wrapper","ref1","parents","hasClass","currentTarget","pageX","offset","left","prev","next","hide","data","show","css","position","outerWidth","$handle","$leftCol","$leftTd","$rightCol","$rightTd","startHandleLeft","startLeftWidth","startRightWidth","startX","tableWidth","parseFloat","width","deltaX","leftWidth","rightWidth","attr","one","sync","off","hotkeys","editMenu","click","renderMenu","$table","_t","appendTo","menuWrapper","createMenu","createTable","$trs","num","prevAll","addBack","$closestBlock","colNum","rowNum","wrapper","inputManager","focused","blockNodes","last","util","isEmptyNode","replaceWith","after","setRangeAtStartOf","trigger","tableDecorate","resizeHandle","row","phBr","refreshTableWidth","setActive","active","deleteRow","ret","self","newTr","insertRow","deleteCol","newTd","insertCol","deleteTable","$block","command","param","addButton"],"mappings":"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","file":"../../buttons/TableButton.js","sourcesContent":["define([\r\n  \"skylark-utils-dom/tables\",\r\n  \"skylark-jquery\",\r\n  \"../_extend\",\r\n  \"../Module\",\r\n  \"../Toolbar\",\r\n  \"../Simditor\",\r\n  \"../Button\"\r\n],function(tables,$,extend,SimpleModule,Toolbar,Simditor,Button){ \r\n  var TableButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n  TableButton.prototype.name = 'table';\r\n\r\n  TableButton.prototype.icon = 'table';\r\n\r\n  TableButton.prototype.htmlTag = 'table';\r\n\r\n  TableButton.prototype.disableTag = 'pre, li, blockquote';\r\n\r\n  TableButton.prototype.menu = true;\r\n\r\n  TableButton.prototype._init = function() {\r\n    Button.prototype._init.call(this);\r\n    $.merge(this.editor.formatter._allowedTags, ['thead', 'th', 'tbody', 'tr', 'td', 'colgroup', 'col']);\r\n    $.extend(this.editor.formatter._allowedAttributes, {\r\n      td: ['rowspan', 'colspan'],\r\n      col: ['width']\r\n    });\r\n    $.extend(this.editor.formatter._allowedStyles, {\r\n      td: ['text-align'],\r\n      th: ['text-align']\r\n    });\r\n    this._initShortcuts();\r\n    this._initResize();\r\n    this.editor.on('decorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('table').each(function(i, table) {\r\n          return _this.decorate($(table));\r\n        });\r\n      };\r\n    })(this));\r\n    this.editor.on('undecorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('table').each(function(i, table) {\r\n          return _this.undecorate($(table));\r\n        });\r\n      };\r\n    })(this));\r\n    this.editor.on('selectionchanged.table', (function(_this) {\r\n      return function(e) {\r\n        var $container, range;\r\n        _this.editor.body.find('.simditor-table td, .simditor-table th').removeClass('active');\r\n        range = _this.editor.selection.range();\r\n        if (!range) {\r\n          return;\r\n        }\r\n        $container = _this.editor.selection.containerNode();\r\n        if (range.collapsed && $container.is('.simditor-table')) {\r\n          _this.editor.selection.setRangeAtEndOf($container);\r\n        }\r\n        return $container.closest('td, th', _this.editor.body).addClass('active');\r\n      };\r\n    })(this));\r\n    this.editor.on('blur.table', (function(_this) {\r\n      return function(e) {\r\n        return _this.editor.body.find('.simditor-table td, .simditor-table th').removeClass('active');\r\n      };\r\n    })(this));\r\n    this.editor.keystroke.add('up', 'td', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'up');\r\n        return true;\r\n      };\r\n    })(this));\r\n    this.editor.keystroke.add('up', 'th', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'up');\r\n        return true;\r\n      };\r\n    })(this));\r\n    this.editor.keystroke.add('down', 'td', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'down');\r\n        return true;\r\n      };\r\n    })(this));\r\n    return this.editor.keystroke.add('down', 'th', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'down');\r\n        return true;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype._tdNav = function($td, direction) {\r\n    var $anotherTr, $tr, action, anotherTag, index, parentTag, ref;\r\n    if (direction == null) {\r\n      direction = 'up';\r\n    }\r\n    action = direction === 'up' ? 'prev' : 'next';\r\n    ref = direction === 'up' ? ['tbody', 'thead'] : ['thead', 'tbody'], parentTag = ref[0], anotherTag = ref[1];\r\n    $tr = $td.parent('tr');\r\n    $anotherTr = this[\"_\" + action + \"Row\"]($tr);\r\n    if (!($anotherTr.length > 0)) {\r\n      return true;\r\n    }\r\n    index = $tr.find('td, th').index($td);\r\n    return this.editor.selection.setRangeAtEndOf($anotherTr.find('td, th').eq(index));\r\n  };\r\n\r\n  TableButton.prototype._initResize = function() {\r\n    var $editor;\r\n    $editor = this.editor;\r\n    $(document).on('mousemove.simditor-table', '.simditor-table td, .simditor-table th', function(e) {\r\n      var $col, $colgroup, $resizeHandle, $td, $wrapper, index, ref, ref1, x;\r\n      $wrapper = $(this).parents('.simditor-table');\r\n      $resizeHandle = $wrapper.find('.simditor-resize-handle');\r\n      $colgroup = $wrapper.find('colgroup');\r\n      if ($wrapper.hasClass('resizing')) {\r\n        return;\r\n      }\r\n      $td = $(e.currentTarget);\r\n      x = e.pageX - $(e.currentTarget).offset().left;\r\n      if (x < 5 && $td.prev().length > 0) {\r\n        $td = $td.prev();\r\n      }\r\n      if ($td.next('td, th').length < 1) {\r\n        $resizeHandle.hide();\r\n        return;\r\n      }\r\n      if ((ref = $resizeHandle.data('td')) != null ? ref.is($td) : void 0) {\r\n        $resizeHandle.show();\r\n        return;\r\n      }\r\n      index = $td.parent().find('td, th').index($td);\r\n      $col = $colgroup.find('col').eq(index);\r\n      if ((ref1 = $resizeHandle.data('col')) != null ? ref1.is($col) : void 0) {\r\n        $resizeHandle.show();\r\n        return;\r\n      }\r\n      return $resizeHandle.css('left', $td.position().left + $td.outerWidth() - 5).data('td', $td).data('col', $col).show();\r\n    });\r\n\r\n    $(document).on('mouseleave.simditor-table', '.simditor-table', function(e) {\r\n      return $(this).find('.simditor-resize-handle').hide();\r\n    });\r\n    return $(document).on('mousedown.simditor-resize-handle', '.simditor-resize-handle', function(e) {\r\n      var $handle, $leftCol, $leftTd, $rightCol, $rightTd, $wrapper, minWidth, startHandleLeft, startLeftWidth, startRightWidth, startX, tableWidth;\r\n      $wrapper = $(this).parent('.simditor-table');\r\n      $handle = $(e.currentTarget);\r\n      $leftTd = $handle.data('td');\r\n      $leftCol = $handle.data('col');\r\n      $rightTd = $leftTd.next('td, th');\r\n      $rightCol = $leftCol.next('col');\r\n      startX = e.pageX;\r\n      startLeftWidth = $leftTd.outerWidth() * 1;\r\n      startRightWidth = $rightTd.outerWidth() * 1;\r\n      startHandleLeft = parseFloat($handle.css('left'));\r\n      tableWidth = $leftTd.closest('table').width();\r\n      minWidth = 50;\r\n      $(document).on('mousemove.simditor-resize-table', function(e) {\r\n        var deltaX, leftWidth, rightWidth;\r\n        deltaX = e.pageX - startX;\r\n        leftWidth = startLeftWidth + deltaX;\r\n        rightWidth = startRightWidth - deltaX;\r\n        if (leftWidth < minWidth) {\r\n          leftWidth = minWidth;\r\n          deltaX = minWidth - startLeftWidth;\r\n          rightWidth = startRightWidth - deltaX;\r\n        } else if (rightWidth < minWidth) {\r\n          rightWidth = minWidth;\r\n          deltaX = startRightWidth - minWidth;\r\n          leftWidth = startLeftWidth + deltaX;\r\n        }\r\n        $leftCol.attr('width', (leftWidth / tableWidth * 100) + '%');\r\n        $rightCol.attr('width', (rightWidth / tableWidth * 100) + '%');\r\n        return $handle.css('left', startHandleLeft + deltaX);\r\n      });\r\n      $(document).one('mouseup.simditor-resize-table', function(e) {\r\n        $editor.sync();\r\n        $(document).off('.simditor-resize-table');\r\n        return $wrapper.removeClass('resizing');\r\n      });\r\n      $wrapper.addClass('resizing');\r\n      return false;\r\n    });\r\n  };\r\n\r\n  TableButton.prototype._initShortcuts = function() {\r\n    this.editor.hotkeys.add('ctrl+alt+up', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertRowAbove]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    this.editor.hotkeys.add('ctrl+alt+down', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertRowBelow]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    this.editor.hotkeys.add('ctrl+alt+left', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertColLeft]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    return this.editor.hotkeys.add('ctrl+alt+right', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertColRight]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype.renderMenu = function() {\r\n    var $table;\r\n    $(\"<div class=\\\"menu-create-table\\\">\\n</div>\\n<div class=\\\"menu-edit-table\\\">\\n  <ul>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteRow\\\">\\n        <span>\" + (this._t('deleteRow')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowAbove\\\">\\n        <span>\" + (this._t('insertRowAbove')) + \" ( Ctrl + Alt + ↑ )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowBelow\\\">\\n        <span>\" + (this._t('insertRowBelow')) + \" ( Ctrl + Alt + ↓ )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteCol\\\">\\n        <span>\" + (this._t('deleteColumn')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColLeft\\\">\\n        <span>\" + (this._t('insertColumnLeft')) + \" ( Ctrl + Alt + ← )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColRight\\\">\\n        <span>\" + (this._t('insertColumnRight')) + \" ( Ctrl + Alt + → )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteTable\\\">\\n        <span>\" + (this._t('deleteTable')) + \"</span>\\n      </a>\\n    </li>\\n  </ul>\\n</div>\").appendTo(this.menuWrapper);\r\n    this.createMenu = this.menuWrapper.find('.menu-create-table');\r\n    this.editMenu = this.menuWrapper.find('.menu-edit-table');\r\n    $table = this.createTable(6, 6).appendTo(this.createMenu);\r\n    this.createMenu.on('mouseenter', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $td, $tr, $trs, num;\r\n        _this.createMenu.find('td, th').removeClass('selected');\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        num = $tr.find('td, th').index($td) + 1;\r\n        $trs = $tr.prevAll('tr').addBack();\r\n        if ($tr.parent().is('tbody')) {\r\n          $trs = $trs.add($table.find('thead tr'));\r\n        }\r\n        return $trs.find(\"td:lt(\" + num + \"), th:lt(\" + num + \")\").addClass('selected');\r\n      };\r\n    })(this));\r\n    this.createMenu.on('mouseleave', function(e) {\r\n      return $(e.currentTarget).find('td, th').removeClass('selected');\r\n    });\r\n    return this.createMenu.on('mousedown', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $closestBlock, $td, $tr, colNum, rowNum;\r\n        _this.wrapper.removeClass('menu-on');\r\n        if (!_this.editor.inputManager.focused) {\r\n          return;\r\n        }\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        colNum = $tr.find('td').index($td) + 1;\r\n        rowNum = $tr.prevAll('tr').length + 1;\r\n        if ($tr.parent().is('tbody')) {\r\n          rowNum += 1;\r\n        }\r\n        $table = _this.createTable(rowNum, colNum, true);\r\n        $closestBlock = _this.editor.selection.blockNodes().last();\r\n        if (_this.editor.util.isEmptyNode($closestBlock)) {\r\n          $closestBlock.replaceWith($table);\r\n        } else {\r\n          $closestBlock.after($table);\r\n        }\r\n        _this.decorate($table);\r\n        _this.editor.selection.setRangeAtStartOf($table.find('th:first'));\r\n        _this.editor.trigger('valuechanged');\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype.decorate = function($table) {\r\n    return $(tables.decorate($table[0],{\r\n      tableDecorate : 'simditor-table',\r\n      resizeHandle : 'simditor-resize-handle'\r\n    }));\r\n\r\n  };\r\n\r\n  TableButton.prototype.undecorate = function($table) {\r\n    return $(tables.undecorate($table[0],{\r\n      tableDecorate : 'simditor-table',\r\n      resizeHandle : 'simditor-resize-handle'\r\n    }));\r\n\r\n  };\r\n\r\n\r\n  TableButton.prototype.createTable = function(row, col, phBr) {\r\n    return $(tables.createTable(row,col,phBr ? this.editor.util.phBr : null));\r\n  };\r\n\r\n  TableButton.prototype.refreshTableWidth = function($table) {\r\n    return table.refreshTableWidth($table[0]);\r\n  };\r\n\r\n  TableButton.prototype.setActive = function(active) {\r\n    Button.prototype.setActive.call(this, active);\r\n    if (active) {\r\n      this.createMenu.hide();\r\n      return this.editMenu.show();\r\n    } else {\r\n      this.createMenu.show();\r\n      return this.editMenu.hide();\r\n    }\r\n  };\r\n\r\n  TableButton.prototype.deleteRow = function($td) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.deleteRow($td[0],function(newTr,index){\r\n      if (newTr) {\r\n        ret = self.editor.selection.setRangeAtEndOf($(newTr).find('td, th').eq(index));\r\n      }\r\n    })\r\n\r\n    return ret;\r\n  };\r\n\r\n  TableButton.prototype.insertRow = function($td, direction) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.insertRow($td[0],direction,self.editor.util.phBr,function(newTr,index){\r\n      ret =  self.editor.selection.setRangeAtStartOf($(newTr).find('td, th').eq(index));\r\n    })\r\n\r\n    return ret;\r\n\r\n  };\r\n\r\n  TableButton.prototype.deleteCol = function($td) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.deleteCol($td[0],function(newTd){\r\n      if (newTd) {\r\n        ret = self.editor.selection.setRangeAtEndOf($(newTd));\r\n      }\r\n    })\r\n\r\n    return ret;\r\n  };\r\n\r\n  TableButton.prototype.insertCol = function($td, direction) {\r\n    var self = this,\r\n        ret; \r\n\r\n    tables.insertCol($td[0],direction,self.editor.util.phBr,function(newTd){\r\n      ret = self.editor.selection.setRangeAtStartOf($(newTd));\r\n    })\r\n\r\n    return ret;\r\n  };\r\n\r\n  TableButton.prototype.deleteTable = function($td) {\r\n    var self = this;\r\n    tables.deleteTable($td[0],function($block){\r\n      if ($block.length > 0) {\r\n        return self.editor.selection.setRangeAtStartOf($block);\r\n      }\r\n    });\r\n  };\r\n\r\n  TableButton.prototype.command = function(param) {\r\n    var $td;\r\n    $td = this.editor.selection.containerNode().closest('td, th');\r\n    if (!($td.length > 0)) {\r\n      return;\r\n    }\r\n    if (param === 'deleteRow') {\r\n      this.deleteRow($td);\r\n    } else if (param === 'insertRowAbove') {\r\n      this.insertRow($td, 'before');\r\n    } else if (param === 'insertRowBelow') {\r\n      this.insertRow($td);\r\n    } else if (param === 'deleteCol') {\r\n      this.deleteCol($td);\r\n    } else if (param === 'insertColLeft') {\r\n      this.insertCol($td, 'before');\r\n    } else if (param === 'insertColRight') {\r\n      this.insertCol($td);\r\n    } else if (param === 'deleteTable') {\r\n      this.deleteTable($td);\r\n    } else {\r\n      return;\r\n    }\r\n    return this.editor.trigger('valuechanged');\r\n  };\r\n\r\n  Simditor.Toolbar.addButton(TableButton);\r\n\r\n  return TableButton;\r\n\r\n\r\n});"]}