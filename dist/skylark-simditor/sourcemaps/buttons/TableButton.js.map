{"version":3,"sources":["buttons/TableButton.js"],"names":["define","$","extend","SimpleModule","Toolbar","Simditor","Button","TableButton","inherit","prototype","name","icon","htmlTag","disableTag","menu","_init","_this","call","this","merge","editor","formatter","_allowedTags","_allowedAttributes","td","col","_allowedStyles","th","_initShortcuts","_initResize","on","e","$el","find","each","i","table","decorate","undecorate","$container","range","body","removeClass","selection","containerNode","collapsed","is","setRangeAtEndOf","closest","addClass","keystroke","add","$node","_tdNav","$td","direction","$anotherTr","$tr","action","index","ref","parent","length","eq","_nextRow","$nextTr","next","_prevRow","$prevTr","prev","$editor","document","$col","$colgroup","$resizeHandle","$wrapper","ref1","parents","hasClass","currentTarget","pageX","offset","left","hide","data","show","css","position","outerWidth","$handle","$leftCol","$leftTd","$rightCol","$rightTd","startHandleLeft","startLeftWidth","startRightWidth","startX","tableWidth","parseFloat","width","deltaX","leftWidth","rightWidth","attr","one","sync","off","hotkeys","editMenu","click","$table","$headRow","$tbody","$thead","wrap","first","append","_changeCellTag","before","prepend","prependTo","appendTo","refreshTableWidth","class","contenteditable","replaceWith","renderMenu","_t","menuWrapper","createMenu","createTable","$trs","num","prevAll","addBack","$closestBlock","colNum","rowNum","wrapper","inputManager","focused","blockNodes","last","util","isEmptyNode","after","setRangeAtStartOf","trigger","row","phBr","k","l","r","setTimeout","cols","setActive","active","tagName","cell","$cell","html","deleteRow","$newTr","deleteTable","remove","insertRow","cellTag","tr","Math","max","deleteCol","$newTd","noOtherCol","noOtherRow","siblings","insertCol","$newCol","$block","command","param","addButton"],"mappings":"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","file":"../../buttons/TableButton.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"../_extend\",\r\n  \"../Module\",\r\n  \"../Toolbar\",\r\n  \"../Simditor\",\r\n  \"../Button\"\r\n],function($,extend,SimpleModule,Toolbar,Simditor,Button){ \r\n  var TableButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n  TableButton.prototype.name = 'table';\r\n\r\n  TableButton.prototype.icon = 'table';\r\n\r\n  TableButton.prototype.htmlTag = 'table';\r\n\r\n  TableButton.prototype.disableTag = 'pre, li, blockquote';\r\n\r\n  TableButton.prototype.menu = true;\r\n\r\n  TableButton.prototype._init = function() {\r\n    Button.prototype._init.call(this);\r\n    $.merge(this.editor.formatter._allowedTags, ['thead', 'th', 'tbody', 'tr', 'td', 'colgroup', 'col']);\r\n    $.extend(this.editor.formatter._allowedAttributes, {\r\n      td: ['rowspan', 'colspan'],\r\n      col: ['width']\r\n    });\r\n    $.extend(this.editor.formatter._allowedStyles, {\r\n      td: ['text-align'],\r\n      th: ['text-align']\r\n    });\r\n    this._initShortcuts();\r\n    this._initResize();\r\n    this.editor.on('decorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('table').each(function(i, table) {\r\n          return _this.decorate($(table));\r\n        });\r\n      };\r\n    })(this));\r\n    this.editor.on('undecorate', (function(_this) {\r\n      return function(e, $el) {\r\n        return $el.find('table').each(function(i, table) {\r\n          return _this.undecorate($(table));\r\n        });\r\n      };\r\n    })(this));\r\n    this.editor.on('selectionchanged.table', (function(_this) {\r\n      return function(e) {\r\n        var $container, range;\r\n        _this.editor.body.find('.simditor-table td, .simditor-table th').removeClass('active');\r\n        range = _this.editor.selection.range();\r\n        if (!range) {\r\n          return;\r\n        }\r\n        $container = _this.editor.selection.containerNode();\r\n        if (range.collapsed && $container.is('.simditor-table')) {\r\n          _this.editor.selection.setRangeAtEndOf($container);\r\n        }\r\n        return $container.closest('td, th', _this.editor.body).addClass('active');\r\n      };\r\n    })(this));\r\n    this.editor.on('blur.table', (function(_this) {\r\n      return function(e) {\r\n        return _this.editor.body.find('.simditor-table td, .simditor-table th').removeClass('active');\r\n      };\r\n    })(this));\r\n    this.editor.keystroke.add('up', 'td', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'up');\r\n        return true;\r\n      };\r\n    })(this));\r\n    this.editor.keystroke.add('up', 'th', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'up');\r\n        return true;\r\n      };\r\n    })(this));\r\n    this.editor.keystroke.add('down', 'td', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'down');\r\n        return true;\r\n      };\r\n    })(this));\r\n    return this.editor.keystroke.add('down', 'th', (function(_this) {\r\n      return function(e, $node) {\r\n        _this._tdNav($node, 'down');\r\n        return true;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype._tdNav = function($td, direction) {\r\n    var $anotherTr, $tr, action, anotherTag, index, parentTag, ref;\r\n    if (direction == null) {\r\n      direction = 'up';\r\n    }\r\n    action = direction === 'up' ? 'prev' : 'next';\r\n    ref = direction === 'up' ? ['tbody', 'thead'] : ['thead', 'tbody'], parentTag = ref[0], anotherTag = ref[1];\r\n    $tr = $td.parent('tr');\r\n    $anotherTr = this[\"_\" + action + \"Row\"]($tr);\r\n    if (!($anotherTr.length > 0)) {\r\n      return true;\r\n    }\r\n    index = $tr.find('td, th').index($td);\r\n    return this.editor.selection.setRangeAtEndOf($anotherTr.find('td, th').eq(index));\r\n  };\r\n\r\n  TableButton.prototype._nextRow = function($tr) {\r\n    var $nextTr;\r\n    $nextTr = $tr.next('tr');\r\n    if ($nextTr.length < 1 && $tr.parent('thead').length > 0) {\r\n      $nextTr = $tr.parent('thead').next('tbody').find('tr:first');\r\n    }\r\n    return $nextTr;\r\n  };\r\n\r\n  TableButton.prototype._prevRow = function($tr) {\r\n    var $prevTr;\r\n    $prevTr = $tr.prev('tr');\r\n    if ($prevTr.length < 1 && $tr.parent('tbody').length > 0) {\r\n      $prevTr = $tr.parent('tbody').prev('thead').find('tr');\r\n    }\r\n    return $prevTr;\r\n  };\r\n\r\n  TableButton.prototype._initResize = function() {\r\n    var $editor;\r\n    $editor = this.editor;\r\n    $(document).on('mousemove.simditor-table', '.simditor-table td, .simditor-table th', function(e) {\r\n      var $col, $colgroup, $resizeHandle, $td, $wrapper, index, ref, ref1, x;\r\n      $wrapper = $(this).parents('.simditor-table');\r\n      $resizeHandle = $wrapper.find('.simditor-resize-handle');\r\n      $colgroup = $wrapper.find('colgroup');\r\n      if ($wrapper.hasClass('resizing')) {\r\n        return;\r\n      }\r\n      $td = $(e.currentTarget);\r\n      x = e.pageX - $(e.currentTarget).offset().left;\r\n      if (x < 5 && $td.prev().length > 0) {\r\n        $td = $td.prev();\r\n      }\r\n      if ($td.next('td, th').length < 1) {\r\n        $resizeHandle.hide();\r\n        return;\r\n      }\r\n      if ((ref = $resizeHandle.data('td')) != null ? ref.is($td) : void 0) {\r\n        $resizeHandle.show();\r\n        return;\r\n      }\r\n      index = $td.parent().find('td, th').index($td);\r\n      $col = $colgroup.find('col').eq(index);\r\n      if ((ref1 = $resizeHandle.data('col')) != null ? ref1.is($col) : void 0) {\r\n        $resizeHandle.show();\r\n        return;\r\n      }\r\n      return $resizeHandle.css('left', $td.position().left + $td.outerWidth() - 5).data('td', $td).data('col', $col).show();\r\n    });\r\n    $(document).on('mouseleave.simditor-table', '.simditor-table', function(e) {\r\n      return $(this).find('.simditor-resize-handle').hide();\r\n    });\r\n    return $(document).on('mousedown.simditor-resize-handle', '.simditor-resize-handle', function(e) {\r\n      var $handle, $leftCol, $leftTd, $rightCol, $rightTd, $wrapper, minWidth, startHandleLeft, startLeftWidth, startRightWidth, startX, tableWidth;\r\n      $wrapper = $(this).parent('.simditor-table');\r\n      $handle = $(e.currentTarget);\r\n      $leftTd = $handle.data('td');\r\n      $leftCol = $handle.data('col');\r\n      $rightTd = $leftTd.next('td, th');\r\n      $rightCol = $leftCol.next('col');\r\n      startX = e.pageX;\r\n      startLeftWidth = $leftTd.outerWidth() * 1;\r\n      startRightWidth = $rightTd.outerWidth() * 1;\r\n      startHandleLeft = parseFloat($handle.css('left'));\r\n      tableWidth = $leftTd.closest('table').width();\r\n      minWidth = 50;\r\n      $(document).on('mousemove.simditor-resize-table', function(e) {\r\n        var deltaX, leftWidth, rightWidth;\r\n        deltaX = e.pageX - startX;\r\n        leftWidth = startLeftWidth + deltaX;\r\n        rightWidth = startRightWidth - deltaX;\r\n        if (leftWidth < minWidth) {\r\n          leftWidth = minWidth;\r\n          deltaX = minWidth - startLeftWidth;\r\n          rightWidth = startRightWidth - deltaX;\r\n        } else if (rightWidth < minWidth) {\r\n          rightWidth = minWidth;\r\n          deltaX = startRightWidth - minWidth;\r\n          leftWidth = startLeftWidth + deltaX;\r\n        }\r\n        $leftCol.attr('width', (leftWidth / tableWidth * 100) + '%');\r\n        $rightCol.attr('width', (rightWidth / tableWidth * 100) + '%');\r\n        return $handle.css('left', startHandleLeft + deltaX);\r\n      });\r\n      $(document).one('mouseup.simditor-resize-table', function(e) {\r\n        $editor.sync();\r\n        $(document).off('.simditor-resize-table');\r\n        return $wrapper.removeClass('resizing');\r\n      });\r\n      $wrapper.addClass('resizing');\r\n      return false;\r\n    });\r\n  };\r\n\r\n  TableButton.prototype._initShortcuts = function() {\r\n    this.editor.hotkeys.add('ctrl+alt+up', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertRowAbove]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    this.editor.hotkeys.add('ctrl+alt+down', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertRowBelow]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    this.editor.hotkeys.add('ctrl+alt+left', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertColLeft]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n    return this.editor.hotkeys.add('ctrl+alt+right', (function(_this) {\r\n      return function(e) {\r\n        _this.editMenu.find('.menu-item[data-param=insertColRight]').click();\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype.decorate = function($table) {\r\n    var $colgroup, $headRow, $resizeHandle, $tbody, $thead, $wrapper;\r\n    if ($table.parent('.simditor-table').length > 0) {\r\n      this.undecorate($table);\r\n    }\r\n    $table.wrap('<div class=\"simditor-table\"></div>');\r\n    $wrapper = $table.parent('.simditor-table');\r\n    $colgroup = $table.find('colgroup');\r\n    if ($table.find('thead').length < 1) {\r\n      $thead = $('<thead />');\r\n      $headRow = $table.find('tr').first();\r\n      $thead.append($headRow);\r\n      this._changeCellTag($headRow, 'th');\r\n      $tbody = $table.find('tbody');\r\n      if ($tbody.length > 0) {\r\n        $tbody.before($thead);\r\n      } else {\r\n        $table.prepend($thead);\r\n      }\r\n    }\r\n    if ($colgroup.length < 1) {\r\n      $colgroup = $('<colgroup/>').prependTo($table);\r\n      $table.find('thead tr th').each(function(i, td) {\r\n        var $col;\r\n        return $col = $('<col/>').appendTo($colgroup);\r\n      });\r\n      this.refreshTableWidth($table);\r\n    }\r\n    $resizeHandle = $('<div />', {\r\n      \"class\": 'simditor-resize-handle',\r\n      contenteditable: 'false'\r\n    }).appendTo($wrapper);\r\n    return $table.parent();\r\n  };\r\n\r\n  TableButton.prototype.undecorate = function($table) {\r\n    if (!($table.parent('.simditor-table').length > 0)) {\r\n      return;\r\n    }\r\n    return $table.parent().replaceWith($table);\r\n  };\r\n\r\n  TableButton.prototype.renderMenu = function() {\r\n    var $table;\r\n    $(\"<div class=\\\"menu-create-table\\\">\\n</div>\\n<div class=\\\"menu-edit-table\\\">\\n  <ul>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteRow\\\">\\n        <span>\" + (this._t('deleteRow')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowAbove\\\">\\n        <span>\" + (this._t('insertRowAbove')) + \" ( Ctrl + Alt + ↑ )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertRowBelow\\\">\\n        <span>\" + (this._t('insertRowBelow')) + \" ( Ctrl + Alt + ↓ )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteCol\\\">\\n        <span>\" + (this._t('deleteColumn')) + \"</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColLeft\\\">\\n        <span>\" + (this._t('insertColumnLeft')) + \" ( Ctrl + Alt + ← )</span>\\n      </a>\\n    </li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"insertColRight\\\">\\n        <span>\" + (this._t('insertColumnRight')) + \" ( Ctrl + Alt + → )</span>\\n      </a>\\n    </li>\\n    <li><span class=\\\"separator\\\"></span></li>\\n    <li>\\n      <a tabindex=\\\"-1\\\" unselectable=\\\"on\\\" class=\\\"menu-item\\\"\\n        href=\\\"javascript:;\\\" data-param=\\\"deleteTable\\\">\\n        <span>\" + (this._t('deleteTable')) + \"</span>\\n      </a>\\n    </li>\\n  </ul>\\n</div>\").appendTo(this.menuWrapper);\r\n    this.createMenu = this.menuWrapper.find('.menu-create-table');\r\n    this.editMenu = this.menuWrapper.find('.menu-edit-table');\r\n    $table = this.createTable(6, 6).appendTo(this.createMenu);\r\n    this.createMenu.on('mouseenter', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $td, $tr, $trs, num;\r\n        _this.createMenu.find('td, th').removeClass('selected');\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        num = $tr.find('td, th').index($td) + 1;\r\n        $trs = $tr.prevAll('tr').addBack();\r\n        if ($tr.parent().is('tbody')) {\r\n          $trs = $trs.add($table.find('thead tr'));\r\n        }\r\n        return $trs.find(\"td:lt(\" + num + \"), th:lt(\" + num + \")\").addClass('selected');\r\n      };\r\n    })(this));\r\n    this.createMenu.on('mouseleave', function(e) {\r\n      return $(e.currentTarget).find('td, th').removeClass('selected');\r\n    });\r\n    return this.createMenu.on('mousedown', 'td, th', (function(_this) {\r\n      return function(e) {\r\n        var $closestBlock, $td, $tr, colNum, rowNum;\r\n        _this.wrapper.removeClass('menu-on');\r\n        if (!_this.editor.inputManager.focused) {\r\n          return;\r\n        }\r\n        $td = $(e.currentTarget);\r\n        $tr = $td.parent();\r\n        colNum = $tr.find('td').index($td) + 1;\r\n        rowNum = $tr.prevAll('tr').length + 1;\r\n        if ($tr.parent().is('tbody')) {\r\n          rowNum += 1;\r\n        }\r\n        $table = _this.createTable(rowNum, colNum, true);\r\n        $closestBlock = _this.editor.selection.blockNodes().last();\r\n        if (_this.editor.util.isEmptyNode($closestBlock)) {\r\n          $closestBlock.replaceWith($table);\r\n        } else {\r\n          $closestBlock.after($table);\r\n        }\r\n        _this.decorate($table);\r\n        _this.editor.selection.setRangeAtStartOf($table.find('th:first'));\r\n        _this.editor.trigger('valuechanged');\r\n        return false;\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  TableButton.prototype.createTable = function(row, col, phBr) {\r\n    var $table, $tbody, $td, $thead, $tr, c, k, l, r, ref, ref1;\r\n    $table = $('<table/>');\r\n    $thead = $('<thead/>').appendTo($table);\r\n    $tbody = $('<tbody/>').appendTo($table);\r\n    for (r = k = 0, ref = row; 0 <= ref ? k < ref : k > ref; r = 0 <= ref ? ++k : --k) {\r\n      $tr = $('<tr/>');\r\n      $tr.appendTo(r === 0 ? $thead : $tbody);\r\n      for (c = l = 0, ref1 = col; 0 <= ref1 ? l < ref1 : l > ref1; c = 0 <= ref1 ? ++l : --l) {\r\n        $td = $(r === 0 ? '<th/>' : '<td/>').appendTo($tr);\r\n        if (phBr) {\r\n          $td.append(this.editor.util.phBr);\r\n        }\r\n      }\r\n    }\r\n    return $table;\r\n  };\r\n\r\n  TableButton.prototype.refreshTableWidth = function($table) {\r\n    return setTimeout((function(_this) {\r\n      return function() {\r\n        var cols, tableWidth;\r\n        tableWidth = $table.width();\r\n        cols = $table.find('col');\r\n        return $table.find('thead tr th').each(function(i, td) {\r\n          var $col;\r\n          $col = cols.eq(i);\r\n          return $col.attr('width', ($(td).outerWidth() / tableWidth * 100) + '%');\r\n        });\r\n      };\r\n    })(this), 0);\r\n  };\r\n\r\n  TableButton.prototype.setActive = function(active) {\r\n    Button.prototype.setActive.call(this, active);\r\n    if (active) {\r\n      this.createMenu.hide();\r\n      return this.editMenu.show();\r\n    } else {\r\n      this.createMenu.show();\r\n      return this.editMenu.hide();\r\n    }\r\n  };\r\n\r\n  TableButton.prototype._changeCellTag = function($tr, tagName) {\r\n    return $tr.find('td, th').each(function(i, cell) {\r\n      var $cell;\r\n      $cell = $(cell);\r\n      return $cell.replaceWith(\"<\" + tagName + \">\" + ($cell.html()) + \"</\" + tagName + \">\");\r\n    });\r\n  };\r\n\r\n  TableButton.prototype.deleteRow = function($td) {\r\n    var $newTr, $tr, index;\r\n    $tr = $td.parent('tr');\r\n    if ($tr.closest('table').find('tr').length < 1) {\r\n      return this.deleteTable($td);\r\n    } else {\r\n      $newTr = this._nextRow($tr);\r\n      if (!($newTr.length > 0)) {\r\n        $newTr = this._prevRow($tr);\r\n      }\r\n      index = $tr.find('td, th').index($td);\r\n      if ($tr.parent().is('thead')) {\r\n        $newTr.appendTo($tr.parent());\r\n        this._changeCellTag($newTr, 'th');\r\n      }\r\n      $tr.remove();\r\n      return this.editor.selection.setRangeAtEndOf($newTr.find('td, th').eq(index));\r\n    }\r\n  };\r\n\r\n  TableButton.prototype.insertRow = function($td, direction) {\r\n    var $newTr, $table, $tr, cellTag, colNum, i, index, k, ref;\r\n    if (direction == null) {\r\n      direction = 'after';\r\n    }\r\n    $tr = $td.parent('tr');\r\n    $table = $tr.closest('table');\r\n    colNum = 0;\r\n    $table.find('tr').each(function(i, tr) {\r\n      return colNum = Math.max(colNum, $(tr).find('td').length);\r\n    });\r\n    index = $tr.find('td, th').index($td);\r\n    $newTr = $('<tr/>');\r\n    cellTag = 'td';\r\n    if (direction === 'after' && $tr.parent().is('thead')) {\r\n      $tr.parent().next('tbody').prepend($newTr);\r\n    } else if (direction === 'before' && $tr.parent().is('thead')) {\r\n      $tr.before($newTr);\r\n      $tr.parent().next('tbody').prepend($tr);\r\n      this._changeCellTag($tr, 'td');\r\n      cellTag = 'th';\r\n    } else {\r\n      $tr[direction]($newTr);\r\n    }\r\n    for (i = k = 1, ref = colNum; 1 <= ref ? k <= ref : k >= ref; i = 1 <= ref ? ++k : --k) {\r\n      $(\"<\" + cellTag + \"/>\").append(this.editor.util.phBr).appendTo($newTr);\r\n    }\r\n    return this.editor.selection.setRangeAtStartOf($newTr.find('td, th').eq(index));\r\n  };\r\n\r\n  TableButton.prototype.deleteCol = function($td) {\r\n    var $newTd, $table, $tr, index, noOtherCol, noOtherRow;\r\n    $tr = $td.parent('tr');\r\n    noOtherRow = $tr.closest('table').find('tr').length < 2;\r\n    noOtherCol = $td.siblings('td, th').length < 1;\r\n    if (noOtherRow && noOtherCol) {\r\n      return this.deleteTable($td);\r\n    } else {\r\n      index = $tr.find('td, th').index($td);\r\n      $newTd = $td.next('td, th');\r\n      if (!($newTd.length > 0)) {\r\n        $newTd = $tr.prev('td, th');\r\n      }\r\n      $table = $tr.closest('table');\r\n      $table.find('col').eq(index).remove();\r\n      $table.find('tr').each(function(i, tr) {\r\n        return $(tr).find('td, th').eq(index).remove();\r\n      });\r\n      this.refreshTableWidth($table);\r\n      return this.editor.selection.setRangeAtEndOf($newTd);\r\n    }\r\n  };\r\n\r\n  TableButton.prototype.insertCol = function($td, direction) {\r\n    var $col, $newCol, $newTd, $table, $tr, index, tableWidth, width;\r\n    if (direction == null) {\r\n      direction = 'after';\r\n    }\r\n    $tr = $td.parent('tr');\r\n    index = $tr.find('td, th').index($td);\r\n    $table = $td.closest('table');\r\n    $col = $table.find('col').eq(index);\r\n    $table.find('tr').each((function(_this) {\r\n      return function(i, tr) {\r\n        var $newTd, cellTag;\r\n        cellTag = $(tr).parent().is('thead') ? 'th' : 'td';\r\n        $newTd = $(\"<\" + cellTag + \"/>\").append(_this.editor.util.phBr);\r\n        return $(tr).find('td, th').eq(index)[direction]($newTd);\r\n      };\r\n    })(this));\r\n    $newCol = $('<col/>');\r\n    $col[direction]($newCol);\r\n    tableWidth = $table.width();\r\n    width = Math.max(parseFloat($col.attr('width')) / 2, 50 / tableWidth * 100);\r\n    $col.attr('width', width + '%');\r\n    $newCol.attr('width', width + '%');\r\n    this.refreshTableWidth($table);\r\n    $newTd = direction === 'after' ? $td.next('td, th') : $td.prev('td, th');\r\n    return this.editor.selection.setRangeAtStartOf($newTd);\r\n  };\r\n\r\n  TableButton.prototype.deleteTable = function($td) {\r\n    var $block, $table;\r\n    $table = $td.closest('.simditor-table');\r\n    $block = $table.next('p');\r\n    $table.remove();\r\n    if ($block.length > 0) {\r\n      return this.editor.selection.setRangeAtStartOf($block);\r\n    }\r\n  };\r\n\r\n  TableButton.prototype.command = function(param) {\r\n    var $td;\r\n    $td = this.editor.selection.containerNode().closest('td, th');\r\n    if (!($td.length > 0)) {\r\n      return;\r\n    }\r\n    if (param === 'deleteRow') {\r\n      this.deleteRow($td);\r\n    } else if (param === 'insertRowAbove') {\r\n      this.insertRow($td, 'before');\r\n    } else if (param === 'insertRowBelow') {\r\n      this.insertRow($td);\r\n    } else if (param === 'deleteCol') {\r\n      this.deleteCol($td);\r\n    } else if (param === 'insertColLeft') {\r\n      this.insertCol($td, 'before');\r\n    } else if (param === 'insertColRight') {\r\n      this.insertCol($td);\r\n    } else if (param === 'deleteTable') {\r\n      this.deleteTable($td);\r\n    } else {\r\n      return;\r\n    }\r\n    return this.editor.trigger('valuechanged');\r\n  };\r\n\r\n  Simditor.Toolbar.addButton(TableButton);\r\n\r\n  return TableButton;\r\n\r\n\r\n});"]}