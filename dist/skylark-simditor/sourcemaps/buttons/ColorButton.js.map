{"version":3,"sources":["buttons/ColorButton.js"],"names":["define","$","Toolbar","Simditor","Button","ColorButton","inherit","prototype","name","icon","disableTag","menu","render","args","arguments","length","Array","slice","call","apply","this","renderMenu","appendTo","menuWrapper","on","e","_this","$link","$p","hex","range","rgb","textNode","wrapper","removeClass","currentTarget","hasClass","editor","body","find","window","getComputedStyle","getPropertyValue","_convertRgbToHex","selection","collapsed","document","createTextNode","_t","insertNode","selectNodeContents","execCommand","util","support","oninput","trigger","match","exec","r","g","b","componentToHex","c","toString","rgbToHex","addButton"],"mappings":";;;;;;;AAAAA,QACE,0BACA,aACA,cACA,aACA,SAASC,EAAEC,EAAQC,EAASC,GAG3B,IAAIC,EAAcD,EAAOE,YAqF1B,OAhFAD,EAAYE,UAAUC,KAAO,QAE7BH,EAAYE,UAAUE,KAAO,OAE7BJ,EAAYE,UAAUG,WAAa,MAEnCL,EAAYE,UAAUI,MAAO,EAE7BN,EAAYE,UAAUK,OAAS,WAC7B,IAAIC,EAEJ,OADAA,EAAO,GAAKC,UAAUC,OAASC,MAAMT,UAAUU,MAAMC,KAAKJ,UAAW,MAC9DV,EAAOG,UAAUK,OAAOO,MAAMC,KAAMP,IAG7CR,EAAYE,UAAUc,WAAa,WAKjC,OAJApB,EAAE,wmBAAwmBqB,SAASF,KAAKG,aACxnBH,KAAKG,YAAYC,GAAG,YAAa,cAAe,SAASC,GACvD,OAAO,IAEFL,KAAKG,YAAYC,GAAG,QAAS,eAAyBE,EAiC1DN,KAhCM,SAASK,GACd,IAAIE,EAAOC,EAAIC,EAAKC,EAAOC,EAAKC,EAGhC,GAFAN,EAAMO,QAAQC,YAAY,YAC1BP,EAAQ1B,EAAEwB,EAAEU,gBACFC,SAAS,sBAAuB,CAExC,MADAR,EAAKF,EAAMW,OAAOC,KAAKC,KAAK,UACnBxB,OAAS,GAChB,OAEFgB,EAAMS,OAAOC,iBAAiBb,EAAG,GAAI,MAAMc,iBAAiB,SAC5Db,EAAMH,EAAMiB,iBAAiBZ,QAE7BA,EAAMS,OAAOC,iBAAiBd,EAAM,GAAI,MAAMe,iBAAiB,oBAC/Db,EAAMH,EAAMiB,iBAAiBZ,GAE/B,GAAKF,EAaL,OAVAC,EAAQJ,EAAMW,OAAOO,UAAUd,SAC1BH,EAAMS,SAAS,uBAAyBN,EAAMe,YACjDb,EAAWc,SAASC,eAAerB,EAAMsB,GAAG,gBAC5ClB,EAAMmB,WAAWjB,GACjBF,EAAMoB,mBAAmBlB,IAE3BN,EAAMW,OAAOO,UAAUd,MAAMA,GAC7BgB,SAASK,YAAY,gBAAgB,GAAO,GAC5CL,SAASK,YAAY,aAAa,EAAOtB,GACzCiB,SAASK,YAAY,gBAAgB,GAAO,GACvCzB,EAAMW,OAAOe,KAAKC,QAAQC,aAA/B,EACS5B,EAAMW,OAAOkB,QAAQ,mBA9BiB,IAAU7B,GAoC/DrB,EAAYE,UAAUoC,iBAAmB,SAASZ,GAChD,IAAIyB,EAGJ,OADAA,EADK,kCACMC,KAAK1B,IAIL,SAAS2B,EAAGC,EAAGC,GACxB,IAAIC,EAUJ,MAAO,KATPA,EAAiB,SAASC,GACxB,IAAIjC,EAEJ,OAAmB,KADnBA,EAAMiC,EAAEC,SAAS,KACThD,OACC,IAAMc,EAENA,IAGiB6B,GAAKG,EAAeF,GAAKE,EAAeD,GAE/DI,CAAoB,EAAXR,EAAM,GAAmB,EAAXA,EAAM,GAAmB,EAAXA,EAAM,IAfzC,IAkBXrD,EAASD,QAAQ+D,UAAU5D,GAEpBA","file":"../../buttons/ColorButton.js","sourcesContent":["define([\r\n  \"skylark-utils-dom/query\",\r\n  \"../Toolbar\",\r\n  \"../Simditor\",\r\n  \"../Button\"\r\n],function($,Toolbar,Simditor,Button){ \r\n  \r\n\r\n   var ColorButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n  ColorButton.prototype.name = 'color';\r\n\r\n  ColorButton.prototype.icon = 'tint';\r\n\r\n  ColorButton.prototype.disableTag = 'pre';\r\n\r\n  ColorButton.prototype.menu = true;\r\n\r\n  ColorButton.prototype.render = function() {\r\n    var args;\r\n    args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n    return Button.prototype.render.apply(this, args);\r\n  };\r\n\r\n  ColorButton.prototype.renderMenu = function() {\r\n    $('<ul class=\"color-list\">\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-1\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-2\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-3\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-4\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-5\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-6\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-7\"></a></li>\\n  <li><a href=\"javascript:;\" class=\"font-color font-color-default\"></a></li>\\n</ul>').appendTo(this.menuWrapper);\r\n    this.menuWrapper.on('mousedown', '.color-list', function(e) {\r\n      return false;\r\n    });\r\n    return this.menuWrapper.on('click', '.font-color', (function(_this) {\r\n      return function(e) {\r\n        var $link, $p, hex, range, rgb, textNode;\r\n        _this.wrapper.removeClass('menu-on');\r\n        $link = $(e.currentTarget);\r\n        if ($link.hasClass('font-color-default')) {\r\n          $p = _this.editor.body.find('p, li');\r\n          if (!($p.length > 0)) {\r\n            return;\r\n          }\r\n          rgb = window.getComputedStyle($p[0], null).getPropertyValue('color');\r\n          hex = _this._convertRgbToHex(rgb);\r\n        } else {\r\n          rgb = window.getComputedStyle($link[0], null).getPropertyValue('background-color');\r\n          hex = _this._convertRgbToHex(rgb);\r\n        }\r\n        if (!hex) {\r\n          return;\r\n        }\r\n        range = _this.editor.selection.range();\r\n        if (!$link.hasClass('font-color-default') && range.collapsed) {\r\n          textNode = document.createTextNode(_this._t('coloredText'));\r\n          range.insertNode(textNode);\r\n          range.selectNodeContents(textNode);\r\n        }\r\n        _this.editor.selection.range(range);\r\n        document.execCommand('styleWithCSS', false, true);\r\n        document.execCommand('foreColor', false, hex);\r\n        document.execCommand('styleWithCSS', false, false);\r\n        if (!_this.editor.util.support.oninput) {\r\n          return _this.editor.trigger('valuechanged');\r\n        }\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  ColorButton.prototype._convertRgbToHex = function(rgb) {\r\n    var match, re, rgbToHex;\r\n    re = /rgb\\((\\d+),\\s?(\\d+),\\s?(\\d+)\\)/g;\r\n    match = re.exec(rgb);\r\n    if (!match) {\r\n      return '';\r\n    }\r\n    rgbToHex = function(r, g, b) {\r\n      var componentToHex;\r\n      componentToHex = function(c) {\r\n        var hex;\r\n        hex = c.toString(16);\r\n        if (hex.length === 1) {\r\n          return '0' + hex;\r\n        } else {\r\n          return hex;\r\n        }\r\n      };\r\n      return \"#\" + componentToHex(r) + componentToHex(g) + componentToHex(b);\r\n    };\r\n    return rgbToHex(match[1] * 1, match[2] * 1, match[3] * 1);\r\n  };\r\n\r\n  Simditor.Toolbar.addButton(ColorButton);\r\n\r\n  return ColorButton;\r\n\t\r\n});"]}