{"version":3,"sources":["buttons/BlockquoteButton.js"],"names":["define","$","Toolbar","Simditor","Button","BlockquoteButton","inherit","prototype","name","icon","htmlTag","disableTag","command","$rootNodes","clearCache","nodeCache","_this","this","editor","selection","rootNodes","filter","i","node","parent","is","save","length","insertBefore","append","each","$node","body","children","unwrap","util","isDecoratedNode","push","restore","trigger","addButton"],"mappings":";;;;;;;AAAAA,QACE,0BACA,aACA,cACA,aACA,SAASC,EAAEC,EAAQC,EAASC,GAC3B,IAAIC,EAAmBD,EAAOE,YAsD/B,OAhDAD,EAAiBE,UAAUC,KAAO,aAElCH,EAAiBE,UAAUE,KAAO,aAElCJ,EAAiBE,UAAUG,QAAU,aAErCL,EAAiBE,UAAUI,WAAa,aAExCN,EAAiBE,UAAUK,QAAU,WACnC,IAAIC,EAAYC,EAAYC,EAOLC,EA2BvB,OAhCAH,GADAA,EAAaI,KAAKC,OAAOC,UAAUC,aACXC,OAAO,SAASC,EAAGC,GACzC,OAAQtB,EAAEsB,GAAMC,SAASC,GAAG,gBAE9BR,KAAKC,OAAOC,UAAUO,OACtBX,KACuBC,EAOpBC,KAPHH,EACS,WACL,GAAIC,EAAUY,OAAS,EAErB,OADA1B,EAAE,IAAMe,EAAMN,QAAU,MAAMkB,aAAab,EAAU,IAAIc,OAAOd,GACzDA,EAAUY,OAAS,GAIhCd,EAAWiB,KAAK,SAAUd,GACxB,OAAO,SAASM,EAAGC,GACjB,IAAIQ,EAEJ,IADAA,EAAQ9B,EAAEsB,IACCC,SAASC,GAAGT,EAAME,OAAOc,MAGpC,OAAID,EAAMN,GAAGT,EAAMN,UACjBI,IACOiB,EAAME,WAAWC,UACfH,EAAMN,GAAGT,EAAML,aAAeK,EAAME,OAAOiB,KAAKC,gBAAgBL,GAClEjB,IAEAC,EAAUsB,KAAKd,IAbZ,CAgBbN,OACHH,IACAG,KAAKC,OAAOC,UAAUmB,UACfrB,KAAKC,OAAOqB,QAAQ,iBAG7BpC,EAASD,QAAQsC,UAAUnC,GAEpBA","file":"../../buttons/BlockquoteButton.js","sourcesContent":["define([\r\n  \"skylark-utils-dom/query\",\r\n  \"../Toolbar\",\r\n  \"../Simditor\",\r\n  \"../Button\"\r\n],function($,Toolbar,Simditor,Button){ \r\n   var BlockquoteButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n\r\n  BlockquoteButton.prototype.name = 'blockquote';\r\n\r\n  BlockquoteButton.prototype.icon = 'quote-left';\r\n\r\n  BlockquoteButton.prototype.htmlTag = 'blockquote';\r\n\r\n  BlockquoteButton.prototype.disableTag = 'pre, table';\r\n\r\n  BlockquoteButton.prototype.command = function() {\r\n    var $rootNodes, clearCache, nodeCache;\r\n    $rootNodes = this.editor.selection.rootNodes();\r\n    $rootNodes = $rootNodes.filter(function(i, node) {\r\n      return !$(node).parent().is('blockquote');\r\n    });\r\n    this.editor.selection.save();\r\n    nodeCache = [];\r\n    clearCache = (function(_this) {\r\n      return function() {\r\n        if (nodeCache.length > 0) {\r\n          $(\"<\" + _this.htmlTag + \"/>\").insertBefore(nodeCache[0]).append(nodeCache);\r\n          return nodeCache.length = 0;\r\n        }\r\n      };\r\n    })(this);\r\n    $rootNodes.each((function(_this) {\r\n      return function(i, node) {\r\n        var $node;\r\n        $node = $(node);\r\n        if (!$node.parent().is(_this.editor.body)) {\r\n          return;\r\n        }\r\n        if ($node.is(_this.htmlTag)) {\r\n          clearCache();\r\n          return $node.children().unwrap();\r\n        } else if ($node.is(_this.disableTag) || _this.editor.util.isDecoratedNode($node)) {\r\n          return clearCache();\r\n        } else {\r\n          return nodeCache.push(node);\r\n        }\r\n      };\r\n    })(this));\r\n    clearCache();\r\n    this.editor.selection.restore();\r\n    return this.editor.trigger('valuechanged');\r\n  };\r\n\r\n  Simditor.Toolbar.addButton(BlockquoteButton); \r\n\r\n  return BlockquoteButton;\r\n\r\n});"]}