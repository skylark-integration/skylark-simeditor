{"version":3,"sources":["buttons/LinkButton.js"],"names":["define","$","Toolbar","Simditor","Button","LinkPopover","LinkButton","inherit","prototype","name","icon","htmlTag","disableTag","render","args","arguments","length","Array","slice","call","apply","this","popover","button","_status","active","editor","editable","selection","rangeAtEndOf","node","show","hide","command","$contents","$link","$newBlock","linkText","range","txtNode","_this","document","createTextNode","text","replaceWith","selectNode","extractContents","formatter","clearHtml","contents","href","target","_t","blockNodes","insertNode","append","selectNodeContents","one","urlEl","focus","select","textEl","trigger","addButton"],"mappings":";;;;;;;AAAAA,QACE,0BACA,aACA,cACA,YACA,iBACA,SAASC,EAAEC,EAAQC,EAASC,EAAOC,GAGnC,IAAIC,EAAaF,EAAOG,YAuExB,OAlEAD,EAAWE,UAAUC,KAAO,OAE5BH,EAAWE,UAAUE,KAAO,OAE5BJ,EAAWE,UAAUG,QAAU,IAE/BL,EAAWE,UAAUI,WAAa,MAElCN,EAAWE,UAAUK,OAAS,WAC5B,IAAIC,EAGJ,OAFAA,EAAO,GAAKC,UAAUC,OAASC,MAAMT,UAAUU,MAAMC,KAAKJ,UAAW,MACrEX,EAAOI,UAAUK,OAAOO,MAAMC,KAAMP,GAC7BO,KAAKC,QAAU,IAAIjB,GACxBkB,OAAQF,QAIZf,EAAWE,UAAUgB,QAAU,WAE7B,OADDpB,EAAOI,UAAUgB,QAAQL,KAAKE,MACzBA,KAAKI,SAAWJ,KAAKK,OAAOC,SAASC,UAAUC,aAAaR,KAAKS,MAC5DT,KAAKC,QAAQS,KAAKV,KAAKS,MAEvBT,KAAKC,QAAQU,QAIxB1B,EAAWE,UAAUyB,QAAU,WAC7B,IAAIC,EAAWC,EAAOC,EAAWC,EAAUC,EAAOC,EAqBNC,EAa5C,OAjCAF,EAAQjB,KAAKK,OAAOC,SAASC,UAAUU,QACnCjB,KAAKI,QACPc,EAAUE,SAASC,eAAerB,KAAKS,KAAKa,QAC5CtB,KAAKS,KAAKc,YAAYL,GACtBD,EAAMO,WAAWN,KAEjBL,EAAYjC,EAAEqC,EAAMQ,mBACpBT,EAAWhB,KAAKK,OAAOC,SAASoB,UAAUC,UAAUd,EAAUe,YAAY,GAC1Ed,EAAQlC,EAAE,QACRiD,KAAM,GACNC,OAAQ,SACRR,KAAMN,GAAYhB,KAAK+B,GAAG,cAExB/B,KAAKK,OAAOC,SAASC,UAAUyB,aAAarC,OAAS,EACvDsB,EAAMgB,WAAWnB,EAAM,KAEvBC,EAAYnC,EAAE,QAAQsD,OAAOpB,GAC7BG,EAAMgB,WAAWlB,EAAU,KAE7BE,EAAMkB,mBAAmBrB,EAAM,IAC/Bd,KAAKC,QAAQmC,IAAI,eAAyBjB,EAUvCnB,KATM,WACL,OAAIgB,GACFG,EAAMlB,QAAQoC,MAAMC,QACbnB,EAAMlB,QAAQoC,MAAM,GAAGE,WAE9BpB,EAAMlB,QAAQuC,OAAOF,QACdnB,EAAMlB,QAAQuC,OAAO,GAAGD,cAKvCvC,KAAKK,OAAOC,SAASC,UAAUU,MAAMA,GAC9BjB,KAAKK,OAAOoC,QAAQ,iBAG7B3D,EAASD,QAAQ6D,UAAUzD,GAEpBA","file":"../../buttons/LinkButton.js","sourcesContent":["define([\r\n  \"skylark-utils-dom/query\",\r\n  \"../Toolbar\",\r\n  \"../Simditor\",\r\n  \"../Button\",\r\n  \"./LinkPopover\"\r\n],function($,Toolbar,Simditor,Button,LinkPopover){ \r\n  \r\n\r\n  var LinkButton = Button.inherit({\r\n\r\n   });\r\n\r\n\r\n  LinkButton.prototype.name = 'link';\r\n\r\n  LinkButton.prototype.icon = 'link';\r\n\r\n  LinkButton.prototype.htmlTag = 'a';\r\n\r\n  LinkButton.prototype.disableTag = 'pre';\r\n\r\n  LinkButton.prototype.render = function() {\r\n    var args;\r\n    args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n    Button.prototype.render.apply(this, args);\r\n    return this.popover = new LinkPopover({\r\n      button: this\r\n    });\r\n  };\r\n\r\n  LinkButton.prototype._status = function() {\r\n   Button.prototype._status.call(this);\r\n    if (this.active && !this.editor.editable.selection.rangeAtEndOf(this.node)) {\r\n      return this.popover.show(this.node);\r\n    } else {\r\n      return this.popover.hide();\r\n    }\r\n  };\r\n\r\n  LinkButton.prototype.command = function() {\r\n    var $contents, $link, $newBlock, linkText, range, txtNode;\r\n    range = this.editor.editable.selection.range();\r\n    if (this.active) {\r\n      txtNode = document.createTextNode(this.node.text());\r\n      this.node.replaceWith(txtNode);\r\n      range.selectNode(txtNode);\r\n    } else {\r\n      $contents = $(range.extractContents());\r\n      linkText = this.editor.editable.formatter.clearHtml($contents.contents(), false);\r\n      $link = $('<a/>', {\r\n        href: '',\r\n        target: '_blank',\r\n        text: linkText || this._t('linkText')\r\n      });\r\n      if (this.editor.editable.selection.blockNodes().length > 0) {\r\n        range.insertNode($link[0]);\r\n      } else {\r\n        $newBlock = $('<p/>').append($link);\r\n        range.insertNode($newBlock[0]);\r\n      }\r\n      range.selectNodeContents($link[0]);\r\n      this.popover.one('popovershow', (function(_this) {\r\n        return function() {\r\n          if (linkText) {\r\n            _this.popover.urlEl.focus();\r\n            return _this.popover.urlEl[0].select();\r\n          } else {\r\n            _this.popover.textEl.focus();\r\n            return _this.popover.textEl[0].select();\r\n          }\r\n        };\r\n      })(this));\r\n    }\r\n    this.editor.editable.selection.range(range);\r\n    return this.editor.trigger('valuechanged');\r\n  };\r\n\r\n  Simditor.Toolbar.addButton(LinkButton);\r\n\r\n  return LinkButton;\r\n\r\n});"]}