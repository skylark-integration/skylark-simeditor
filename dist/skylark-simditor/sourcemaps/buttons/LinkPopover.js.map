{"version":3,"sources":["buttons/LinkPopover.js"],"names":["define","$","extend","SimpleModule","Toolbar","Simditor","Popover","LinkPopover","inherit","prototype","render","tpl","_this","this","_t","el","addClass","append","textEl","find","urlEl","unlinkEl","selectTarget","on","e","which","target","text","val","editor","inputManager","throttledValueChanged","test","attr","range","shiftKey","hasClass","preventDefault","document","createRange","selection","setRangeAfter","hide","txtNode","createTextNode","replaceWith","show","args","arguments","length","Array","slice","call","apply"],"mappings":";;;;;;;AAAAA,QACE,iBACA,aACA,YACA,aACA,cACA,cACA,SAASC,EAAEC,EAAOC,EAAaC,EAAQC,EAASC,GAChD,IAAIC,EAAcD,EAAQE,YA0E1B,OAtEAD,EAAYE,UAAUC,OAAS,WAC7B,IAAIC,EAO8BC,EA8ClC,OApDAD,EAAM,2EAAkFE,KAAKC,GAAG,YAAe,8GAA0HD,KAAKC,GAAG,cAAiB,2JAAqKD,KAAKC,GAAG,WAAc,6GAAsHD,KAAKC,GAAG,cAAiB,4EAAmFD,KAAKC,GAAG,uBAA0B,mDAAwDD,KAAKC,GAAG,2BAA8B,qDAC/xBD,KAAKE,GAAGC,SAAS,gBAAgBC,OAAON,GACxCE,KAAKK,OAASL,KAAKE,GAAGI,KAAK,cAC3BN,KAAKO,MAAQP,KAAKE,GAAGI,KAAK,aAC1BN,KAAKQ,SAAWR,KAAKE,GAAGI,KAAK,eAC7BN,KAAKS,aAAeT,KAAKE,GAAGI,KAAK,gBACjCN,KAAKK,OAAOK,GAAG,SAAmBX,EAQ/BC,KAPM,SAASW,GACd,GAAgB,KAAZA,EAAEC,MAIN,OADAb,EAAMc,OAAOC,KAAKf,EAAMM,OAAOU,OACxBhB,EAAMiB,OAAOC,aAAaC,2BAGrClB,KAAKO,MAAMG,GAAG,QAAS,SAAUX,GAC/B,OAAO,SAASY,GACd,IAAII,EACJ,GAAgB,KAAZJ,EAAEC,MAQN,OALAG,EAAMhB,EAAMQ,MAAMQ,OACZ,0DAA0DI,KAAKJ,IAASA,IAC5EA,EAAM,UAAYA,GAEpBhB,EAAMc,OAAOO,KAAK,OAAQL,GACnBhB,EAAMiB,OAAOC,aAAaC,yBAXd,CAapBlB,OACHZ,GAAGY,KAAKO,MAAM,GAAIP,KAAKK,OAAO,KAAKK,GAAG,UAAW,SAAUX,GACzD,OAAO,SAASY,GACd,IAAIU,EACJ,GAAgB,KAAZV,EAAEC,OAA4B,KAAZD,EAAEC,QAAkBD,EAAEW,UAAwB,IAAZX,EAAEC,OAAexB,EAAEuB,EAAEE,QAAQU,SAAS,YAK5F,OAJAZ,EAAEa,iBACFH,EAAQI,SAASC,cACjB3B,EAAMiB,OAAOW,UAAUC,cAAc7B,EAAMc,OAAQQ,GACnDtB,EAAM8B,OACC9B,EAAMiB,OAAOC,aAAaC,yBARU,CAW9ClB,OACHA,KAAKQ,SAASE,GAAG,QAAS,SAAUX,GAClC,OAAO,SAASY,GACd,IAAIU,EAAOS,EAMX,OALAA,EAAUL,SAASM,eAAehC,EAAMc,OAAOC,QAC/Cf,EAAMc,OAAOmB,YAAYF,GACzB/B,EAAM8B,OACNR,EAAQI,SAASC,cACjB3B,EAAMiB,OAAOW,UAAUC,cAAcE,EAAST,GACvCtB,EAAMiB,OAAOC,aAAaC,yBARX,CAUvBlB,OACIA,KAAKS,aAAaC,GAAG,SAAU,SAAUX,GAC9C,OAAO,SAASY,GAEd,OADAZ,EAAMc,OAAOO,KAAK,SAAUrB,EAAMU,aAAaM,OACxChB,EAAMiB,OAAOC,aAAaC,yBAHC,CAKnClB,QAGLN,EAAYE,UAAUqC,KAAO,WAC3B,IAAIC,EAIJ,OAHAA,EAAO,GAAKC,UAAUC,OAASC,MAAMzC,UAAU0C,MAAMC,KAAKJ,UAAW,MACrE1C,EAAQG,UAAUqC,KAAKO,MAAMxC,KAAMkC,GACnClC,KAAKK,OAAOU,IAAIf,KAAKa,OAAOC,QACrBd,KAAKO,MAAMQ,IAAIf,KAAKa,OAAOO,KAAK,UAGlC1B","file":"../../buttons/LinkPopover.js","sourcesContent":["define([\r\n  \"skylark-jquery\",\r\n  \"../_extend\",\r\n  \"../Module\",\r\n  \"../Toolbar\",\r\n  \"../Simditor\",\r\n  \"../Popover\"\r\n],function($,extend,SimpleModule,Toolbar,Simditor,Popover){ \r\n  var LinkPopover = Popover.inherit({\r\n\r\n  });\r\n\r\n  LinkPopover.prototype.render = function() {\r\n    var tpl;\r\n    tpl = \"<div class=\\\"link-settings\\\">\\n  <div class=\\\"settings-field\\\">\\n    <label>\" + (this._t('linkText')) + \"</label>\\n    <input class=\\\"link-text\\\" type=\\\"text\\\"/>\\n    <a class=\\\"btn-unlink\\\" href=\\\"javascript:;\\\" title=\\\"\" + (this._t('removeLink')) + \"\\\"\\n      tabindex=\\\"-1\\\">\\n      <span class=\\\"simditor-icon simditor-icon-unlink\\\"></span>\\n    </a>\\n  </div>\\n  <div class=\\\"settings-field\\\">\\n    <label>\" + (this._t('linkUrl')) + \"</label>\\n    <input class=\\\"link-url\\\" type=\\\"text\\\"/>\\n  </div>\\n  <div class=\\\"settings-field\\\">\\n    <label>\" + (this._t('linkTarget')) + \"</label>\\n    <select class=\\\"link-target\\\">\\n      <option value=\\\"_blank\\\">\" + (this._t('openLinkInNewWindow')) + \" (_blank)</option>\\n      <option value=\\\"_self\\\">\" + (this._t('openLinkInCurrentWindow')) + \" (_self)</option>\\n    </select>\\n  </div>\\n</div>\";\r\n    this.el.addClass('link-popover').append(tpl);\r\n    this.textEl = this.el.find('.link-text');\r\n    this.urlEl = this.el.find('.link-url');\r\n    this.unlinkEl = this.el.find('.btn-unlink');\r\n    this.selectTarget = this.el.find('.link-target');\r\n    this.textEl.on('keyup', (function(_this) {\r\n      return function(e) {\r\n        if (e.which === 13) {\r\n          return;\r\n        }\r\n        _this.target.text(_this.textEl.val());\r\n        return _this.editor.inputManager.throttledValueChanged();\r\n      };\r\n    })(this));\r\n    this.urlEl.on('keyup', (function(_this) {\r\n      return function(e) {\r\n        var val;\r\n        if (e.which === 13) {\r\n          return;\r\n        }\r\n        val = _this.urlEl.val();\r\n        if (!(/^(http|https|ftp|ftps|file)?:\\/\\/|^(mailto|tel)?:|^\\//ig.test(val) || !val)) {\r\n          val = 'http://' + val;\r\n        }\r\n        _this.target.attr('href', val);\r\n        return _this.editor.inputManager.throttledValueChanged();\r\n      };\r\n    })(this));\r\n    $([this.urlEl[0], this.textEl[0]]).on('keydown', (function(_this) {\r\n      return function(e) {\r\n        var range;\r\n        if (e.which === 13 || e.which === 27 || (!e.shiftKey && e.which === 9 && $(e.target).hasClass('link-url'))) {\r\n          e.preventDefault();\r\n          range = document.createRange();\r\n          _this.editor.selection.setRangeAfter(_this.target, range);\r\n          _this.hide();\r\n          return _this.editor.inputManager.throttledValueChanged();\r\n        }\r\n      };\r\n    })(this));\r\n    this.unlinkEl.on('click', (function(_this) {\r\n      return function(e) {\r\n        var range, txtNode;\r\n        txtNode = document.createTextNode(_this.target.text());\r\n        _this.target.replaceWith(txtNode);\r\n        _this.hide();\r\n        range = document.createRange();\r\n        _this.editor.selection.setRangeAfter(txtNode, range);\r\n        return _this.editor.inputManager.throttledValueChanged();\r\n      };\r\n    })(this));\r\n    return this.selectTarget.on('change', (function(_this) {\r\n      return function(e) {\r\n        _this.target.attr('target', _this.selectTarget.val());\r\n        return _this.editor.inputManager.throttledValueChanged();\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  LinkPopover.prototype.show = function() {\r\n    var args;\r\n    args = 1 <= arguments.length ? Array.prototype.slice.call(arguments, 0) : [];\r\n    Popover.prototype.show.apply(this, args);\r\n    this.textEl.val(this.target.text());\r\n    return this.urlEl.val(this.target.attr('href'));\r\n  };\r\n\r\n  return LinkPopover;\r\n\r\n});"]}