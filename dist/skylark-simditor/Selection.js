/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/noder","skylark-jquery","./_extend","./Module"],function(e,t,n,r,s){var i=s.inherit({_range:null,_startNodes:null,_endNodes:null,_containerNode:null,_nodes:null,_blockNodes:null,_rootNodes:null,_init:function(){var e=this;return this.editor=this._module,this._selection=document.getSelection(),this.editor.on("selectionchanged",function(t){return e.reset(),e._range=e._selection.getRangeAt(0)}),this.editor.on("blur",function(t){return e.reset()}),this.editor.on("focus",function(t){return e.reset(),e._range=e._selection.getRangeAt(0)})},reset:function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},clear:function(){try{this._selection.removeAllRanges()}catch(e){e}return this.reset()},range:function(t){var n;return t?(this.clear(),this._selection.addRange(t),this._range=t,n=e.hoster.browser.mozilla||e.hoster.browser.msie,!this.editor.inputManager.focused&&n&&this.editor.body.focus()):!this._range&&this.editor.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},startNodes:function(){var e;return this._range&&(this._startNodes||(this._startNodes=(e=this,function(){var t;return(t=n(e._range.startContainer).parentsUntil(e.editor.body).get()).unshift(e._range.startContainer),n(t)})())),this._startNodes},endNodes:function(){var e;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():((e=n(this._range.endContainer).parentsUntil(this.editor.body).get()).unshift(this._range.endContainer),n(e)))),this._endNodes},containerNode:function(){return this._range&&(this._containerNode||(this._containerNode=n(this._range.commonAncestorContainer))),this._containerNode},nodes:function(){var e;return this._range&&(this._nodes||(this._nodes=(e=this,function(){var t;return t=[],e.startNodes().first().is(e.endNodes().first())?t=e.startNodes().get():(e.startNodes().each(function(r,s){var i,o,a,d,l,u,c;return o=n(s),e.endNodes().index(o)>-1?t.push(s):o.parent().is(e.editor.body)||(u=e.endNodes().index(o.parent()))>-1?(i=u&&u>-1?e.endNodes().eq(u-1):e.endNodes().last(),c=(a=o.parent().contents()).index(o),d=a.index(i),n.merge(t,a.slice(c,d).get())):(l=(a=o.parent().contents()).index(o),n.merge(t,a.slice(l).get()))}),e.endNodes().each(function(r,s){var i,o,a;return(i=n(s)).parent().is(e.editor.body)||e.startNodes().index(i.parent())>-1?(t.push(s),!1):(a=(o=i.parent().contents()).index(i),n.merge(t,o.slice(0,a+1)))})),n(n.unique(t))})())),this._nodes},blockNodes:function(){var e;if(this._range)return this._blockNodes||(this._blockNodes=(e=this,function(){return e.nodes().filter(function(t,n){return e.editor.util.isBlockNode(n)})})()),this._blockNodes},rootNodes:function(){var e;if(this._range)return this._rootNodes||(this._rootNodes=(e=this,function(){return e.nodes().filter(function(t,r){var s;return(s=n(r).parent()).is(e.editor.body)||s.is("blockquote")})})()),this._rootNodes},rangeAtEndOf:function(e,r){var s,i,o,a,d,l;if(null==r&&(r=this.range()),r&&r.collapsed)return e=n(e)[0],o=r.endContainer,a=this.editor.util.getNodeLength(o),i=r.endOffset===a-1,d=n(o).contents().last().is("br"),s=r.endOffset===a,!!(i&&d||s)&&(e===o||!!t.contains(e,o)&&(l=!0,n(o).parentsUntil(e).addBack().each(function(e,t){var r,s,i;if(i=(r=n(t).parent().contents().filter(function(){return!(this!==t&&3===this.nodeType&&!this.nodeValue)}).last()).get(0)===t,s=r.is("br")&&r.prev().get(0)===t,!i&&!s)return l=!1,!1}),l))},rangeAtStartOf:function(e,r){var s,i;if(null==r&&(r=this.range()),r&&r.collapsed)return e=n(e)[0],i=r.startContainer,0===r.startOffset&&(e===i||!!t.contains(e,i)&&(s=!0,n(i).parentsUntil(e).addBack().each(function(e,t){if(n(t).parent().contents().filter(function(){return!(this!==t&&3===this.nodeType&&!this.nodeValue)}).first().get(0)!==t)return s=!1}),s))},insertNode:function(e,t){if(null==t&&(t=this.range()),t)return e=n(e)[0],t.insertNode(e),this.setRangeAfter(e,t)},setRangeAfter:function(e,t){if(null==t&&(t=this.range()),null!=t)return e=n(e)[0],t.setEndAfter(e),t.collapse(!1),this.range(t)},setRangeBefore:function(e,t){if(null==t&&(t=this.range()),null!=t)return e=n(e)[0],t.setEndBefore(e),t.collapse(!1),this.range(t)},setRangeAtStartOf:function(e,t){return null==t&&(t=this.range()),e=n(e).get(0),t.setEnd(e,0),t.collapse(!1),this.range(t)},setRangeAtEndOf:function(e,t){var r,s,i,o,a,d,l;if(null==t&&(t=this.range()),e=(s=n(e))[0])return s.is("pre")?(i=s.contents()).length>0?(d=(o=i.last()).text(),a=this.editor.util.getNodeLength(o[0]),"\n"===d.charAt(d.length-1)?t.setEnd(o[0],a-1):t.setEnd(o[0],a)):t.setEnd(e,0):(l=this.editor.util.getNodeLength(e),3!==e.nodeType&&l>0&&((r=n(e).contents().last()).is("br")?l-=1:3!==r[0].nodeType&&this.editor.util.isEmptyNode(r)&&(r.append(this.editor.util.phBr),e=r[0],l=0)),t.setEnd(e,l)),t.collapse(!1),this.range(t)},deleteRangeContents:function(e){var t,n,r,s;return null==e&&(e=this.range()),s=e.cloneRange(),r=e.cloneRange(),s.collapse(!0),r.collapse(!1),n=this.rangeAtStartOf(this.editor.body,s),t=this.rangeAtEndOf(this.editor.body,r),!e.collapsed&&n&&t?(this.editor.body.empty(),e.setStart(this.editor.body[0],0),e.collapse(!0),this.range(e)):e.deleteContents(),e},breakBlockEl:function(e,t){var r;return null==t&&(t=this.range()),r=n(e),t.collapsed?(t.setStartBefore(r.get(0)),t.collapsed?r:r.before(t.extractContents())):r},save:function(e){var t,r,s;if(null==e&&(e=this.range()),!this._selectionSaved)return(r=e.cloneRange()).collapse(!1),s=n("<span/>").addClass("simditor-caret-start"),t=n("<span/>").addClass("simditor-caret-end"),r.insertNode(t[0]),e.insertNode(s[0]),this.clear(),this._selectionSaved=!0},restore:function(){var e,t,n,r,s,i,o;return!!this._selectionSaved&&(s=this.editor.body.find(".simditor-caret-start"),e=this.editor.body.find(".simditor-caret-end"),s.length&&e.length?(o=(i=s.parent()).contents().index(s),n=(t=e.parent()).contents().index(e),i[0]===t[0]&&(n-=1),(r=document.createRange()).setStart(i.get(0),o),r.setEnd(t.get(0),n),s.remove(),e.remove(),this.range(r)):(s.remove(),e.remove()),this._selectionSaved=!1,r)}});return i.pluginName="Selection",i});
//# sourceMappingURL=sourcemaps/Selection.js.map
