/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-jquery","./_extend","./Module"],function(t,e,n){var i=n.inherit({});return i.pluginName="Indentation",i.prototype.opts={tabIndent:!0},i.prototype._init=function(){return this.editor=this._module,this.editor.keystroke.add("tab","*",(t=this,function(e){var n;if(n=t.editor.toolbar.findButton("code"),t.opts.tabIndent||n&&n.active)return t.indent(e.shiftKey)}));var t},i.prototype.indent=function(e){var n,i,r,o;return this.editor.selection.startNodes(),this.editor.selection.endNodes(),n=this.editor.selection.blockNodes(),i=[],n=n.each(function(e,n){var r,o,s,d,l;for(r=!0,o=s=0,d=i.length;s<d;o=++s){if(l=i[o],t.contains(n,l)){r=!1;break}if(t.contains(l,n)){i.splice(o,1,n),r=!1;break}}if(r)return i.push(n)}),n=t(i),r=!1,n.each((o=this,function(t,n){var i;if(i=e?o.outdentBlock(n):o.indentBlock(n))return r=i})),r},i.prototype.indentBlock=function(e){var n,i,r,o,s,d,l,a,h,c;if((n=t(e)).length){if(n.is("pre")){if(!(d=this.editor.selection.containerNode()).is(n)&&!d.closest("pre").is(n))return;this.indentText(this.editor.selection.range())}else if(n.is("li")){if((s=n.prev("li")).length<1)return;this.editor.selection.save(),c=n.parent()[0].tagName,(i=s.children("ul, ol")).length>0?i.append(n):t("<"+c+"/>").append(n).appendTo(s),this.editor.selection.restore()}else if(n.is("p, h1, h2, h3, h4"))h=parseInt(n.css("margin-left"))||0,h=(Math.round(h/this.opts.indentWidth)+1)*this.opts.indentWidth,n.css("margin-left",h);else{if(!n.is("table")&&!n.is(".simditor-table"))return!1;if((r=(l=this.editor.selection.containerNode().closest("td, th")).next("td, th")).length>0||((o=(a=l.parent("tr")).next("tr")).length<1&&a.parent().is("thead")&&(o=a.parent("thead").next("tbody").find("tr:first")),r=o.find("td:first, th:first")),!(l.length>0&&r.length>0))return;this.editor.selection.setRangeAtEndOf(r)}return!0}},i.prototype.indentText=function(t){var e,n;return e=t.toString().replace(/^(?=.+)/gm,"  "),n=document.createTextNode(e||"  "),t.deleteContents(),t.insertNode(n),e?(t.selectNode(n),this.editor.selection.range(t)):this.editor.selection.setRangeAfter(n)},i.prototype.outdentBlock=function(e){var n,i,r,o,s,d,l,a,h,c;if((n=t(e))&&n.length>0){if(n.is("pre")){if(!(o=this.editor.selection.containerNode()).is(n)&&!o.closest("pre").is(n))return;this.outdentText(c)}else if(n.is("li"))r=(i=n.parent()).parent("li"),this.editor.selection.save(),r.length<1?((c=document.createRange()).setStartBefore(i[0]),c.setEndBefore(n[0]),i.before(c.extractContents()),t("<p/>").insertBefore(i).after(n.children("ul, ol")).append(n.contents()),n.remove()):(n.next("li").length>0&&t("<"+i[0].tagName+"/>").append(n.nextAll("li")).appendTo(n),n.insertAfter(r),i.children("li").length<1&&i.remove()),this.editor.selection.restore();else if(n.is("p, h1, h2, h3, h4"))h=parseInt(n.css("margin-left"))||0,h=Math.max(Math.round(h/this.opts.indentWidth)-1,0)*this.opts.indentWidth,n.css("margin-left",0===h?"":h);else{if(!n.is("table")&&!n.is(".simditor-table"))return!1;if((s=(l=this.editor.selection.containerNode().closest("td, th")).prev("td, th")).length>0||((d=(a=l.parent("tr")).prev("tr")).length<1&&a.parent().is("tbody")&&(d=a.parent("tbody").prev("thead").find("tr:first")),s=d.find("td:last, th:last")),!(l.length>0&&s.length>0))return;this.editor.selection.setRangeAtEndOf(s)}return!0}},i.prototype.outdentText=function(t){},i});
//# sourceMappingURL=sourcemaps/Indentation.js.map
