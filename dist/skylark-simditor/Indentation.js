/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-jquery"],function(t,e){var n=t.Evented.inherit({});return n.pluginName="Indentation",n.prototype.opts={tabIndent:!0},n.prototype.init=function(t){var e;this.editor=t,this.editor.keystroke.add("tab","*",(e=this,function(t){var n;if(n=e.editor.toolbar.findButton("code"),e.opts.tabIndent||n&&n.active)return e.indent(t.shiftKey)}))},n.prototype.indent=function(t){var n,i,r,o;return this.editor.selection.startNodes(),this.editor.selection.endNodes(),n=this.editor.selection.blockNodes(),i=[],n=n.each(function(t,n){var r,o,s,d,a;for(r=!0,o=s=0,d=i.length;s<d;o=++s){if(a=i[o],e.contains(n,a)){r=!1;break}if(e.contains(a,n)){i.splice(o,1,n),r=!1;break}}if(r)return i.push(n)}),n=e(i),r=!1,n.each((o=this,function(e,n){var i;if(i=t?o.outdentBlock(n):o.indentBlock(n))return r=i})),r},n.prototype.indentBlock=function(t){var n,i,r,o,s,d,a,l,h,c;if((n=e(t)).length){if(n.is("pre")){if(!(d=this.editor.selection.containerNode()).is(n)&&!d.closest("pre").is(n))return;this.indentText(this.editor.selection.range())}else if(n.is("li")){if((s=n.prev("li")).length<1)return;this.editor.selection.save(),c=n.parent()[0].tagName,(i=s.children("ul, ol")).length>0?i.append(n):e("<"+c+"/>").append(n).appendTo(s),this.editor.selection.restore()}else if(n.is("p, h1, h2, h3, h4"))h=parseInt(n.css("margin-left"))||0,h=(Math.round(h/this.opts.indentWidth)+1)*this.opts.indentWidth,n.css("margin-left",h);else{if(!n.is("table")&&!n.is(".simditor-table"))return!1;if((r=(a=this.editor.selection.containerNode().closest("td, th")).next("td, th")).length>0||((o=(l=a.parent("tr")).next("tr")).length<1&&l.parent().is("thead")&&(o=l.parent("thead").next("tbody").find("tr:first")),r=o.find("td:first, th:first")),!(a.length>0&&r.length>0))return;this.editor.selection.setRangeAtEndOf(r)}return!0}},n.prototype.indentText=function(t){var e,n;return e=t.toString().replace(/^(?=.+)/gm,"  "),n=document.createTextNode(e||"  "),t.deleteContents(),t.insertNode(n),e?(t.selectNode(n),this.editor.selection.range(t)):this.editor.selection.setRangeAfter(n)},n.prototype.outdentBlock=function(t){var n,i,r,o,s,d,a,l,h,c;if((n=e(t))&&n.length>0){if(n.is("pre")){if(!(o=this.editor.selection.containerNode()).is(n)&&!o.closest("pre").is(n))return;this.outdentText(c)}else if(n.is("li"))r=(i=n.parent()).parent("li"),this.editor.selection.save(),r.length<1?((c=document.createRange()).setStartBefore(i[0]),c.setEndBefore(n[0]),i.before(c.extractContents()),e("<p/>").insertBefore(i).after(n.children("ul, ol")).append(n.contents()),n.remove()):(n.next("li").length>0&&e("<"+i[0].tagName+"/>").append(n.nextAll("li")).appendTo(n),n.insertAfter(r),i.children("li").length<1&&i.remove()),this.editor.selection.restore();else if(n.is("p, h1, h2, h3, h4"))h=parseInt(n.css("margin-left"))||0,h=Math.max(Math.round(h/this.opts.indentWidth)-1,0)*this.opts.indentWidth,n.css("margin-left",0===h?"":h);else{if(!n.is("table")&&!n.is(".simditor-table"))return!1;if((s=(a=this.editor.selection.containerNode().closest("td, th")).prev("td, th")).length>0||((d=(l=a.parent("tr")).prev("tr")).length<1&&l.parent().is("tbody")&&(d=l.parent("tbody").prev("thead").find("tr:first")),s=d.find("td:last, th:last")),!(a.length>0&&s.length>0))return;this.editor.selection.setRangeAtEndOf(s)}return!0}},n.prototype.outdentText=function(t){},n});
//# sourceMappingURL=sourcemaps/Indentation.js.map
