/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/noder","skylark-jquery"],function(t,e,n){var i=t.Evented.inherit({});return i.pluginName="Indentation",i.prototype.opts={tabIndent:!0},i.prototype.init=function(t){var e;this.editor=t,this.editor.keystroke.add("tab","*",(e=this,function(t){var n;if(n=e.editor.toolbar.findButton("code"),e.opts.tabIndent||n&&n.active)return e.indent(t.shiftKey)}))},i.prototype.indent=function(t){var i,r,o,s;return this.editor.selection.startNodes(),this.editor.selection.endNodes(),i=this.editor.selection.blockNodes(),r=[],i=i.each(function(t,n){var i,o,s,d,a;for(i=!0,o=s=0,d=r.length;s<d;o=++s){if(a=r[o],e.contains(n,a)){i=!1;break}if(e.contains(a,n)){r.splice(o,1,n),i=!1;break}}if(i)return r.push(n)}),i=n(r),o=!1,i.each((s=this,function(e,n){var i;if(i=t?s.outdentBlock(n):s.indentBlock(n))return o=i})),o},i.prototype.indentBlock=function(t){var e,i,r,o,s,d,a,l,h,c;if((e=n(t)).length){if(e.is("pre")){if(!(d=this.editor.selection.containerNode()).is(e)&&!d.closest("pre").is(e))return;this.indentText(this.editor.selection.range())}else if(e.is("li")){if((s=e.prev("li")).length<1)return;this.editor.selection.save(),c=e.parent()[0].tagName,(i=s.children("ul, ol")).length>0?i.append(e):n("<"+c+"/>").append(e).appendTo(s),this.editor.selection.restore()}else if(e.is("p, h1, h2, h3, h4"))h=parseInt(e.css("margin-left"))||0,h=(Math.round(h/this.opts.indentWidth)+1)*this.opts.indentWidth,e.css("margin-left",h);else{if(!e.is("table")&&!e.is(".simditor-table"))return!1;if((r=(a=this.editor.selection.containerNode().closest("td, th")).next("td, th")).length>0||((o=(l=a.parent("tr")).next("tr")).length<1&&l.parent().is("thead")&&(o=l.parent("thead").next("tbody").find("tr:first")),r=o.find("td:first, th:first")),!(a.length>0&&r.length>0))return;this.editor.selection.setRangeAtEndOf(r)}return!0}},i.prototype.indentText=function(t){var e,n;return e=t.toString().replace(/^(?=.+)/gm,"  "),n=document.createTextNode(e||"  "),t.deleteContents(),t.insertNode(n),e?(t.selectNode(n),this.editor.selection.range(t)):this.editor.selection.setRangeAfter(n)},i.prototype.outdentBlock=function(t){var e,i,r,o,s,d,a,l,h,c;if((e=n(t))&&e.length>0){if(e.is("pre")){if(!(o=this.editor.selection.containerNode()).is(e)&&!o.closest("pre").is(e))return;this.outdentText(c)}else if(e.is("li"))r=(i=e.parent()).parent("li"),this.editor.selection.save(),r.length<1?((c=document.createRange()).setStartBefore(i[0]),c.setEndBefore(e[0]),i.before(c.extractContents()),n("<p/>").insertBefore(i).after(e.children("ul, ol")).append(e.contents()),e.remove()):(e.next("li").length>0&&n("<"+i[0].tagName+"/>").append(e.nextAll("li")).appendTo(e),e.insertAfter(r),i.children("li").length<1&&i.remove()),this.editor.selection.restore();else if(e.is("p, h1, h2, h3, h4"))h=parseInt(e.css("margin-left"))||0,h=Math.max(Math.round(h/this.opts.indentWidth)-1,0)*this.opts.indentWidth,e.css("margin-left",0===h?"":h);else{if(!e.is("table")&&!e.is(".simditor-table"))return!1;if((s=(a=this.editor.selection.containerNode().closest("td, th")).prev("td, th")).length>0||((d=(l=a.parent("tr")).prev("tr")).length<1&&l.parent().is("tbody")&&(d=l.parent("tbody").prev("thead").find("tr:first")),s=d.find("td:last, th:last")),!(a.length>0&&s.length>0))return;this.editor.selection.setRangeAtEndOf(s)}return!0}},i.prototype.outdentText=function(t){},i});
//# sourceMappingURL=sourcemaps/Indentation.js.map
