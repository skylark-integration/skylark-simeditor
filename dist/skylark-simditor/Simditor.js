/**
 * skylark-simditor - A version of simditor.js that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-simditor/
 * @license MIT
 */
define([],function(){"use strict";var t={},e={};function i(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var e;for(e in t)return!1;return!0}(t)}return define(["skylark-jquery","./_extend","./Module","./hotkeys","./uploader","./Util","./InputManager","./Selection","./UndoManager","./Keystroke","./Formatter","./Toolbar","./Indentation","./Clipboard","./i18n"],function(t,e,i,r,o,s,a,n,d,l,h,p,u,c,f){var m=i.inherit({});return m.connect(s),m.connect(a),m.connect(n),m.connect(d),m.connect(l),m.connect(h),m.connect(p),m.connect(u),m.connect(c),m.count=0,m.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,indentWidth:40},m.prototype._init=function(){var e,i,s;if(this.textarea=t(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("simditor: param textarea is required.");if(null!=(e=this.textarea.data("simditor"))&&e.destroy(),this.id=++m.count,this._render(),!r)throw new Error("simditor: simple-hotkeys is required.");if(this.hotkeys=r({el:this.body}),this.opts.upload&&o&&(i="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=o(i)),this.on("initialized",(s=this,function(){if(s.opts.placeholder&&s.on("valuechanged",function(){return s._placeholder()}),s.setValue(s.textarea.val().trim()||""),s.textarea.attr("autofocus"))return s.focus()})),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){t}}},m.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',m.prototype._render=function(){var e,i,r,o;if(this.el=t(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.data("simditor",this),this.wrapper.append(this.textarea),this.textarea.data("simditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile"),this.opts.params){for(e in r=[],i=this.opts.params)o=i[e],r.push(t("<input/>",{type:"hidden",name:e,value:o}).insertAfter(this.textarea));return r}},m.prototype._placeholder=function(){var t;return 0===(t=this.body.children()).length||1===t.length&&this.util.isEmptyNode(t)&&parseInt(t.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},m.prototype.setValue=function(t){return this.hidePopover(),this.textarea.val(t),this.body.get(0).innerHTML=t,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},m.prototype.getValue=function(){return this.sync()},m.prototype.sync=function(){var e,i,r,o,s,a;for(i=this.body.clone(),this.formatter.undecorate(i),this.formatter.format(i),this.formatter.autolink(i),s=(e=i.children()).last("p"),o=e.first("p");s.is("p")&&this.util.isEmptyNode(s);)r=s,s=s.prev("p"),r.remove();for(;o.is("p")&&this.util.isEmptyNode(o);)r=o,o=s.next("p"),r.remove();return i.find("img.uploading").remove(),a=t.trim(i.html()),this.textarea.val(a),a},m.prototype.focus=function(){var e,i;if(this.body.is(":visible")&&this.body.is("[contenteditable]"))return this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):((e=this.body.children().last()).is("p")||(e=t("<p/>").append(this.util.phBr).appendTo(this.body)),i=document.createRange(),this.selection.setRangeAtEndOf(e,i));this.el.find("textarea:visible").focus()},m.prototype.blur=function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},m.prototype.hidePopover=function(){return this.el.find(".simditor-popover").each(function(e,i){if((i=t(i).data("popover")).active)return i.hide()})},m.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),t(document).off(".simditor-"+this.id),t(window).off(".simditor-"+this.id),this.off()},m.i18n=f,m}),i(e)?e:i(t)?t:void 0});
//# sourceMappingURL=sourcemaps/Simditor.js.map
